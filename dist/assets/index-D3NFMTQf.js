(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const r of i)if(r.type==="childList")for(const l of r.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&n(l)}).observe(document,{childList:!0,subtree:!0});function e(i){const r={};return i.integrity&&(r.integrity=i.integrity),i.referrerPolicy&&(r.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?r.credentials="include":i.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function n(i){if(i.ep)return;i.ep=!0;const r=e(i);fetch(i.href,r)}})();/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */let Jn,On;function Kn(){return{geminiUrl:Jn,vertexUrl:On}}function Wn(o,t,e){var n,i,r;if(!(!((n=o.httpOptions)===null||n===void 0)&&n.baseUrl)){const l=Kn();return o.vertexai?(i=l.vertexUrl)!==null&&i!==void 0?i:t:(r=l.geminiUrl)!==null&&r!==void 0?r:e}return o.httpOptions.baseUrl}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Se{}function b(o,t){const e=/\{([^}]+)\}/g;return o.replace(e,(n,i)=>{if(Object.prototype.hasOwnProperty.call(t,i)){const r=t[i];return r!=null?String(r):""}else throw new Error(`Key '${i}' not found in valueMap.`)})}function s(o,t,e){for(let r=0;r<t.length-1;r++){const l=t[r];if(l.endsWith("[]")){const d=l.slice(0,-2);if(!(d in o))if(Array.isArray(e))o[d]=Array.from({length:e.length},()=>({}));else throw new Error(`Value must be a list given an array path ${l}`);if(Array.isArray(o[d])){const c=o[d];if(Array.isArray(e))for(let u=0;u<c.length;u++){const f=c[u];s(f,t.slice(r+1),e[u])}else for(const u of c)s(u,t.slice(r+1),e)}return}else if(l.endsWith("[0]")){const d=l.slice(0,-3);d in o||(o[d]=[{}]);const c=o[d];s(c[0],t.slice(r+1),e);return}(!o[l]||typeof o[l]!="object")&&(o[l]={}),o=o[l]}const n=t[t.length-1],i=o[n];if(i!==void 0){if(!e||typeof e=="object"&&Object.keys(e).length===0||e===i)return;if(typeof i=="object"&&typeof e=="object"&&i!==null&&e!==null)Object.assign(i,e);else throw new Error(`Cannot set value for an existing key. Key: ${n}`)}else o[n]=e}function a(o,t){try{if(t.length===1&&t[0]==="_self")return o;for(let e=0;e<t.length;e++){if(typeof o!="object"||o===null)return;const n=t[e];if(n.endsWith("[]")){const i=n.slice(0,-2);if(i in o){const r=o[i];return Array.isArray(r)?r.map(l=>a(l,t.slice(e+1))):void 0}else return}else o=o[n]}return o}catch(e){if(e instanceof TypeError)return;throw e}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function M(o,t){if(!t||typeof t!="string")throw new Error("model is required and must be a string");if(o.isVertexAI()){if(t.startsWith("publishers/")||t.startsWith("projects/")||t.startsWith("models/"))return t;if(t.indexOf("/")>=0){const e=t.split("/",2);return`publishers/${e[0]}/models/${e[1]}`}else return`publishers/google/models/${t}`}else return t.startsWith("models/")||t.startsWith("tunedModels/")?t:`models/${t}`}function bn(o,t){const e=M(o,t);return e?e.startsWith("publishers/")&&o.isVertexAI()?`projects/${o.getProject()}/locations/${o.getLocation()}/${e}`:e.startsWith("models/")&&o.isVertexAI()?`projects/${o.getProject()}/locations/${o.getLocation()}/publishers/google/${e}`:e:""}function En(o,t){return Array.isArray(t)?t.map(e=>De(o,e)):[De(o,t)]}function De(o,t){if(typeof t=="object"&&t!==null)return t;throw new Error(`Could not parse input as Blob. Unsupported blob type: ${typeof t}`)}function zn(o,t){const e=De(o,t);if(e.mimeType&&e.mimeType.startsWith("image/"))return e;throw new Error(`Unsupported mime type: ${e.mimeType}`)}function Xn(o,t){const e=De(o,t);if(e.mimeType&&e.mimeType.startsWith("audio/"))return e;throw new Error(`Unsupported mime type: ${e.mimeType}`)}function dt(o,t){if(t==null)throw new Error("PartUnion is required");if(typeof t=="object")return t;if(typeof t=="string")return{text:t};throw new Error(`Unsupported part type: ${typeof t}`)}function Cn(o,t){if(t==null||Array.isArray(t)&&t.length===0)throw new Error("PartListUnion is required");return Array.isArray(t)?t.map(e=>dt(o,e)):[dt(o,t)]}function Oe(o){return o!=null&&typeof o=="object"&&"parts"in o&&Array.isArray(o.parts)}function ct(o){return o!=null&&typeof o=="object"&&"functionCall"in o}function ft(o){return o!=null&&typeof o=="object"&&"functionResponse"in o}function L(o,t){if(t==null)throw new Error("ContentUnion is required");return Oe(t)?t:{role:"user",parts:Cn(o,t)}}function wn(o,t){if(!t)return[];if(o.isVertexAI()&&Array.isArray(t))return t.flatMap(e=>{const n=L(o,e);return n.parts&&n.parts.length>0&&n.parts[0].text!==void 0?[n.parts[0].text]:[]});if(o.isVertexAI()){const e=L(o,t);return e.parts&&e.parts.length>0&&e.parts[0].text!==void 0?[e.parts[0].text]:[]}return Array.isArray(t)?t.map(e=>L(o,e)):[L(o,t)]}function Z(o,t){if(t==null||Array.isArray(t)&&t.length===0)throw new Error("contents are required");if(!Array.isArray(t)){if(ct(t)||ft(t))throw new Error("To specify functionCall or functionResponse parts, please wrap them in a Content object, specifying the role for them");return[L(o,t)]}const e=[],n=[],i=Oe(t[0]);for(const r of t){const l=Oe(r);if(l!=i)throw new Error("Mixing Content and Parts is not supported, please group the parts into a the appropriate Content objects and specify the roles for them");if(l)e.push(r);else{if(ct(r)||ft(r))throw new Error("To specify functionCall or functionResponse parts, please wrap them, and any other parts, in Content objects as appropriate, specifying the role for them");n.push(r)}}return i||e.push({role:"user",parts:Cn(o,n)}),e}function Sn(o,t){return t}function In(o,t){if(typeof t=="object")return t;if(typeof t=="string")return{voiceConfig:{prebuiltVoiceConfig:{voiceName:t}}};throw new Error(`Unsupported speechConfig type: ${typeof t}`)}function Ve(o,t){return t}function qe(o,t){if(!Array.isArray(t))throw new Error("tool is required and must be an array of Tools");return t}function Zn(o,t,e,n=1){const i=!t.startsWith(`${e}/`)&&t.split("/").length===n;return o.isVertexAI()?t.startsWith("projects/")?t:t.startsWith("locations/")?`projects/${o.getProject()}/${t}`:t.startsWith(`${e}/`)?`projects/${o.getProject()}/locations/${o.getLocation()}/${t}`:i?`projects/${o.getProject()}/locations/${o.getLocation()}/${e}/${t}`:t:i?`${e}/${t}`:t}function Q(o,t){if(typeof t!="string")throw new Error("name must be a string");return Zn(o,t,"cachedContents")}function _n(o,t){switch(t){case"STATE_UNSPECIFIED":return"JOB_STATE_UNSPECIFIED";case"CREATING":return"JOB_STATE_RUNNING";case"ACTIVE":return"JOB_STATE_SUCCEEDED";case"FAILED":return"JOB_STATE_FAILED";default:return t}}function j(o,t){if(typeof t!="string")throw new Error("fromImageBytes must be a string");return t}function An(o,t){if(typeof t!="string")throw new Error("fromName must be a string");return t.startsWith("files/")?t.split("files/")[1]:t}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Qn(o,t){const e={};if(a(t,["videoMetadata"])!==void 0)throw new Error("videoMetadata parameter is not supported in Gemini API.");const n=a(t,["thought"]);n!=null&&s(e,["thought"],n);const i=a(t,["codeExecutionResult"]);i!=null&&s(e,["codeExecutionResult"],i);const r=a(t,["executableCode"]);r!=null&&s(e,["executableCode"],r);const l=a(t,["fileData"]);l!=null&&s(e,["fileData"],l);const d=a(t,["functionCall"]);d!=null&&s(e,["functionCall"],d);const c=a(t,["functionResponse"]);c!=null&&s(e,["functionResponse"],c);const u=a(t,["inlineData"]);u!=null&&s(e,["inlineData"],u);const f=a(t,["text"]);return f!=null&&s(e,["text"],f),e}function pt(o,t){const e={},n=a(t,["parts"]);if(n!=null){let r=n;Array.isArray(r)&&(r=r.map(l=>Qn(o,l))),s(e,["parts"],r)}const i=a(t,["role"]);return i!=null&&s(e,["role"],i),e}function jn(){return{}}function eo(o,t){const e={},n=a(t,["mode"]);n!=null&&s(e,["mode"],n);const i=a(t,["dynamicThreshold"]);return i!=null&&s(e,["dynamicThreshold"],i),e}function to(o,t){const e={},n=a(t,["dynamicRetrievalConfig"]);return n!=null&&s(e,["dynamicRetrievalConfig"],eo(o,n)),e}function no(o,t){const e={};if(a(t,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");a(t,["googleSearch"])!=null&&s(e,["googleSearch"],jn());const i=a(t,["googleSearchRetrieval"]);i!=null&&s(e,["googleSearchRetrieval"],to(o,i));const r=a(t,["codeExecution"]);r!=null&&s(e,["codeExecution"],r);const l=a(t,["functionDeclarations"]);return l!=null&&s(e,["functionDeclarations"],l),e}function oo(o,t){const e={},n=a(t,["mode"]);n!=null&&s(e,["mode"],n);const i=a(t,["allowedFunctionNames"]);return i!=null&&s(e,["allowedFunctionNames"],i),e}function io(o,t){const e={},n=a(t,["functionCallingConfig"]);return n!=null&&s(e,["functionCallingConfig"],oo(o,n)),e}function ao(o,t,e){const n={},i=a(t,["ttl"]);e!==void 0&&i!=null&&s(e,["ttl"],i);const r=a(t,["expireTime"]);e!==void 0&&r!=null&&s(e,["expireTime"],r);const l=a(t,["displayName"]);e!==void 0&&l!=null&&s(e,["displayName"],l);const d=a(t,["contents"]);if(e!==void 0&&d!=null){let p=Z(o,d);Array.isArray(p)&&(p=p.map(h=>pt(o,h))),s(e,["contents"],p)}const c=a(t,["systemInstruction"]);e!==void 0&&c!=null&&s(e,["systemInstruction"],pt(o,L(o,c)));const u=a(t,["tools"]);if(e!==void 0&&u!=null){let p=u;Array.isArray(p)&&(p=p.map(h=>no(o,h))),s(e,["tools"],p)}const f=a(t,["toolConfig"]);return e!==void 0&&f!=null&&s(e,["toolConfig"],io(o,f)),n}function so(o,t){const e={},n=a(t,["model"]);n!=null&&s(e,["model"],bn(o,n));const i=a(t,["config"]);return i!=null&&s(e,["config"],ao(o,i,e)),e}function ro(o,t){const e={},n=a(t,["name"]);n!=null&&s(e,["_url","name"],Q(o,n));const i=a(t,["config"]);return i!=null&&s(e,["config"],i),e}function lo(o,t){const e={},n=a(t,["name"]);n!=null&&s(e,["_url","name"],Q(o,n));const i=a(t,["config"]);return i!=null&&s(e,["config"],i),e}function uo(o,t,e){const n={},i=a(t,["ttl"]);e!==void 0&&i!=null&&s(e,["ttl"],i);const r=a(t,["expireTime"]);return e!==void 0&&r!=null&&s(e,["expireTime"],r),n}function co(o,t){const e={},n=a(t,["name"]);n!=null&&s(e,["_url","name"],Q(o,n));const i=a(t,["config"]);return i!=null&&s(e,["config"],uo(o,i,e)),e}function fo(o,t,e){const n={},i=a(t,["pageSize"]);e!==void 0&&i!=null&&s(e,["_query","pageSize"],i);const r=a(t,["pageToken"]);return e!==void 0&&r!=null&&s(e,["_query","pageToken"],r),n}function po(o,t){const e={},n=a(t,["config"]);return n!=null&&s(e,["config"],fo(o,n,e)),e}function ho(o,t){const e={},n=a(t,["videoMetadata"]);n!=null&&s(e,["videoMetadata"],n);const i=a(t,["thought"]);i!=null&&s(e,["thought"],i);const r=a(t,["codeExecutionResult"]);r!=null&&s(e,["codeExecutionResult"],r);const l=a(t,["executableCode"]);l!=null&&s(e,["executableCode"],l);const d=a(t,["fileData"]);d!=null&&s(e,["fileData"],d);const c=a(t,["functionCall"]);c!=null&&s(e,["functionCall"],c);const u=a(t,["functionResponse"]);u!=null&&s(e,["functionResponse"],u);const f=a(t,["inlineData"]);f!=null&&s(e,["inlineData"],f);const p=a(t,["text"]);return p!=null&&s(e,["text"],p),e}function ht(o,t){const e={},n=a(t,["parts"]);if(n!=null){let r=n;Array.isArray(r)&&(r=r.map(l=>ho(o,l))),s(e,["parts"],r)}const i=a(t,["role"]);return i!=null&&s(e,["role"],i),e}function mo(){return{}}function go(o,t){const e={},n=a(t,["mode"]);n!=null&&s(e,["mode"],n);const i=a(t,["dynamicThreshold"]);return i!=null&&s(e,["dynamicThreshold"],i),e}function yo(o,t){const e={},n=a(t,["dynamicRetrievalConfig"]);return n!=null&&s(e,["dynamicRetrievalConfig"],go(o,n)),e}function vo(o,t){const e={},n=a(t,["retrieval"]);n!=null&&s(e,["retrieval"],n),a(t,["googleSearch"])!=null&&s(e,["googleSearch"],mo());const r=a(t,["googleSearchRetrieval"]);r!=null&&s(e,["googleSearchRetrieval"],yo(o,r));const l=a(t,["codeExecution"]);l!=null&&s(e,["codeExecution"],l);const d=a(t,["functionDeclarations"]);return d!=null&&s(e,["functionDeclarations"],d),e}function To(o,t){const e={},n=a(t,["mode"]);n!=null&&s(e,["mode"],n);const i=a(t,["allowedFunctionNames"]);return i!=null&&s(e,["allowedFunctionNames"],i),e}function bo(o,t){const e={},n=a(t,["functionCallingConfig"]);return n!=null&&s(e,["functionCallingConfig"],To(o,n)),e}function Eo(o,t,e){const n={},i=a(t,["ttl"]);e!==void 0&&i!=null&&s(e,["ttl"],i);const r=a(t,["expireTime"]);e!==void 0&&r!=null&&s(e,["expireTime"],r);const l=a(t,["displayName"]);e!==void 0&&l!=null&&s(e,["displayName"],l);const d=a(t,["contents"]);if(e!==void 0&&d!=null){let p=Z(o,d);Array.isArray(p)&&(p=p.map(h=>ht(o,h))),s(e,["contents"],p)}const c=a(t,["systemInstruction"]);e!==void 0&&c!=null&&s(e,["systemInstruction"],ht(o,L(o,c)));const u=a(t,["tools"]);if(e!==void 0&&u!=null){let p=u;Array.isArray(p)&&(p=p.map(h=>vo(o,h))),s(e,["tools"],p)}const f=a(t,["toolConfig"]);return e!==void 0&&f!=null&&s(e,["toolConfig"],bo(o,f)),n}function Co(o,t){const e={},n=a(t,["model"]);n!=null&&s(e,["model"],bn(o,n));const i=a(t,["config"]);return i!=null&&s(e,["config"],Eo(o,i,e)),e}function wo(o,t){const e={},n=a(t,["name"]);n!=null&&s(e,["_url","name"],Q(o,n));const i=a(t,["config"]);return i!=null&&s(e,["config"],i),e}function So(o,t){const e={},n=a(t,["name"]);n!=null&&s(e,["_url","name"],Q(o,n));const i=a(t,["config"]);return i!=null&&s(e,["config"],i),e}function Io(o,t,e){const n={},i=a(t,["ttl"]);e!==void 0&&i!=null&&s(e,["ttl"],i);const r=a(t,["expireTime"]);return e!==void 0&&r!=null&&s(e,["expireTime"],r),n}function _o(o,t){const e={},n=a(t,["name"]);n!=null&&s(e,["_url","name"],Q(o,n));const i=a(t,["config"]);return i!=null&&s(e,["config"],Io(o,i,e)),e}function Ao(o,t,e){const n={},i=a(t,["pageSize"]);e!==void 0&&i!=null&&s(e,["_query","pageSize"],i);const r=a(t,["pageToken"]);return e!==void 0&&r!=null&&s(e,["_query","pageToken"],r),n}function Mo(o,t){const e={},n=a(t,["config"]);return n!=null&&s(e,["config"],Ao(o,n,e)),e}function Re(o,t){const e={},n=a(t,["name"]);n!=null&&s(e,["name"],n);const i=a(t,["displayName"]);i!=null&&s(e,["displayName"],i);const r=a(t,["model"]);r!=null&&s(e,["model"],r);const l=a(t,["createTime"]);l!=null&&s(e,["createTime"],l);const d=a(t,["updateTime"]);d!=null&&s(e,["updateTime"],d);const c=a(t,["expireTime"]);c!=null&&s(e,["expireTime"],c);const u=a(t,["usageMetadata"]);return u!=null&&s(e,["usageMetadata"],u),e}function ko(){return{}}function xo(o,t){const e={},n=a(t,["nextPageToken"]);n!=null&&s(e,["nextPageToken"],n);const i=a(t,["cachedContents"]);if(i!=null){let r=i;Array.isArray(r)&&(r=r.map(l=>Re(o,l))),s(e,["cachedContents"],r)}return e}function Pe(o,t){const e={},n=a(t,["name"]);n!=null&&s(e,["name"],n);const i=a(t,["displayName"]);i!=null&&s(e,["displayName"],i);const r=a(t,["model"]);r!=null&&s(e,["model"],r);const l=a(t,["createTime"]);l!=null&&s(e,["createTime"],l);const d=a(t,["updateTime"]);d!=null&&s(e,["updateTime"],d);const c=a(t,["expireTime"]);c!=null&&s(e,["expireTime"],c);const u=a(t,["usageMetadata"]);return u!=null&&s(e,["usageMetadata"],u),e}function Ro(){return{}}function Po(o,t){const e={},n=a(t,["nextPageToken"]);n!=null&&s(e,["nextPageToken"],n);const i=a(t,["cachedContents"]);if(i!=null){let r=i;Array.isArray(r)&&(r=r.map(l=>Pe(o,l))),s(e,["cachedContents"],r)}return e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */var ge;(function(o){o.PAGED_ITEM_BATCH_JOBS="batchJobs",o.PAGED_ITEM_MODELS="models",o.PAGED_ITEM_TUNING_JOBS="tuningJobs",o.PAGED_ITEM_FILES="files",o.PAGED_ITEM_CACHED_CONTENTS="cachedContents"})(ge||(ge={}));class nt{constructor(t,e,n,i){this.pageInternal=[],this.paramsInternal={},this.requestInternal=e,this.init(t,n,i)}init(t,e,n){var i,r;this.nameInternal=t,this.pageInternal=e[this.nameInternal]||[],this.idxInternal=0;let l={config:{}};n?typeof n=="object"?l=Object.assign({},n):l=n:l={config:{}},l.config&&(l.config.pageToken=e.nextPageToken),this.paramsInternal=l,this.pageInternalSize=(r=(i=l.config)===null||i===void 0?void 0:i.pageSize)!==null&&r!==void 0?r:this.pageInternal.length}initNextPage(t){this.init(this.nameInternal,t,this.paramsInternal)}get page(){return this.pageInternal}get name(){return this.nameInternal}get pageSize(){return this.pageInternalSize}get params(){return this.paramsInternal}get pageLength(){return this.pageInternal.length}getItem(t){return this.pageInternal[t]}[Symbol.asyncIterator](){return{next:async()=>{if(this.idxInternal>=this.pageLength)if(this.hasNextPage())await this.nextPage();else return{value:void 0,done:!0};const t=this.getItem(this.idxInternal);return this.idxInternal+=1,{value:t,done:!1}},return:async()=>({value:void 0,done:!0})}}async nextPage(){if(!this.hasNextPage())throw new Error("No more pages to fetch.");const t=await this.requestInternal(this.params);return this.initNextPage(t),this.page}hasNextPage(){var t;return((t=this.params.config)===null||t===void 0?void 0:t.pageToken)!==void 0}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */var mt;(function(o){o.OUTCOME_UNSPECIFIED="OUTCOME_UNSPECIFIED",o.OUTCOME_OK="OUTCOME_OK",o.OUTCOME_FAILED="OUTCOME_FAILED",o.OUTCOME_DEADLINE_EXCEEDED="OUTCOME_DEADLINE_EXCEEDED"})(mt||(mt={}));var gt;(function(o){o.LANGUAGE_UNSPECIFIED="LANGUAGE_UNSPECIFIED",o.PYTHON="PYTHON"})(gt||(gt={}));var yt;(function(o){o.HARM_CATEGORY_UNSPECIFIED="HARM_CATEGORY_UNSPECIFIED",o.HARM_CATEGORY_HATE_SPEECH="HARM_CATEGORY_HATE_SPEECH",o.HARM_CATEGORY_DANGEROUS_CONTENT="HARM_CATEGORY_DANGEROUS_CONTENT",o.HARM_CATEGORY_HARASSMENT="HARM_CATEGORY_HARASSMENT",o.HARM_CATEGORY_SEXUALLY_EXPLICIT="HARM_CATEGORY_SEXUALLY_EXPLICIT",o.HARM_CATEGORY_CIVIC_INTEGRITY="HARM_CATEGORY_CIVIC_INTEGRITY"})(yt||(yt={}));var vt;(function(o){o.HARM_BLOCK_METHOD_UNSPECIFIED="HARM_BLOCK_METHOD_UNSPECIFIED",o.SEVERITY="SEVERITY",o.PROBABILITY="PROBABILITY"})(vt||(vt={}));var Tt;(function(o){o.HARM_BLOCK_THRESHOLD_UNSPECIFIED="HARM_BLOCK_THRESHOLD_UNSPECIFIED",o.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",o.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",o.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",o.BLOCK_NONE="BLOCK_NONE",o.OFF="OFF"})(Tt||(Tt={}));var bt;(function(o){o.MODE_UNSPECIFIED="MODE_UNSPECIFIED",o.MODE_DYNAMIC="MODE_DYNAMIC"})(bt||(bt={}));var Et;(function(o){o.TYPE_UNSPECIFIED="TYPE_UNSPECIFIED",o.STRING="STRING",o.NUMBER="NUMBER",o.INTEGER="INTEGER",o.BOOLEAN="BOOLEAN",o.ARRAY="ARRAY",o.OBJECT="OBJECT"})(Et||(Et={}));var Ct;(function(o){o.FINISH_REASON_UNSPECIFIED="FINISH_REASON_UNSPECIFIED",o.STOP="STOP",o.MAX_TOKENS="MAX_TOKENS",o.SAFETY="SAFETY",o.RECITATION="RECITATION",o.LANGUAGE="LANGUAGE",o.OTHER="OTHER",o.BLOCKLIST="BLOCKLIST",o.PROHIBITED_CONTENT="PROHIBITED_CONTENT",o.SPII="SPII",o.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",o.IMAGE_SAFETY="IMAGE_SAFETY"})(Ct||(Ct={}));var wt;(function(o){o.HARM_PROBABILITY_UNSPECIFIED="HARM_PROBABILITY_UNSPECIFIED",o.NEGLIGIBLE="NEGLIGIBLE",o.LOW="LOW",o.MEDIUM="MEDIUM",o.HIGH="HIGH"})(wt||(wt={}));var St;(function(o){o.HARM_SEVERITY_UNSPECIFIED="HARM_SEVERITY_UNSPECIFIED",o.HARM_SEVERITY_NEGLIGIBLE="HARM_SEVERITY_NEGLIGIBLE",o.HARM_SEVERITY_LOW="HARM_SEVERITY_LOW",o.HARM_SEVERITY_MEDIUM="HARM_SEVERITY_MEDIUM",o.HARM_SEVERITY_HIGH="HARM_SEVERITY_HIGH"})(St||(St={}));var It;(function(o){o.BLOCKED_REASON_UNSPECIFIED="BLOCKED_REASON_UNSPECIFIED",o.SAFETY="SAFETY",o.OTHER="OTHER",o.BLOCKLIST="BLOCKLIST",o.PROHIBITED_CONTENT="PROHIBITED_CONTENT"})(It||(It={}));var _t;(function(o){o.TRAFFIC_TYPE_UNSPECIFIED="TRAFFIC_TYPE_UNSPECIFIED",o.ON_DEMAND="ON_DEMAND",o.PROVISIONED_THROUGHPUT="PROVISIONED_THROUGHPUT"})(_t||(_t={}));var N;(function(o){o.MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",o.TEXT="TEXT",o.IMAGE="IMAGE",o.AUDIO="AUDIO"})(N||(N={}));var At;(function(o){o.MEDIA_RESOLUTION_UNSPECIFIED="MEDIA_RESOLUTION_UNSPECIFIED",o.MEDIA_RESOLUTION_LOW="MEDIA_RESOLUTION_LOW",o.MEDIA_RESOLUTION_MEDIUM="MEDIA_RESOLUTION_MEDIUM",o.MEDIA_RESOLUTION_HIGH="MEDIA_RESOLUTION_HIGH"})(At||(At={}));var Ke;(function(o){o.JOB_STATE_UNSPECIFIED="JOB_STATE_UNSPECIFIED",o.JOB_STATE_QUEUED="JOB_STATE_QUEUED",o.JOB_STATE_PENDING="JOB_STATE_PENDING",o.JOB_STATE_RUNNING="JOB_STATE_RUNNING",o.JOB_STATE_SUCCEEDED="JOB_STATE_SUCCEEDED",o.JOB_STATE_FAILED="JOB_STATE_FAILED",o.JOB_STATE_CANCELLING="JOB_STATE_CANCELLING",o.JOB_STATE_CANCELLED="JOB_STATE_CANCELLED",o.JOB_STATE_PAUSED="JOB_STATE_PAUSED",o.JOB_STATE_EXPIRED="JOB_STATE_EXPIRED",o.JOB_STATE_UPDATING="JOB_STATE_UPDATING",o.JOB_STATE_PARTIALLY_SUCCEEDED="JOB_STATE_PARTIALLY_SUCCEEDED"})(Ke||(Ke={}));var Mt;(function(o){o.ADAPTER_SIZE_UNSPECIFIED="ADAPTER_SIZE_UNSPECIFIED",o.ADAPTER_SIZE_ONE="ADAPTER_SIZE_ONE",o.ADAPTER_SIZE_TWO="ADAPTER_SIZE_TWO",o.ADAPTER_SIZE_FOUR="ADAPTER_SIZE_FOUR",o.ADAPTER_SIZE_EIGHT="ADAPTER_SIZE_EIGHT",o.ADAPTER_SIZE_SIXTEEN="ADAPTER_SIZE_SIXTEEN",o.ADAPTER_SIZE_THIRTY_TWO="ADAPTER_SIZE_THIRTY_TWO"})(Mt||(Mt={}));var kt;(function(o){o.FEATURE_SELECTION_PREFERENCE_UNSPECIFIED="FEATURE_SELECTION_PREFERENCE_UNSPECIFIED",o.PRIORITIZE_QUALITY="PRIORITIZE_QUALITY",o.BALANCED="BALANCED",o.PRIORITIZE_COST="PRIORITIZE_COST"})(kt||(kt={}));var xt;(function(o){o.MODE_UNSPECIFIED="MODE_UNSPECIFIED",o.MODE_DYNAMIC="MODE_DYNAMIC"})(xt||(xt={}));var Rt;(function(o){o.MODE_UNSPECIFIED="MODE_UNSPECIFIED",o.AUTO="AUTO",o.ANY="ANY",o.NONE="NONE"})(Rt||(Rt={}));var Pt;(function(o){o.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",o.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",o.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",o.BLOCK_NONE="BLOCK_NONE"})(Pt||(Pt={}));var Dt;(function(o){o.DONT_ALLOW="DONT_ALLOW",o.ALLOW_ADULT="ALLOW_ADULT",o.ALLOW_ALL="ALLOW_ALL"})(Dt||(Dt={}));var Lt;(function(o){o.auto="auto",o.en="en",o.ja="ja",o.ko="ko",o.hi="hi"})(Lt||(Lt={}));var Nt;(function(o){o.STATE_UNSPECIFIED="STATE_UNSPECIFIED",o.PROCESSING="PROCESSING",o.ACTIVE="ACTIVE",o.FAILED="FAILED"})(Nt||(Nt={}));var Bt;(function(o){o.SOURCE_UNSPECIFIED="SOURCE_UNSPECIFIED",o.UPLOADED="UPLOADED",o.GENERATED="GENERATED"})(Bt||(Bt={}));var Ut;(function(o){o.MASK_MODE_DEFAULT="MASK_MODE_DEFAULT",o.MASK_MODE_USER_PROVIDED="MASK_MODE_USER_PROVIDED",o.MASK_MODE_BACKGROUND="MASK_MODE_BACKGROUND",o.MASK_MODE_FOREGROUND="MASK_MODE_FOREGROUND",o.MASK_MODE_SEMANTIC="MASK_MODE_SEMANTIC"})(Ut||(Ut={}));var Ft;(function(o){o.CONTROL_TYPE_DEFAULT="CONTROL_TYPE_DEFAULT",o.CONTROL_TYPE_CANNY="CONTROL_TYPE_CANNY",o.CONTROL_TYPE_SCRIBBLE="CONTROL_TYPE_SCRIBBLE",o.CONTROL_TYPE_FACE_MESH="CONTROL_TYPE_FACE_MESH"})(Ft||(Ft={}));var Vt;(function(o){o.SUBJECT_TYPE_DEFAULT="SUBJECT_TYPE_DEFAULT",o.SUBJECT_TYPE_PERSON="SUBJECT_TYPE_PERSON",o.SUBJECT_TYPE_ANIMAL="SUBJECT_TYPE_ANIMAL",o.SUBJECT_TYPE_PRODUCT="SUBJECT_TYPE_PRODUCT"})(Vt||(Vt={}));var qt;(function(o){o.MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",o.TEXT="TEXT",o.IMAGE="IMAGE",o.VIDEO="VIDEO",o.AUDIO="AUDIO",o.DOCUMENT="DOCUMENT"})(qt||(qt={}));var Gt;(function(o){o.START_SENSITIVITY_UNSPECIFIED="START_SENSITIVITY_UNSPECIFIED",o.START_SENSITIVITY_HIGH="START_SENSITIVITY_HIGH",o.START_SENSITIVITY_LOW="START_SENSITIVITY_LOW"})(Gt||(Gt={}));var Ht;(function(o){o.END_SENSITIVITY_UNSPECIFIED="END_SENSITIVITY_UNSPECIFIED",o.END_SENSITIVITY_HIGH="END_SENSITIVITY_HIGH",o.END_SENSITIVITY_LOW="END_SENSITIVITY_LOW"})(Ht||(Ht={}));var $t;(function(o){o.ACTIVITY_HANDLING_UNSPECIFIED="ACTIVITY_HANDLING_UNSPECIFIED",o.START_OF_ACTIVITY_INTERRUPTS="START_OF_ACTIVITY_INTERRUPTS",o.NO_INTERRUPTION="NO_INTERRUPTION"})($t||($t={}));var Yt;(function(o){o.TURN_COVERAGE_UNSPECIFIED="TURN_COVERAGE_UNSPECIFIED",o.TURN_INCLUDES_ONLY_ACTIVITY="TURN_INCLUDES_ONLY_ACTIVITY",o.TURN_INCLUDES_ALL_INPUT="TURN_INCLUDES_ALL_INPUT"})(Yt||(Yt={}));class Me{get text(){var t,e,n,i,r,l,d,c;if(((i=(n=(e=(t=this.candidates)===null||t===void 0?void 0:t[0])===null||e===void 0?void 0:e.content)===null||n===void 0?void 0:n.parts)===null||i===void 0?void 0:i.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning text from the first one.");let u="",f=!1;const p=[];for(const h of(c=(d=(l=(r=this.candidates)===null||r===void 0?void 0:r[0])===null||l===void 0?void 0:l.content)===null||d===void 0?void 0:d.parts)!==null&&c!==void 0?c:[]){for(const[g,y]of Object.entries(h))g!=="text"&&g!=="thought"&&(y!==null||y!==void 0)&&p.push(g);if(typeof h.text=="string"){if(typeof h.thought=="boolean"&&h.thought)continue;f=!0,u+=h.text}}return p.length>0&&console.warn(`there are non-text parts ${p} in the response, returning concatenation of all text parts. Please refer to the non text parts for a full response from model.`),f?u:void 0}get data(){var t,e,n,i,r,l,d,c;if(((i=(n=(e=(t=this.candidates)===null||t===void 0?void 0:t[0])===null||e===void 0?void 0:e.content)===null||n===void 0?void 0:n.parts)===null||i===void 0?void 0:i.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning data from the first one.");let u="";const f=[];for(const p of(c=(d=(l=(r=this.candidates)===null||r===void 0?void 0:r[0])===null||l===void 0?void 0:l.content)===null||d===void 0?void 0:d.parts)!==null&&c!==void 0?c:[]){for(const[h,g]of Object.entries(p))h!=="inlineData"&&(g!==null||g!==void 0)&&f.push(h);p.inlineData&&typeof p.inlineData.data=="string"&&(u+=atob(p.inlineData.data))}return f.length>0&&console.warn(`there are non-data parts ${f} in the response, returning concatenation of all data parts. Please refer to the non data parts for a full response from model.`),u.length>0?btoa(u):void 0}get functionCalls(){var t,e,n,i,r,l,d,c;if(((i=(n=(e=(t=this.candidates)===null||t===void 0?void 0:t[0])===null||e===void 0?void 0:e.content)===null||n===void 0?void 0:n.parts)===null||i===void 0?void 0:i.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning function calls from the first one.");const u=(c=(d=(l=(r=this.candidates)===null||r===void 0?void 0:r[0])===null||l===void 0?void 0:l.content)===null||d===void 0?void 0:d.parts)===null||c===void 0?void 0:c.filter(f=>f.functionCall).map(f=>f.functionCall).filter(f=>f!==void 0);if((u==null?void 0:u.length)!==0)return u}get executableCode(){var t,e,n,i,r,l,d,c,u;if(((i=(n=(e=(t=this.candidates)===null||t===void 0?void 0:t[0])===null||e===void 0?void 0:e.content)===null||n===void 0?void 0:n.parts)===null||i===void 0?void 0:i.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning executable code from the first one.");const f=(c=(d=(l=(r=this.candidates)===null||r===void 0?void 0:r[0])===null||l===void 0?void 0:l.content)===null||d===void 0?void 0:d.parts)===null||c===void 0?void 0:c.filter(p=>p.executableCode).map(p=>p.executableCode).filter(p=>p!==void 0);if((f==null?void 0:f.length)!==0)return(u=f==null?void 0:f[0])===null||u===void 0?void 0:u.code}get codeExecutionResult(){var t,e,n,i,r,l,d,c,u;if(((i=(n=(e=(t=this.candidates)===null||t===void 0?void 0:t[0])===null||e===void 0?void 0:e.content)===null||n===void 0?void 0:n.parts)===null||i===void 0?void 0:i.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning code execution result from the first one.");const f=(c=(d=(l=(r=this.candidates)===null||r===void 0?void 0:r[0])===null||l===void 0?void 0:l.content)===null||d===void 0?void 0:d.parts)===null||c===void 0?void 0:c.filter(p=>p.codeExecutionResult).map(p=>p.codeExecutionResult).filter(p=>p!==void 0);if((f==null?void 0:f.length)!==0)return(u=f==null?void 0:f[0])===null||u===void 0?void 0:u.output}}class Jt{}class Ot{}class Kt{}class Wt{}class Do{}class zt{}class Xt{}class Zt{}class Lo{}class We{constructor(t){const e={};for(const n of t.headers.entries())e[n[0]]=n[1];this.headers=e,this.responseInternal=t}json(){return this.responseInternal.json()}}class No{}class Bo{}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Uo extends Se{constructor(t){super(),this.apiClient=t,this.list=async(e={})=>new nt(ge.PAGED_ITEM_CACHED_CONTENTS,n=>this.listInternal(n),await this.listInternal(e),e)}async create(t){var e,n,i,r;let l,d="",c={};if(this.apiClient.isVertexAI()){const u=Co(this.apiClient,t);return d=b("cachedContents",u._url),c=u._query,delete u.config,delete u._url,delete u._query,l=this.apiClient.request({path:d,queryParams:c,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(f=>f.json()),l.then(f=>Pe(this.apiClient,f))}else{const u=so(this.apiClient,t);return d=b("cachedContents",u._url),c=u._query,delete u.config,delete u._url,delete u._query,l=this.apiClient.request({path:d,queryParams:c,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(i=t.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json()),l.then(f=>Re(this.apiClient,f))}}async get(t){var e,n,i,r;let l,d="",c={};if(this.apiClient.isVertexAI()){const u=wo(this.apiClient,t);return d=b("{name}",u._url),c=u._query,delete u.config,delete u._url,delete u._query,l=this.apiClient.request({path:d,queryParams:c,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(f=>f.json()),l.then(f=>Pe(this.apiClient,f))}else{const u=ro(this.apiClient,t);return d=b("{name}",u._url),c=u._query,delete u.config,delete u._url,delete u._query,l=this.apiClient.request({path:d,queryParams:c,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(i=t.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json()),l.then(f=>Re(this.apiClient,f))}}async delete(t){var e,n,i,r;let l,d="",c={};if(this.apiClient.isVertexAI()){const u=So(this.apiClient,t);return d=b("{name}",u._url),c=u._query,delete u.config,delete u._url,delete u._query,l=this.apiClient.request({path:d,queryParams:c,body:JSON.stringify(u),httpMethod:"DELETE",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(f=>f.json()),l.then(()=>{const f=Ro(),p=new Xt;return Object.assign(p,f),p})}else{const u=lo(this.apiClient,t);return d=b("{name}",u._url),c=u._query,delete u.config,delete u._url,delete u._query,l=this.apiClient.request({path:d,queryParams:c,body:JSON.stringify(u),httpMethod:"DELETE",httpOptions:(i=t.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json()),l.then(()=>{const f=ko(),p=new Xt;return Object.assign(p,f),p})}}async update(t){var e,n,i,r;let l,d="",c={};if(this.apiClient.isVertexAI()){const u=_o(this.apiClient,t);return d=b("{name}",u._url),c=u._query,delete u.config,delete u._url,delete u._query,l=this.apiClient.request({path:d,queryParams:c,body:JSON.stringify(u),httpMethod:"PATCH",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(f=>f.json()),l.then(f=>Pe(this.apiClient,f))}else{const u=co(this.apiClient,t);return d=b("{name}",u._url),c=u._query,delete u.config,delete u._url,delete u._query,l=this.apiClient.request({path:d,queryParams:c,body:JSON.stringify(u),httpMethod:"PATCH",httpOptions:(i=t.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json()),l.then(f=>Re(this.apiClient,f))}}async listInternal(t){var e,n,i,r;let l,d="",c={};if(this.apiClient.isVertexAI()){const u=Mo(this.apiClient,t);return d=b("cachedContents",u._url),c=u._query,delete u.config,delete u._url,delete u._query,l=this.apiClient.request({path:d,queryParams:c,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(f=>f.json()),l.then(f=>{const p=Po(this.apiClient,f),h=new Zt;return Object.assign(h,p),h})}else{const u=po(this.apiClient,t);return d=b("cachedContents",u._url),c=u._query,delete u.config,delete u._url,delete u._query,l=this.apiClient.request({path:d,queryParams:c,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(i=t.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json()),l.then(f=>{const p=xo(this.apiClient,f),h=new Zt;return Object.assign(h,p),h})}}}function Qt(o){var t=typeof Symbol=="function"&&Symbol.iterator,e=t&&o[t],n=0;if(e)return e.call(o);if(o&&typeof o.length=="number")return{next:function(){return o&&n>=o.length&&(o=void 0),{value:o&&o[n++],done:!o}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function P(o){return this instanceof P?(this.v=o,this):new P(o)}function Le(o,t,e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=e.apply(o,t||[]),i,r=[];return i=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),d("next"),d("throw"),d("return",l),i[Symbol.asyncIterator]=function(){return this},i;function l(g){return function(y){return Promise.resolve(y).then(g,p)}}function d(g,y){n[g]&&(i[g]=function(T){return new Promise(function(E,w){r.push([g,T,E,w])>1||c(g,T)})},y&&(i[g]=y(i[g])))}function c(g,y){try{u(n[g](y))}catch(T){h(r[0][3],T)}}function u(g){g.value instanceof P?Promise.resolve(g.value.v).then(f,p):h(r[0][2],g)}function f(g){c("next",g)}function p(g){c("throw",g)}function h(g,y){g(y),r.shift(),r.length&&c(r[0][0],r[0][1])}}function ze(o){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t=o[Symbol.asyncIterator],e;return t?t.call(o):(o=typeof Qt=="function"?Qt(o):o[Symbol.iterator](),e={},n("next"),n("throw"),n("return"),e[Symbol.asyncIterator]=function(){return this},e);function n(r){e[r]=o[r]&&function(l){return new Promise(function(d,c){l=o[r](l),i(d,c,l.done,l.value)})}}function i(r,l,d,c){Promise.resolve(c).then(function(u){r({value:u,done:d})},l)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Fo(o){var t;if(o.candidates==null||o.candidates.length===0)return!1;const e=(t=o.candidates[0])===null||t===void 0?void 0:t.content;return e===void 0?!1:Mn(e)}function Mn(o){if(o.parts===void 0||o.parts.length===0)return!1;for(const t of o.parts)if(t===void 0||Object.keys(t).length===0||t.text!==void 0&&t.text==="")return!1;return!0}function Vo(o){if(o.length!==0){if(o[0].role!=="user")throw new Error("History must start with a user turn.");for(const t of o)if(t.role!=="user"&&t.role!=="model")throw new Error(`Role must be user or model, but got ${t.role}.`)}}function qo(o){if(o===void 0||o.length===0)return[];const t=[],e=o.length;let n=0,i=o[0];for(;n<e;)if(o[n].role==="user")i=o[n],n++;else{const r=[];let l=!0;for(;n<e&&o[n].role==="model";)r.push(o[n]),l&&!Mn(o[n])&&(l=!1),n++;l&&(t.push(i),t.push(...r))}return t}class Go{constructor(t,e){this.modelsModule=t,this.apiClient=e}create(t){return new Ho(this.apiClient,this.modelsModule,t.model,t.config,t.history)}}class Ho{constructor(t,e,n,i={},r=[]){this.apiClient=t,this.modelsModule=e,this.model=n,this.config=i,this.history=r,this.sendPromise=Promise.resolve(),Vo(r)}async sendMessage(t){var e;await this.sendPromise;const n=L(this.apiClient,t.message),i=this.modelsModule.generateContent({model:this.model,contents:this.getHistory(!0).concat(n),config:(e=t.config)!==null&&e!==void 0?e:this.config});return this.sendPromise=(async()=>{var r,l;const c=(l=(r=(await i).candidates)===null||r===void 0?void 0:r[0])===null||l===void 0?void 0:l.content,u=c?[c]:[];this.recordHistory(n,u)})(),await this.sendPromise,i}async sendMessageStream(t){var e;await this.sendPromise;const n=L(this.apiClient,t.message),i=this.modelsModule.generateContentStream({model:this.model,contents:this.getHistory(!0).concat(n),config:(e=t.config)!==null&&e!==void 0?e:this.config});this.sendPromise=i.then(()=>{}).catch(()=>{});const r=await i;return this.processStreamResponse(r,n)}getHistory(t=!1){return t?qo(this.history):this.history}processStreamResponse(t,e){var n,i;return Le(this,arguments,function*(){var l,d,c,u;const f=[];try{for(var p=!0,h=ze(t),g;g=yield P(h.next()),l=g.done,!l;p=!0){u=g.value,p=!1;const y=u;if(Fo(y)){const T=(i=(n=y.candidates)===null||n===void 0?void 0:n[0])===null||i===void 0?void 0:i.content;T!==void 0&&f.push(T)}yield yield P(y)}}catch(y){d={error:y}}finally{try{!p&&!l&&(c=h.return)&&(yield P(c.call(h)))}finally{if(d)throw d.error}}this.recordHistory(e,f)})}recordHistory(t,e){let n=[];e.length>0&&e.every(i=>i.role==="model")?n=e:n.push({role:"model",parts:[]}),this.history.push(t),this.history.push(...n)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function $o(o,t,e){const n={},i=a(t,["pageSize"]);e!==void 0&&i!=null&&s(e,["_query","pageSize"],i);const r=a(t,["pageToken"]);return e!==void 0&&r!=null&&s(e,["_query","pageToken"],r),n}function Yo(o,t){const e={},n=a(t,["config"]);return n!=null&&s(e,["config"],$o(o,n,e)),e}function Jo(o,t){const e={},n=a(t,["details"]);n!=null&&s(e,["details"],n);const i=a(t,["message"]);i!=null&&s(e,["message"],i);const r=a(t,["code"]);return r!=null&&s(e,["code"],r),e}function Oo(o,t){const e={},n=a(t,["name"]);n!=null&&s(e,["name"],n);const i=a(t,["displayName"]);i!=null&&s(e,["displayName"],i);const r=a(t,["mimeType"]);r!=null&&s(e,["mimeType"],r);const l=a(t,["sizeBytes"]);l!=null&&s(e,["sizeBytes"],l);const d=a(t,["createTime"]);d!=null&&s(e,["createTime"],d);const c=a(t,["expirationTime"]);c!=null&&s(e,["expirationTime"],c);const u=a(t,["updateTime"]);u!=null&&s(e,["updateTime"],u);const f=a(t,["sha256Hash"]);f!=null&&s(e,["sha256Hash"],f);const p=a(t,["uri"]);p!=null&&s(e,["uri"],p);const h=a(t,["downloadUri"]);h!=null&&s(e,["downloadUri"],h);const g=a(t,["state"]);g!=null&&s(e,["state"],g);const y=a(t,["source"]);y!=null&&s(e,["source"],y);const T=a(t,["videoMetadata"]);T!=null&&s(e,["videoMetadata"],T);const E=a(t,["error"]);return E!=null&&s(e,["error"],Jo(o,E)),e}function Ko(o,t){const e={},n=a(t,["file"]);n!=null&&s(e,["file"],Oo(o,n));const i=a(t,["config"]);return i!=null&&s(e,["config"],i),e}function Wo(o,t){const e={},n=a(t,["name"]);n!=null&&s(e,["_url","file"],An(o,n));const i=a(t,["config"]);return i!=null&&s(e,["config"],i),e}function zo(o,t){const e={},n=a(t,["name"]);n!=null&&s(e,["_url","file"],An(o,n));const i=a(t,["config"]);return i!=null&&s(e,["config"],i),e}function Xo(o,t){const e={},n=a(t,["details"]);n!=null&&s(e,["details"],n);const i=a(t,["message"]);i!=null&&s(e,["message"],i);const r=a(t,["code"]);return r!=null&&s(e,["code"],r),e}function Xe(o,t){const e={},n=a(t,["name"]);n!=null&&s(e,["name"],n);const i=a(t,["displayName"]);i!=null&&s(e,["displayName"],i);const r=a(t,["mimeType"]);r!=null&&s(e,["mimeType"],r);const l=a(t,["sizeBytes"]);l!=null&&s(e,["sizeBytes"],l);const d=a(t,["createTime"]);d!=null&&s(e,["createTime"],d);const c=a(t,["expirationTime"]);c!=null&&s(e,["expirationTime"],c);const u=a(t,["updateTime"]);u!=null&&s(e,["updateTime"],u);const f=a(t,["sha256Hash"]);f!=null&&s(e,["sha256Hash"],f);const p=a(t,["uri"]);p!=null&&s(e,["uri"],p);const h=a(t,["downloadUri"]);h!=null&&s(e,["downloadUri"],h);const g=a(t,["state"]);g!=null&&s(e,["state"],g);const y=a(t,["source"]);y!=null&&s(e,["source"],y);const T=a(t,["videoMetadata"]);T!=null&&s(e,["videoMetadata"],T);const E=a(t,["error"]);return E!=null&&s(e,["error"],Xo(o,E)),e}function Zo(o,t){const e={},n=a(t,["nextPageToken"]);n!=null&&s(e,["nextPageToken"],n);const i=a(t,["files"]);if(i!=null){let r=i;Array.isArray(r)&&(r=r.map(l=>Xe(o,l))),s(e,["files"],r)}return e}function Qo(){return{}}function jo(){return{}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class ei extends Se{constructor(t){super(),this.apiClient=t,this.list=async(e={})=>new nt(ge.PAGED_ITEM_FILES,n=>this.listInternal(n),await this.listInternal(e),e)}async upload(t){if(this.apiClient.isVertexAI())throw new Error("Vertex AI does not support uploading files. You can share files through a GCS bucket.");return this.apiClient.uploadFile(t.file,t.config).then(e=>Xe(this.apiClient,e))}async listInternal(t){var e,n;let i,r="",l={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const d=Yo(this.apiClient,t);return r=b("files",d._url),l=d._query,delete d.config,delete d._url,delete d._query,i=this.apiClient.request({path:r,queryParams:l,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(c=>c.json()),i.then(c=>{const u=Zo(this.apiClient,c),f=new Lo;return Object.assign(f,u),f})}}async createInternal(t){var e,n;let i,r="",l={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const d=Ko(this.apiClient,t);return r=b("upload/v1beta/files",d._url),l=d._query,delete d.config,delete d._url,delete d._query,i=this.apiClient.request({path:r,queryParams:l,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(c=>c.json()),i.then(()=>{const c=Qo(),u=new No;return Object.assign(u,c),u})}}async get(t){var e,n;let i,r="",l={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const d=Wo(this.apiClient,t);return r=b("files/{file}",d._url),l=d._query,delete d.config,delete d._url,delete d._query,i=this.apiClient.request({path:r,queryParams:l,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(c=>c.json()),i.then(c=>Xe(this.apiClient,c))}}async delete(t){var e,n;let i,r="",l={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const d=zo(this.apiClient,t);return r=b("files/{file}",d._url),l=d._query,delete d.config,delete d._url,delete d._query,i=this.apiClient.request({path:r,queryParams:l,body:JSON.stringify(d),httpMethod:"DELETE",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(c=>c.json()),i.then(()=>{const c=jo(),u=new Bo;return Object.assign(u,c),u})}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function ti(o,t){const e={};if(a(t,["videoMetadata"])!==void 0)throw new Error("videoMetadata parameter is not supported in Gemini API.");const n=a(t,["thought"]);n!=null&&s(e,["thought"],n);const i=a(t,["codeExecutionResult"]);i!=null&&s(e,["codeExecutionResult"],i);const r=a(t,["executableCode"]);r!=null&&s(e,["executableCode"],r);const l=a(t,["fileData"]);l!=null&&s(e,["fileData"],l);const d=a(t,["functionCall"]);d!=null&&s(e,["functionCall"],d);const c=a(t,["functionResponse"]);c!=null&&s(e,["functionResponse"],c);const u=a(t,["inlineData"]);u!=null&&s(e,["inlineData"],u);const f=a(t,["text"]);return f!=null&&s(e,["text"],f),e}function ni(o,t){const e={},n=a(t,["videoMetadata"]);n!=null&&s(e,["videoMetadata"],n);const i=a(t,["thought"]);i!=null&&s(e,["thought"],i);const r=a(t,["codeExecutionResult"]);r!=null&&s(e,["codeExecutionResult"],r);const l=a(t,["executableCode"]);l!=null&&s(e,["executableCode"],l);const d=a(t,["fileData"]);d!=null&&s(e,["fileData"],d);const c=a(t,["functionCall"]);c!=null&&s(e,["functionCall"],c);const u=a(t,["functionResponse"]);u!=null&&s(e,["functionResponse"],u);const f=a(t,["inlineData"]);f!=null&&s(e,["inlineData"],f);const p=a(t,["text"]);return p!=null&&s(e,["text"],p),e}function oi(o,t){const e={},n=a(t,["parts"]);if(n!=null){let r=n;Array.isArray(r)&&(r=r.map(l=>ti(o,l))),s(e,["parts"],r)}const i=a(t,["role"]);return i!=null&&s(e,["role"],i),e}function ii(o,t){const e={},n=a(t,["parts"]);if(n!=null){let r=n;Array.isArray(r)&&(r=r.map(l=>ni(o,l))),s(e,["parts"],r)}const i=a(t,["role"]);return i!=null&&s(e,["role"],i),e}function ai(){return{}}function si(){return{}}function ri(o,t){const e={},n=a(t,["mode"]);n!=null&&s(e,["mode"],n);const i=a(t,["dynamicThreshold"]);return i!=null&&s(e,["dynamicThreshold"],i),e}function li(o,t){const e={},n=a(t,["mode"]);n!=null&&s(e,["mode"],n);const i=a(t,["dynamicThreshold"]);return i!=null&&s(e,["dynamicThreshold"],i),e}function ui(o,t){const e={},n=a(t,["dynamicRetrievalConfig"]);return n!=null&&s(e,["dynamicRetrievalConfig"],ri(o,n)),e}function di(o,t){const e={},n=a(t,["dynamicRetrievalConfig"]);return n!=null&&s(e,["dynamicRetrievalConfig"],li(o,n)),e}function ci(o,t){const e={};if(a(t,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");a(t,["googleSearch"])!=null&&s(e,["googleSearch"],ai());const i=a(t,["googleSearchRetrieval"]);i!=null&&s(e,["googleSearchRetrieval"],ui(o,i));const r=a(t,["codeExecution"]);r!=null&&s(e,["codeExecution"],r);const l=a(t,["functionDeclarations"]);return l!=null&&s(e,["functionDeclarations"],l),e}function fi(o,t){const e={},n=a(t,["retrieval"]);n!=null&&s(e,["retrieval"],n),a(t,["googleSearch"])!=null&&s(e,["googleSearch"],si());const r=a(t,["googleSearchRetrieval"]);r!=null&&s(e,["googleSearchRetrieval"],di(o,r));const l=a(t,["codeExecution"]);l!=null&&s(e,["codeExecution"],l);const d=a(t,["functionDeclarations"]);return d!=null&&s(e,["functionDeclarations"],d),e}function pi(o,t){const e={},n=a(t,["handle"]);if(n!=null&&s(e,["handle"],n),a(t,["transparent"])!==void 0)throw new Error("transparent parameter is not supported in Gemini API.");return e}function hi(o,t){const e={},n=a(t,["handle"]);n!=null&&s(e,["handle"],n);const i=a(t,["transparent"]);return i!=null&&s(e,["transparent"],i),e}function mi(){return{}}function jt(){return{}}function gi(o,t){const e={},n=a(t,["disabled"]);n!=null&&s(e,["disabled"],n);const i=a(t,["startOfSpeechSensitivity"]);i!=null&&s(e,["startOfSpeechSensitivity"],i);const r=a(t,["endOfSpeechSensitivity"]);r!=null&&s(e,["endOfSpeechSensitivity"],r);const l=a(t,["prefixPaddingMs"]);l!=null&&s(e,["prefixPaddingMs"],l);const d=a(t,["silenceDurationMs"]);return d!=null&&s(e,["silenceDurationMs"],d),e}function yi(o,t){const e={},n=a(t,["disabled"]);n!=null&&s(e,["disabled"],n);const i=a(t,["startOfSpeechSensitivity"]);i!=null&&s(e,["startOfSpeechSensitivity"],i);const r=a(t,["endOfSpeechSensitivity"]);r!=null&&s(e,["endOfSpeechSensitivity"],r);const l=a(t,["prefixPaddingMs"]);l!=null&&s(e,["prefixPaddingMs"],l);const d=a(t,["silenceDurationMs"]);return d!=null&&s(e,["silenceDurationMs"],d),e}function vi(o,t){const e={},n=a(t,["automaticActivityDetection"]);n!=null&&s(e,["automaticActivityDetection"],gi(o,n));const i=a(t,["activityHandling"]);i!=null&&s(e,["activityHandling"],i);const r=a(t,["turnCoverage"]);return r!=null&&s(e,["turnCoverage"],r),e}function Ti(o,t){const e={},n=a(t,["automaticActivityDetection"]);n!=null&&s(e,["automaticActivityDetection"],yi(o,n));const i=a(t,["activityHandling"]);i!=null&&s(e,["activityHandling"],i);const r=a(t,["turnCoverage"]);return r!=null&&s(e,["turnCoverage"],r),e}function bi(o,t){const e={},n=a(t,["targetTokens"]);return n!=null&&s(e,["targetTokens"],n),e}function Ei(o,t){const e={},n=a(t,["targetTokens"]);return n!=null&&s(e,["targetTokens"],n),e}function Ci(o,t){const e={},n=a(t,["triggerTokens"]);n!=null&&s(e,["triggerTokens"],n);const i=a(t,["slidingWindow"]);return i!=null&&s(e,["slidingWindow"],bi(o,i)),e}function wi(o,t){const e={},n=a(t,["triggerTokens"]);n!=null&&s(e,["triggerTokens"],n);const i=a(t,["slidingWindow"]);return i!=null&&s(e,["slidingWindow"],Ei(o,i)),e}function Si(o,t,e){const n={},i=a(t,["generationConfig"]);e!==void 0&&i!=null&&s(e,["setup","generationConfig"],i);const r=a(t,["responseModalities"]);e!==void 0&&r!=null&&s(e,["setup","generationConfig","responseModalities"],r);const l=a(t,["temperature"]);e!==void 0&&l!=null&&s(e,["setup","generationConfig","temperature"],l);const d=a(t,["topP"]);e!==void 0&&d!=null&&s(e,["setup","generationConfig","topP"],d);const c=a(t,["topK"]);e!==void 0&&c!=null&&s(e,["setup","generationConfig","topK"],c);const u=a(t,["maxOutputTokens"]);e!==void 0&&u!=null&&s(e,["setup","generationConfig","maxOutputTokens"],u);const f=a(t,["mediaResolution"]);e!==void 0&&f!=null&&s(e,["setup","generationConfig","mediaResolution"],f);const p=a(t,["seed"]);e!==void 0&&p!=null&&s(e,["setup","generationConfig","seed"],p);const h=a(t,["speechConfig"]);e!==void 0&&h!=null&&s(e,["setup","generationConfig","speechConfig"],h);const g=a(t,["systemInstruction"]);e!==void 0&&g!=null&&s(e,["setup","systemInstruction"],oi(o,L(o,g)));const y=a(t,["tools"]);if(e!==void 0&&y!=null){let _=qe(o,y);Array.isArray(_)&&(_=_.map(C=>ci(o,Ve(o,C)))),s(e,["setup","tools"],_)}const T=a(t,["sessionResumption"]);if(e!==void 0&&T!=null&&s(e,["setup","sessionResumption"],pi(o,T)),a(t,["inputAudioTranscription"])!==void 0)throw new Error("inputAudioTranscription parameter is not supported in Gemini API.");const E=a(t,["outputAudioTranscription"]);e!==void 0&&E!=null&&s(e,["setup","outputAudioTranscription"],mi());const w=a(t,["realtimeInputConfig"]);e!==void 0&&w!=null&&s(e,["setup","realtimeInputConfig"],vi(o,w));const S=a(t,["contextWindowCompression"]);return e!==void 0&&S!=null&&s(e,["setup","contextWindowCompression"],Ci(o,S)),n}function Ii(o,t,e){const n={},i=a(t,["generationConfig"]);e!==void 0&&i!=null&&s(e,["setup","generationConfig"],i);const r=a(t,["responseModalities"]);e!==void 0&&r!=null&&s(e,["setup","generationConfig","responseModalities"],r);const l=a(t,["temperature"]);e!==void 0&&l!=null&&s(e,["setup","generationConfig","temperature"],l);const d=a(t,["topP"]);e!==void 0&&d!=null&&s(e,["setup","generationConfig","topP"],d);const c=a(t,["topK"]);e!==void 0&&c!=null&&s(e,["setup","generationConfig","topK"],c);const u=a(t,["maxOutputTokens"]);e!==void 0&&u!=null&&s(e,["setup","generationConfig","maxOutputTokens"],u);const f=a(t,["mediaResolution"]);e!==void 0&&f!=null&&s(e,["setup","generationConfig","mediaResolution"],f);const p=a(t,["seed"]);e!==void 0&&p!=null&&s(e,["setup","generationConfig","seed"],p);const h=a(t,["speechConfig"]);e!==void 0&&h!=null&&s(e,["setup","generationConfig","speechConfig"],h);const g=a(t,["systemInstruction"]);e!==void 0&&g!=null&&s(e,["setup","systemInstruction"],ii(o,L(o,g)));const y=a(t,["tools"]);if(e!==void 0&&y!=null){let C=qe(o,y);Array.isArray(C)&&(C=C.map(x=>fi(o,Ve(o,x)))),s(e,["setup","tools"],C)}const T=a(t,["sessionResumption"]);e!==void 0&&T!=null&&s(e,["setup","sessionResumption"],hi(o,T));const E=a(t,["inputAudioTranscription"]);e!==void 0&&E!=null&&s(e,["setup","inputAudioTranscription"],jt());const w=a(t,["outputAudioTranscription"]);e!==void 0&&w!=null&&s(e,["setup","outputAudioTranscription"],jt());const S=a(t,["realtimeInputConfig"]);e!==void 0&&S!=null&&s(e,["setup","realtimeInputConfig"],Ti(o,S));const _=a(t,["contextWindowCompression"]);return e!==void 0&&_!=null&&s(e,["setup","contextWindowCompression"],wi(o,_)),n}function _i(o,t){const e={},n=a(t,["model"]);n!=null&&s(e,["setup","model"],M(o,n));const i=a(t,["config"]);return i!=null&&s(e,["config"],Si(o,i,e)),e}function Ai(o,t){const e={},n=a(t,["model"]);n!=null&&s(e,["setup","model"],M(o,n));const i=a(t,["config"]);return i!=null&&s(e,["config"],Ii(o,i,e)),e}function Mi(){return{}}function ki(){return{}}function xi(){return{}}function Ri(){return{}}function Pi(o,t){const e={},n=a(t,["media"]);n!=null&&s(e,["mediaChunks"],En(o,n));const i=a(t,["audio"]);i!=null&&s(e,["audio"],Xn(o,i));const r=a(t,["audioStreamEnd"]);r!=null&&s(e,["audioStreamEnd"],r);const l=a(t,["video"]);l!=null&&s(e,["video"],zn(o,l));const d=a(t,["text"]);return d!=null&&s(e,["text"],d),a(t,["activityStart"])!=null&&s(e,["activityStart"],Mi()),a(t,["activityEnd"])!=null&&s(e,["activityEnd"],xi()),e}function Di(o,t){const e={},n=a(t,["media"]);if(n!=null&&s(e,["mediaChunks"],En(o,n)),a(t,["audio"])!==void 0)throw new Error("audio parameter is not supported in Vertex AI.");const i=a(t,["audioStreamEnd"]);if(i!=null&&s(e,["audioStreamEnd"],i),a(t,["video"])!==void 0)throw new Error("video parameter is not supported in Vertex AI.");if(a(t,["text"])!==void 0)throw new Error("text parameter is not supported in Vertex AI.");return a(t,["activityStart"])!=null&&s(e,["activityStart"],ki()),a(t,["activityEnd"])!=null&&s(e,["activityEnd"],Ri()),e}function Li(){return{}}function Ni(){return{}}function Bi(o,t){const e={},n=a(t,["thought"]);n!=null&&s(e,["thought"],n);const i=a(t,["codeExecutionResult"]);i!=null&&s(e,["codeExecutionResult"],i);const r=a(t,["executableCode"]);r!=null&&s(e,["executableCode"],r);const l=a(t,["fileData"]);l!=null&&s(e,["fileData"],l);const d=a(t,["functionCall"]);d!=null&&s(e,["functionCall"],d);const c=a(t,["functionResponse"]);c!=null&&s(e,["functionResponse"],c);const u=a(t,["inlineData"]);u!=null&&s(e,["inlineData"],u);const f=a(t,["text"]);return f!=null&&s(e,["text"],f),e}function Ui(o,t){const e={},n=a(t,["videoMetadata"]);n!=null&&s(e,["videoMetadata"],n);const i=a(t,["thought"]);i!=null&&s(e,["thought"],i);const r=a(t,["codeExecutionResult"]);r!=null&&s(e,["codeExecutionResult"],r);const l=a(t,["executableCode"]);l!=null&&s(e,["executableCode"],l);const d=a(t,["fileData"]);d!=null&&s(e,["fileData"],d);const c=a(t,["functionCall"]);c!=null&&s(e,["functionCall"],c);const u=a(t,["functionResponse"]);u!=null&&s(e,["functionResponse"],u);const f=a(t,["inlineData"]);f!=null&&s(e,["inlineData"],f);const p=a(t,["text"]);return p!=null&&s(e,["text"],p),e}function Fi(o,t){const e={},n=a(t,["parts"]);if(n!=null){let r=n;Array.isArray(r)&&(r=r.map(l=>Bi(o,l))),s(e,["parts"],r)}const i=a(t,["role"]);return i!=null&&s(e,["role"],i),e}function Vi(o,t){const e={},n=a(t,["parts"]);if(n!=null){let r=n;Array.isArray(r)&&(r=r.map(l=>Ui(o,l))),s(e,["parts"],r)}const i=a(t,["role"]);return i!=null&&s(e,["role"],i),e}function en(o,t){const e={},n=a(t,["text"]);n!=null&&s(e,["text"],n);const i=a(t,["finished"]);return i!=null&&s(e,["finished"],i),e}function tn(o,t){const e={},n=a(t,["text"]);n!=null&&s(e,["text"],n);const i=a(t,["finished"]);return i!=null&&s(e,["finished"],i),e}function qi(o,t){const e={},n=a(t,["modelTurn"]);n!=null&&s(e,["modelTurn"],Fi(o,n));const i=a(t,["turnComplete"]);i!=null&&s(e,["turnComplete"],i);const r=a(t,["interrupted"]);r!=null&&s(e,["interrupted"],r);const l=a(t,["groundingMetadata"]);l!=null&&s(e,["groundingMetadata"],l);const d=a(t,["generationComplete"]);d!=null&&s(e,["generationComplete"],d);const c=a(t,["inputTranscription"]);c!=null&&s(e,["inputTranscription"],en(o,c));const u=a(t,["outputTranscription"]);return u!=null&&s(e,["outputTranscription"],en(o,u)),e}function Gi(o,t){const e={},n=a(t,["modelTurn"]);n!=null&&s(e,["modelTurn"],Vi(o,n));const i=a(t,["turnComplete"]);i!=null&&s(e,["turnComplete"],i);const r=a(t,["interrupted"]);r!=null&&s(e,["interrupted"],r);const l=a(t,["groundingMetadata"]);l!=null&&s(e,["groundingMetadata"],l);const d=a(t,["generationComplete"]);d!=null&&s(e,["generationComplete"],d);const c=a(t,["inputTranscription"]);c!=null&&s(e,["inputTranscription"],tn(o,c));const u=a(t,["outputTranscription"]);return u!=null&&s(e,["outputTranscription"],tn(o,u)),e}function Hi(o,t){const e={},n=a(t,["id"]);n!=null&&s(e,["id"],n);const i=a(t,["args"]);i!=null&&s(e,["args"],i);const r=a(t,["name"]);return r!=null&&s(e,["name"],r),e}function $i(o,t){const e={},n=a(t,["args"]);n!=null&&s(e,["args"],n);const i=a(t,["name"]);return i!=null&&s(e,["name"],i),e}function Yi(o,t){const e={},n=a(t,["functionCalls"]);if(n!=null){let i=n;Array.isArray(i)&&(i=i.map(r=>Hi(o,r))),s(e,["functionCalls"],i)}return e}function Ji(o,t){const e={},n=a(t,["functionCalls"]);if(n!=null){let i=n;Array.isArray(i)&&(i=i.map(r=>$i(o,r))),s(e,["functionCalls"],i)}return e}function Oi(o,t){const e={},n=a(t,["ids"]);return n!=null&&s(e,["ids"],n),e}function Ki(o,t){const e={},n=a(t,["ids"]);return n!=null&&s(e,["ids"],n),e}function ke(o,t){const e={},n=a(t,["modality"]);n!=null&&s(e,["modality"],n);const i=a(t,["tokenCount"]);return i!=null&&s(e,["tokenCount"],i),e}function xe(o,t){const e={},n=a(t,["modality"]);n!=null&&s(e,["modality"],n);const i=a(t,["tokenCount"]);return i!=null&&s(e,["tokenCount"],i),e}function Wi(o,t){const e={},n=a(t,["promptTokenCount"]);n!=null&&s(e,["promptTokenCount"],n);const i=a(t,["cachedContentTokenCount"]);i!=null&&s(e,["cachedContentTokenCount"],i);const r=a(t,["responseTokenCount"]);r!=null&&s(e,["responseTokenCount"],r);const l=a(t,["toolUsePromptTokenCount"]);l!=null&&s(e,["toolUsePromptTokenCount"],l);const d=a(t,["thoughtsTokenCount"]);d!=null&&s(e,["thoughtsTokenCount"],d);const c=a(t,["totalTokenCount"]);c!=null&&s(e,["totalTokenCount"],c);const u=a(t,["promptTokensDetails"]);if(u!=null){let g=u;Array.isArray(g)&&(g=g.map(y=>ke(o,y))),s(e,["promptTokensDetails"],g)}const f=a(t,["cacheTokensDetails"]);if(f!=null){let g=f;Array.isArray(g)&&(g=g.map(y=>ke(o,y))),s(e,["cacheTokensDetails"],g)}const p=a(t,["responseTokensDetails"]);if(p!=null){let g=p;Array.isArray(g)&&(g=g.map(y=>ke(o,y))),s(e,["responseTokensDetails"],g)}const h=a(t,["toolUsePromptTokensDetails"]);if(h!=null){let g=h;Array.isArray(g)&&(g=g.map(y=>ke(o,y))),s(e,["toolUsePromptTokensDetails"],g)}return e}function zi(o,t){const e={},n=a(t,["promptTokenCount"]);n!=null&&s(e,["promptTokenCount"],n);const i=a(t,["cachedContentTokenCount"]);i!=null&&s(e,["cachedContentTokenCount"],i);const r=a(t,["candidatesTokenCount"]);r!=null&&s(e,["responseTokenCount"],r);const l=a(t,["toolUsePromptTokenCount"]);l!=null&&s(e,["toolUsePromptTokenCount"],l);const d=a(t,["thoughtsTokenCount"]);d!=null&&s(e,["thoughtsTokenCount"],d);const c=a(t,["totalTokenCount"]);c!=null&&s(e,["totalTokenCount"],c);const u=a(t,["promptTokensDetails"]);if(u!=null){let y=u;Array.isArray(y)&&(y=y.map(T=>xe(o,T))),s(e,["promptTokensDetails"],y)}const f=a(t,["cacheTokensDetails"]);if(f!=null){let y=f;Array.isArray(y)&&(y=y.map(T=>xe(o,T))),s(e,["cacheTokensDetails"],y)}const p=a(t,["candidatesTokensDetails"]);if(p!=null){let y=p;Array.isArray(y)&&(y=y.map(T=>xe(o,T))),s(e,["responseTokensDetails"],y)}const h=a(t,["toolUsePromptTokensDetails"]);if(h!=null){let y=h;Array.isArray(y)&&(y=y.map(T=>xe(o,T))),s(e,["toolUsePromptTokensDetails"],y)}const g=a(t,["trafficType"]);return g!=null&&s(e,["trafficType"],g),e}function Xi(o,t){const e={},n=a(t,["timeLeft"]);return n!=null&&s(e,["timeLeft"],n),e}function Zi(o,t){const e={},n=a(t,["timeLeft"]);return n!=null&&s(e,["timeLeft"],n),e}function Qi(o,t){const e={},n=a(t,["newHandle"]);n!=null&&s(e,["newHandle"],n);const i=a(t,["resumable"]);i!=null&&s(e,["resumable"],i);const r=a(t,["lastConsumedClientMessageIndex"]);return r!=null&&s(e,["lastConsumedClientMessageIndex"],r),e}function ji(o,t){const e={},n=a(t,["newHandle"]);n!=null&&s(e,["newHandle"],n);const i=a(t,["resumable"]);i!=null&&s(e,["resumable"],i);const r=a(t,["lastConsumedClientMessageIndex"]);return r!=null&&s(e,["lastConsumedClientMessageIndex"],r),e}function ea(o,t){const e={};a(t,["setupComplete"])!=null&&s(e,["setupComplete"],Li());const i=a(t,["serverContent"]);i!=null&&s(e,["serverContent"],qi(o,i));const r=a(t,["toolCall"]);r!=null&&s(e,["toolCall"],Yi(o,r));const l=a(t,["toolCallCancellation"]);l!=null&&s(e,["toolCallCancellation"],Oi(o,l));const d=a(t,["usageMetadata"]);d!=null&&s(e,["usageMetadata"],Wi(o,d));const c=a(t,["goAway"]);c!=null&&s(e,["goAway"],Xi(o,c));const u=a(t,["sessionResumptionUpdate"]);return u!=null&&s(e,["sessionResumptionUpdate"],Qi(o,u)),e}function ta(o,t){const e={};a(t,["setupComplete"])!=null&&s(e,["setupComplete"],Ni());const i=a(t,["serverContent"]);i!=null&&s(e,["serverContent"],Gi(o,i));const r=a(t,["toolCall"]);r!=null&&s(e,["toolCall"],Ji(o,r));const l=a(t,["toolCallCancellation"]);l!=null&&s(e,["toolCallCancellation"],Ki(o,l));const d=a(t,["usageMetadata"]);d!=null&&s(e,["usageMetadata"],zi(o,d));const c=a(t,["goAway"]);c!=null&&s(e,["goAway"],Zi(o,c));const u=a(t,["sessionResumptionUpdate"]);return u!=null&&s(e,["sessionResumptionUpdate"],ji(o,u)),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function na(o,t){const e={};if(a(t,["videoMetadata"])!==void 0)throw new Error("videoMetadata parameter is not supported in Gemini API.");const n=a(t,["thought"]);n!=null&&s(e,["thought"],n);const i=a(t,["codeExecutionResult"]);i!=null&&s(e,["codeExecutionResult"],i);const r=a(t,["executableCode"]);r!=null&&s(e,["executableCode"],r);const l=a(t,["fileData"]);l!=null&&s(e,["fileData"],l);const d=a(t,["functionCall"]);d!=null&&s(e,["functionCall"],d);const c=a(t,["functionResponse"]);c!=null&&s(e,["functionResponse"],c);const u=a(t,["inlineData"]);u!=null&&s(e,["inlineData"],u);const f=a(t,["text"]);return f!=null&&s(e,["text"],f),e}function Ge(o,t){const e={},n=a(t,["parts"]);if(n!=null){let r=n;Array.isArray(r)&&(r=r.map(l=>na(o,l))),s(e,["parts"],r)}const i=a(t,["role"]);return i!=null&&s(e,["role"],i),e}function oa(o,t){const e={};if(a(t,["method"])!==void 0)throw new Error("method parameter is not supported in Gemini API.");const n=a(t,["category"]);n!=null&&s(e,["category"],n);const i=a(t,["threshold"]);return i!=null&&s(e,["threshold"],i),e}function ia(){return{}}function aa(o,t){const e={},n=a(t,["mode"]);n!=null&&s(e,["mode"],n);const i=a(t,["dynamicThreshold"]);return i!=null&&s(e,["dynamicThreshold"],i),e}function sa(o,t){const e={},n=a(t,["dynamicRetrievalConfig"]);return n!=null&&s(e,["dynamicRetrievalConfig"],aa(o,n)),e}function ra(o,t){const e={};if(a(t,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");a(t,["googleSearch"])!=null&&s(e,["googleSearch"],ia());const i=a(t,["googleSearchRetrieval"]);i!=null&&s(e,["googleSearchRetrieval"],sa(o,i));const r=a(t,["codeExecution"]);r!=null&&s(e,["codeExecution"],r);const l=a(t,["functionDeclarations"]);return l!=null&&s(e,["functionDeclarations"],l),e}function la(o,t){const e={},n=a(t,["mode"]);n!=null&&s(e,["mode"],n);const i=a(t,["allowedFunctionNames"]);return i!=null&&s(e,["allowedFunctionNames"],i),e}function ua(o,t){const e={},n=a(t,["functionCallingConfig"]);return n!=null&&s(e,["functionCallingConfig"],la(o,n)),e}function da(o,t){const e={},n=a(t,["voiceName"]);return n!=null&&s(e,["voiceName"],n),e}function ca(o,t){const e={},n=a(t,["prebuiltVoiceConfig"]);return n!=null&&s(e,["prebuiltVoiceConfig"],da(o,n)),e}function fa(o,t){const e={},n=a(t,["voiceConfig"]);n!=null&&s(e,["voiceConfig"],ca(o,n));const i=a(t,["languageCode"]);return i!=null&&s(e,["languageCode"],i),e}function pa(o,t){const e={},n=a(t,["includeThoughts"]);n!=null&&s(e,["includeThoughts"],n);const i=a(t,["thinkingBudget"]);return i!=null&&s(e,["thinkingBudget"],i),e}function ha(o,t,e){const n={},i=a(t,["systemInstruction"]);e!==void 0&&i!=null&&s(e,["systemInstruction"],Ge(o,L(o,i)));const r=a(t,["temperature"]);r!=null&&s(n,["temperature"],r);const l=a(t,["topP"]);l!=null&&s(n,["topP"],l);const d=a(t,["topK"]);d!=null&&s(n,["topK"],d);const c=a(t,["candidateCount"]);c!=null&&s(n,["candidateCount"],c);const u=a(t,["maxOutputTokens"]);u!=null&&s(n,["maxOutputTokens"],u);const f=a(t,["stopSequences"]);f!=null&&s(n,["stopSequences"],f);const p=a(t,["responseLogprobs"]);p!=null&&s(n,["responseLogprobs"],p);const h=a(t,["logprobs"]);h!=null&&s(n,["logprobs"],h);const g=a(t,["presencePenalty"]);g!=null&&s(n,["presencePenalty"],g);const y=a(t,["frequencyPenalty"]);y!=null&&s(n,["frequencyPenalty"],y);const T=a(t,["seed"]);T!=null&&s(n,["seed"],T);const E=a(t,["responseMimeType"]);E!=null&&s(n,["responseMimeType"],E);const w=a(t,["responseSchema"]);if(w!=null&&s(n,["responseSchema"],Sn(o,w)),a(t,["routingConfig"])!==void 0)throw new Error("routingConfig parameter is not supported in Gemini API.");if(a(t,["modelSelectionConfig"])!==void 0)throw new Error("modelSelectionConfig parameter is not supported in Gemini API.");const S=a(t,["safetySettings"]);if(e!==void 0&&S!=null){let D=S;Array.isArray(D)&&(D=D.map(Y=>oa(o,Y))),s(e,["safetySettings"],D)}const _=a(t,["tools"]);if(e!==void 0&&_!=null){let D=qe(o,_);Array.isArray(D)&&(D=D.map(Y=>ra(o,Ve(o,Y)))),s(e,["tools"],D)}const C=a(t,["toolConfig"]);if(e!==void 0&&C!=null&&s(e,["toolConfig"],ua(o,C)),a(t,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");const x=a(t,["cachedContent"]);e!==void 0&&x!=null&&s(e,["cachedContent"],Q(o,x));const ee=a(t,["responseModalities"]);ee!=null&&s(n,["responseModalities"],ee);const te=a(t,["mediaResolution"]);te!=null&&s(n,["mediaResolution"],te);const ne=a(t,["speechConfig"]);if(ne!=null&&s(n,["speechConfig"],fa(o,In(o,ne))),a(t,["audioTimestamp"])!==void 0)throw new Error("audioTimestamp parameter is not supported in Gemini API.");const oe=a(t,["thinkingConfig"]);return oe!=null&&s(n,["thinkingConfig"],pa(o,oe)),n}function nn(o,t){const e={},n=a(t,["model"]);n!=null&&s(e,["_url","model"],M(o,n));const i=a(t,["contents"]);if(i!=null){let l=Z(o,i);Array.isArray(l)&&(l=l.map(d=>Ge(o,d))),s(e,["contents"],l)}const r=a(t,["config"]);return r!=null&&s(e,["generationConfig"],ha(o,r,e)),e}function ma(o,t,e){const n={},i=a(t,["taskType"]);e!==void 0&&i!=null&&s(e,["requests[]","taskType"],i);const r=a(t,["title"]);e!==void 0&&r!=null&&s(e,["requests[]","title"],r);const l=a(t,["outputDimensionality"]);if(e!==void 0&&l!=null&&s(e,["requests[]","outputDimensionality"],l),a(t,["mimeType"])!==void 0)throw new Error("mimeType parameter is not supported in Gemini API.");if(a(t,["autoTruncate"])!==void 0)throw new Error("autoTruncate parameter is not supported in Gemini API.");return n}function ga(o,t){const e={},n=a(t,["model"]);n!=null&&s(e,["_url","model"],M(o,n));const i=a(t,["contents"]);i!=null&&s(e,["requests[]","content"],wn(o,i));const r=a(t,["config"]);r!=null&&s(e,["config"],ma(o,r,e));const l=a(t,["model"]);return l!==void 0&&s(e,["requests[]","model"],M(o,l)),e}function ya(o,t,e){const n={};if(a(t,["outputGcsUri"])!==void 0)throw new Error("outputGcsUri parameter is not supported in Gemini API.");if(a(t,["negativePrompt"])!==void 0)throw new Error("negativePrompt parameter is not supported in Gemini API.");const i=a(t,["numberOfImages"]);e!==void 0&&i!=null&&s(e,["parameters","sampleCount"],i);const r=a(t,["aspectRatio"]);e!==void 0&&r!=null&&s(e,["parameters","aspectRatio"],r);const l=a(t,["guidanceScale"]);if(e!==void 0&&l!=null&&s(e,["parameters","guidanceScale"],l),a(t,["seed"])!==void 0)throw new Error("seed parameter is not supported in Gemini API.");const d=a(t,["safetyFilterLevel"]);e!==void 0&&d!=null&&s(e,["parameters","safetySetting"],d);const c=a(t,["personGeneration"]);e!==void 0&&c!=null&&s(e,["parameters","personGeneration"],c);const u=a(t,["includeSafetyAttributes"]);e!==void 0&&u!=null&&s(e,["parameters","includeSafetyAttributes"],u);const f=a(t,["includeRaiReason"]);e!==void 0&&f!=null&&s(e,["parameters","includeRaiReason"],f);const p=a(t,["language"]);e!==void 0&&p!=null&&s(e,["parameters","language"],p);const h=a(t,["outputMimeType"]);e!==void 0&&h!=null&&s(e,["parameters","outputOptions","mimeType"],h);const g=a(t,["outputCompressionQuality"]);if(e!==void 0&&g!=null&&s(e,["parameters","outputOptions","compressionQuality"],g),a(t,["addWatermark"])!==void 0)throw new Error("addWatermark parameter is not supported in Gemini API.");if(a(t,["enhancePrompt"])!==void 0)throw new Error("enhancePrompt parameter is not supported in Gemini API.");return n}function va(o,t){const e={},n=a(t,["model"]);n!=null&&s(e,["_url","model"],M(o,n));const i=a(t,["prompt"]);i!=null&&s(e,["instances[0]","prompt"],i);const r=a(t,["config"]);return r!=null&&s(e,["config"],ya(o,r,e)),e}function Ta(o,t){const e={},n=a(t,["model"]);n!=null&&s(e,["_url","name"],M(o,n));const i=a(t,["config"]);return i!=null&&s(e,["config"],i),e}function ba(o,t,e){const n={},i=a(t,["displayName"]);e!==void 0&&i!=null&&s(e,["displayName"],i);const r=a(t,["description"]);return e!==void 0&&r!=null&&s(e,["description"],r),n}function Ea(o,t){const e={},n=a(t,["model"]);n!=null&&s(e,["_url","name"],M(o,n));const i=a(t,["config"]);return i!=null&&s(e,["config"],ba(o,i,e)),e}function Ca(o,t){const e={},n=a(t,["model"]);n!=null&&s(e,["_url","name"],M(o,n));const i=a(t,["config"]);return i!=null&&s(e,["config"],i),e}function wa(o,t){const e={};if(a(t,["systemInstruction"])!==void 0)throw new Error("systemInstruction parameter is not supported in Gemini API.");if(a(t,["tools"])!==void 0)throw new Error("tools parameter is not supported in Gemini API.");if(a(t,["generationConfig"])!==void 0)throw new Error("generationConfig parameter is not supported in Gemini API.");return e}function Sa(o,t){const e={},n=a(t,["model"]);n!=null&&s(e,["_url","model"],M(o,n));const i=a(t,["contents"]);if(i!=null){let l=Z(o,i);Array.isArray(l)&&(l=l.map(d=>Ge(o,d))),s(e,["contents"],l)}const r=a(t,["config"]);return r!=null&&s(e,["config"],wa(o,r)),e}function Ia(o,t){const e={};if(a(t,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");const n=a(t,["imageBytes"]);n!=null&&s(e,["bytesBase64Encoded"],j(o,n));const i=a(t,["mimeType"]);return i!=null&&s(e,["mimeType"],i),e}function _a(o,t,e){const n={},i=a(t,["numberOfVideos"]);if(e!==void 0&&i!=null&&s(e,["parameters","sampleCount"],i),a(t,["outputGcsUri"])!==void 0)throw new Error("outputGcsUri parameter is not supported in Gemini API.");if(a(t,["fps"])!==void 0)throw new Error("fps parameter is not supported in Gemini API.");const r=a(t,["durationSeconds"]);if(e!==void 0&&r!=null&&s(e,["parameters","durationSeconds"],r),a(t,["seed"])!==void 0)throw new Error("seed parameter is not supported in Gemini API.");const l=a(t,["aspectRatio"]);if(e!==void 0&&l!=null&&s(e,["parameters","aspectRatio"],l),a(t,["resolution"])!==void 0)throw new Error("resolution parameter is not supported in Gemini API.");const d=a(t,["personGeneration"]);if(e!==void 0&&d!=null&&s(e,["parameters","personGeneration"],d),a(t,["pubsubTopic"])!==void 0)throw new Error("pubsubTopic parameter is not supported in Gemini API.");const c=a(t,["negativePrompt"]);if(e!==void 0&&c!=null&&s(e,["parameters","negativePrompt"],c),a(t,["enhancePrompt"])!==void 0)throw new Error("enhancePrompt parameter is not supported in Gemini API.");return n}function Aa(o,t){const e={},n=a(t,["model"]);n!=null&&s(e,["_url","model"],M(o,n));const i=a(t,["prompt"]);i!=null&&s(e,["instances[0]","prompt"],i);const r=a(t,["image"]);r!=null&&s(e,["instances[0]","image"],Ia(o,r));const l=a(t,["config"]);return l!=null&&s(e,["config"],_a(o,l,e)),e}function Ma(o,t){const e={},n=a(t,["videoMetadata"]);n!=null&&s(e,["videoMetadata"],n);const i=a(t,["thought"]);i!=null&&s(e,["thought"],i);const r=a(t,["codeExecutionResult"]);r!=null&&s(e,["codeExecutionResult"],r);const l=a(t,["executableCode"]);l!=null&&s(e,["executableCode"],l);const d=a(t,["fileData"]);d!=null&&s(e,["fileData"],d);const c=a(t,["functionCall"]);c!=null&&s(e,["functionCall"],c);const u=a(t,["functionResponse"]);u!=null&&s(e,["functionResponse"],u);const f=a(t,["inlineData"]);f!=null&&s(e,["inlineData"],f);const p=a(t,["text"]);return p!=null&&s(e,["text"],p),e}function ue(o,t){const e={},n=a(t,["parts"]);if(n!=null){let r=n;Array.isArray(r)&&(r=r.map(l=>Ma(o,l))),s(e,["parts"],r)}const i=a(t,["role"]);return i!=null&&s(e,["role"],i),e}function ka(o,t){const e={},n=a(t,["featureSelectionPreference"]);return n!=null&&s(e,["featureSelectionPreference"],n),e}function xa(o,t){const e={},n=a(t,["method"]);n!=null&&s(e,["method"],n);const i=a(t,["category"]);i!=null&&s(e,["category"],i);const r=a(t,["threshold"]);return r!=null&&s(e,["threshold"],r),e}function Ra(){return{}}function Pa(o,t){const e={},n=a(t,["mode"]);n!=null&&s(e,["mode"],n);const i=a(t,["dynamicThreshold"]);return i!=null&&s(e,["dynamicThreshold"],i),e}function Da(o,t){const e={},n=a(t,["dynamicRetrievalConfig"]);return n!=null&&s(e,["dynamicRetrievalConfig"],Pa(o,n)),e}function kn(o,t){const e={},n=a(t,["retrieval"]);n!=null&&s(e,["retrieval"],n),a(t,["googleSearch"])!=null&&s(e,["googleSearch"],Ra());const r=a(t,["googleSearchRetrieval"]);r!=null&&s(e,["googleSearchRetrieval"],Da(o,r));const l=a(t,["codeExecution"]);l!=null&&s(e,["codeExecution"],l);const d=a(t,["functionDeclarations"]);return d!=null&&s(e,["functionDeclarations"],d),e}function La(o,t){const e={},n=a(t,["mode"]);n!=null&&s(e,["mode"],n);const i=a(t,["allowedFunctionNames"]);return i!=null&&s(e,["allowedFunctionNames"],i),e}function Na(o,t){const e={},n=a(t,["functionCallingConfig"]);return n!=null&&s(e,["functionCallingConfig"],La(o,n)),e}function Ba(o,t){const e={},n=a(t,["voiceName"]);return n!=null&&s(e,["voiceName"],n),e}function Ua(o,t){const e={},n=a(t,["prebuiltVoiceConfig"]);return n!=null&&s(e,["prebuiltVoiceConfig"],Ba(o,n)),e}function Fa(o,t){const e={},n=a(t,["voiceConfig"]);n!=null&&s(e,["voiceConfig"],Ua(o,n));const i=a(t,["languageCode"]);return i!=null&&s(e,["languageCode"],i),e}function Va(o,t){const e={},n=a(t,["includeThoughts"]);n!=null&&s(e,["includeThoughts"],n);const i=a(t,["thinkingBudget"]);return i!=null&&s(e,["thinkingBudget"],i),e}function qa(o,t,e){const n={},i=a(t,["systemInstruction"]);e!==void 0&&i!=null&&s(e,["systemInstruction"],ue(o,L(o,i)));const r=a(t,["temperature"]);r!=null&&s(n,["temperature"],r);const l=a(t,["topP"]);l!=null&&s(n,["topP"],l);const d=a(t,["topK"]);d!=null&&s(n,["topK"],d);const c=a(t,["candidateCount"]);c!=null&&s(n,["candidateCount"],c);const u=a(t,["maxOutputTokens"]);u!=null&&s(n,["maxOutputTokens"],u);const f=a(t,["stopSequences"]);f!=null&&s(n,["stopSequences"],f);const p=a(t,["responseLogprobs"]);p!=null&&s(n,["responseLogprobs"],p);const h=a(t,["logprobs"]);h!=null&&s(n,["logprobs"],h);const g=a(t,["presencePenalty"]);g!=null&&s(n,["presencePenalty"],g);const y=a(t,["frequencyPenalty"]);y!=null&&s(n,["frequencyPenalty"],y);const T=a(t,["seed"]);T!=null&&s(n,["seed"],T);const E=a(t,["responseMimeType"]);E!=null&&s(n,["responseMimeType"],E);const w=a(t,["responseSchema"]);w!=null&&s(n,["responseSchema"],Sn(o,w));const S=a(t,["routingConfig"]);S!=null&&s(n,["routingConfig"],S);const _=a(t,["modelSelectionConfig"]);_!=null&&s(n,["modelConfig"],ka(o,_));const C=a(t,["safetySettings"]);if(e!==void 0&&C!=null){let B=C;Array.isArray(B)&&(B=B.map(ce=>xa(o,ce))),s(e,["safetySettings"],B)}const x=a(t,["tools"]);if(e!==void 0&&x!=null){let B=qe(o,x);Array.isArray(B)&&(B=B.map(ce=>kn(o,Ve(o,ce)))),s(e,["tools"],B)}const ee=a(t,["toolConfig"]);e!==void 0&&ee!=null&&s(e,["toolConfig"],Na(o,ee));const te=a(t,["labels"]);e!==void 0&&te!=null&&s(e,["labels"],te);const ne=a(t,["cachedContent"]);e!==void 0&&ne!=null&&s(e,["cachedContent"],Q(o,ne));const oe=a(t,["responseModalities"]);oe!=null&&s(n,["responseModalities"],oe);const D=a(t,["mediaResolution"]);D!=null&&s(n,["mediaResolution"],D);const Y=a(t,["speechConfig"]);Y!=null&&s(n,["speechConfig"],Fa(o,In(o,Y)));const _e=a(t,["audioTimestamp"]);_e!=null&&s(n,["audioTimestamp"],_e);const Ae=a(t,["thinkingConfig"]);return Ae!=null&&s(n,["thinkingConfig"],Va(o,Ae)),n}function on(o,t){const e={},n=a(t,["model"]);n!=null&&s(e,["_url","model"],M(o,n));const i=a(t,["contents"]);if(i!=null){let l=Z(o,i);Array.isArray(l)&&(l=l.map(d=>ue(o,d))),s(e,["contents"],l)}const r=a(t,["config"]);return r!=null&&s(e,["generationConfig"],qa(o,r,e)),e}function Ga(o,t,e){const n={},i=a(t,["taskType"]);e!==void 0&&i!=null&&s(e,["instances[]","task_type"],i);const r=a(t,["title"]);e!==void 0&&r!=null&&s(e,["instances[]","title"],r);const l=a(t,["outputDimensionality"]);e!==void 0&&l!=null&&s(e,["parameters","outputDimensionality"],l);const d=a(t,["mimeType"]);e!==void 0&&d!=null&&s(e,["instances[]","mimeType"],d);const c=a(t,["autoTruncate"]);return e!==void 0&&c!=null&&s(e,["parameters","autoTruncate"],c),n}function Ha(o,t){const e={},n=a(t,["model"]);n!=null&&s(e,["_url","model"],M(o,n));const i=a(t,["contents"]);i!=null&&s(e,["instances[]","content"],wn(o,i));const r=a(t,["config"]);return r!=null&&s(e,["config"],Ga(o,r,e)),e}function $a(o,t,e){const n={},i=a(t,["outputGcsUri"]);e!==void 0&&i!=null&&s(e,["parameters","storageUri"],i);const r=a(t,["negativePrompt"]);e!==void 0&&r!=null&&s(e,["parameters","negativePrompt"],r);const l=a(t,["numberOfImages"]);e!==void 0&&l!=null&&s(e,["parameters","sampleCount"],l);const d=a(t,["aspectRatio"]);e!==void 0&&d!=null&&s(e,["parameters","aspectRatio"],d);const c=a(t,["guidanceScale"]);e!==void 0&&c!=null&&s(e,["parameters","guidanceScale"],c);const u=a(t,["seed"]);e!==void 0&&u!=null&&s(e,["parameters","seed"],u);const f=a(t,["safetyFilterLevel"]);e!==void 0&&f!=null&&s(e,["parameters","safetySetting"],f);const p=a(t,["personGeneration"]);e!==void 0&&p!=null&&s(e,["parameters","personGeneration"],p);const h=a(t,["includeSafetyAttributes"]);e!==void 0&&h!=null&&s(e,["parameters","includeSafetyAttributes"],h);const g=a(t,["includeRaiReason"]);e!==void 0&&g!=null&&s(e,["parameters","includeRaiReason"],g);const y=a(t,["language"]);e!==void 0&&y!=null&&s(e,["parameters","language"],y);const T=a(t,["outputMimeType"]);e!==void 0&&T!=null&&s(e,["parameters","outputOptions","mimeType"],T);const E=a(t,["outputCompressionQuality"]);e!==void 0&&E!=null&&s(e,["parameters","outputOptions","compressionQuality"],E);const w=a(t,["addWatermark"]);e!==void 0&&w!=null&&s(e,["parameters","addWatermark"],w);const S=a(t,["enhancePrompt"]);return e!==void 0&&S!=null&&s(e,["parameters","enhancePrompt"],S),n}function Ya(o,t){const e={},n=a(t,["model"]);n!=null&&s(e,["_url","model"],M(o,n));const i=a(t,["prompt"]);i!=null&&s(e,["instances[0]","prompt"],i);const r=a(t,["config"]);return r!=null&&s(e,["config"],$a(o,r,e)),e}function Ja(o,t){const e={},n=a(t,["model"]);n!=null&&s(e,["_url","name"],M(o,n));const i=a(t,["config"]);return i!=null&&s(e,["config"],i),e}function Oa(o,t,e){const n={},i=a(t,["displayName"]);e!==void 0&&i!=null&&s(e,["displayName"],i);const r=a(t,["description"]);return e!==void 0&&r!=null&&s(e,["description"],r),n}function Ka(o,t){const e={},n=a(t,["model"]);n!=null&&s(e,["_url","model"],M(o,n));const i=a(t,["config"]);return i!=null&&s(e,["config"],Oa(o,i,e)),e}function Wa(o,t){const e={},n=a(t,["model"]);n!=null&&s(e,["_url","name"],M(o,n));const i=a(t,["config"]);return i!=null&&s(e,["config"],i),e}function za(o,t,e){const n={},i=a(t,["systemInstruction"]);e!==void 0&&i!=null&&s(e,["systemInstruction"],ue(o,L(o,i)));const r=a(t,["tools"]);if(e!==void 0&&r!=null){let d=r;Array.isArray(d)&&(d=d.map(c=>kn(o,c))),s(e,["tools"],d)}const l=a(t,["generationConfig"]);return e!==void 0&&l!=null&&s(e,["generationConfig"],l),n}function Xa(o,t){const e={},n=a(t,["model"]);n!=null&&s(e,["_url","model"],M(o,n));const i=a(t,["contents"]);if(i!=null){let l=Z(o,i);Array.isArray(l)&&(l=l.map(d=>ue(o,d))),s(e,["contents"],l)}const r=a(t,["config"]);return r!=null&&s(e,["config"],za(o,r,e)),e}function Za(o,t){const e={},n=a(t,["model"]);n!=null&&s(e,["_url","model"],M(o,n));const i=a(t,["contents"]);if(i!=null){let l=Z(o,i);Array.isArray(l)&&(l=l.map(d=>ue(o,d))),s(e,["contents"],l)}const r=a(t,["config"]);return r!=null&&s(e,["config"],r),e}function Qa(o,t){const e={},n=a(t,["gcsUri"]);n!=null&&s(e,["gcsUri"],n);const i=a(t,["imageBytes"]);i!=null&&s(e,["bytesBase64Encoded"],j(o,i));const r=a(t,["mimeType"]);return r!=null&&s(e,["mimeType"],r),e}function ja(o,t,e){const n={},i=a(t,["numberOfVideos"]);e!==void 0&&i!=null&&s(e,["parameters","sampleCount"],i);const r=a(t,["outputGcsUri"]);e!==void 0&&r!=null&&s(e,["parameters","storageUri"],r);const l=a(t,["fps"]);e!==void 0&&l!=null&&s(e,["parameters","fps"],l);const d=a(t,["durationSeconds"]);e!==void 0&&d!=null&&s(e,["parameters","durationSeconds"],d);const c=a(t,["seed"]);e!==void 0&&c!=null&&s(e,["parameters","seed"],c);const u=a(t,["aspectRatio"]);e!==void 0&&u!=null&&s(e,["parameters","aspectRatio"],u);const f=a(t,["resolution"]);e!==void 0&&f!=null&&s(e,["parameters","resolution"],f);const p=a(t,["personGeneration"]);e!==void 0&&p!=null&&s(e,["parameters","personGeneration"],p);const h=a(t,["pubsubTopic"]);e!==void 0&&h!=null&&s(e,["parameters","pubsubTopic"],h);const g=a(t,["negativePrompt"]);e!==void 0&&g!=null&&s(e,["parameters","negativePrompt"],g);const y=a(t,["enhancePrompt"]);return e!==void 0&&y!=null&&s(e,["parameters","enhancePrompt"],y),n}function es(o,t){const e={},n=a(t,["model"]);n!=null&&s(e,["_url","model"],M(o,n));const i=a(t,["prompt"]);i!=null&&s(e,["instances[0]","prompt"],i);const r=a(t,["image"]);r!=null&&s(e,["instances[0]","image"],Qa(o,r));const l=a(t,["config"]);return l!=null&&s(e,["config"],ja(o,l,e)),e}function ts(o,t){const e={},n=a(t,["thought"]);n!=null&&s(e,["thought"],n);const i=a(t,["codeExecutionResult"]);i!=null&&s(e,["codeExecutionResult"],i);const r=a(t,["executableCode"]);r!=null&&s(e,["executableCode"],r);const l=a(t,["fileData"]);l!=null&&s(e,["fileData"],l);const d=a(t,["functionCall"]);d!=null&&s(e,["functionCall"],d);const c=a(t,["functionResponse"]);c!=null&&s(e,["functionResponse"],c);const u=a(t,["inlineData"]);u!=null&&s(e,["inlineData"],u);const f=a(t,["text"]);return f!=null&&s(e,["text"],f),e}function ns(o,t){const e={},n=a(t,["parts"]);if(n!=null){let r=n;Array.isArray(r)&&(r=r.map(l=>ts(o,l))),s(e,["parts"],r)}const i=a(t,["role"]);return i!=null&&s(e,["role"],i),e}function os(o,t){const e={},n=a(t,["citationSources"]);return n!=null&&s(e,["citations"],n),e}function is(o,t){const e={},n=a(t,["content"]);n!=null&&s(e,["content"],ns(o,n));const i=a(t,["citationMetadata"]);i!=null&&s(e,["citationMetadata"],os(o,i));const r=a(t,["tokenCount"]);r!=null&&s(e,["tokenCount"],r);const l=a(t,["finishReason"]);l!=null&&s(e,["finishReason"],l);const d=a(t,["avgLogprobs"]);d!=null&&s(e,["avgLogprobs"],d);const c=a(t,["groundingMetadata"]);c!=null&&s(e,["groundingMetadata"],c);const u=a(t,["index"]);u!=null&&s(e,["index"],u);const f=a(t,["logprobsResult"]);f!=null&&s(e,["logprobsResult"],f);const p=a(t,["safetyRatings"]);return p!=null&&s(e,["safetyRatings"],p),e}function an(o,t){const e={},n=a(t,["candidates"]);if(n!=null){let d=n;Array.isArray(d)&&(d=d.map(c=>is(o,c))),s(e,["candidates"],d)}const i=a(t,["modelVersion"]);i!=null&&s(e,["modelVersion"],i);const r=a(t,["promptFeedback"]);r!=null&&s(e,["promptFeedback"],r);const l=a(t,["usageMetadata"]);return l!=null&&s(e,["usageMetadata"],l),e}function as(o,t){const e={},n=a(t,["values"]);return n!=null&&s(e,["values"],n),e}function ss(){return{}}function rs(o,t){const e={},n=a(t,["embeddings"]);if(n!=null){let r=n;Array.isArray(r)&&(r=r.map(l=>as(o,l))),s(e,["embeddings"],r)}return a(t,["metadata"])!=null&&s(e,["metadata"],ss()),e}function ls(o,t){const e={},n=a(t,["bytesBase64Encoded"]);n!=null&&s(e,["imageBytes"],j(o,n));const i=a(t,["mimeType"]);return i!=null&&s(e,["mimeType"],i),e}function xn(o,t){const e={},n=a(t,["safetyAttributes","categories"]);n!=null&&s(e,["categories"],n);const i=a(t,["safetyAttributes","scores"]);i!=null&&s(e,["scores"],i);const r=a(t,["contentType"]);return r!=null&&s(e,["contentType"],r),e}function us(o,t){const e={},n=a(t,["_self"]);n!=null&&s(e,["image"],ls(o,n));const i=a(t,["raiFilteredReason"]);i!=null&&s(e,["raiFilteredReason"],i);const r=a(t,["_self"]);return r!=null&&s(e,["safetyAttributes"],xn(o,r)),e}function ds(o,t){const e={},n=a(t,["predictions"]);if(n!=null){let r=n;Array.isArray(r)&&(r=r.map(l=>us(o,l))),s(e,["generatedImages"],r)}const i=a(t,["positivePromptSafetyAttributes"]);return i!=null&&s(e,["positivePromptSafetyAttributes"],xn(o,i)),e}function cs(o,t){const e={},n=a(t,["baseModel"]);n!=null&&s(e,["baseModel"],n);const i=a(t,["createTime"]);i!=null&&s(e,["createTime"],i);const r=a(t,["updateTime"]);return r!=null&&s(e,["updateTime"],r),e}function sn(o,t){const e={},n=a(t,["name"]);n!=null&&s(e,["name"],n);const i=a(t,["displayName"]);i!=null&&s(e,["displayName"],i);const r=a(t,["description"]);r!=null&&s(e,["description"],r);const l=a(t,["version"]);l!=null&&s(e,["version"],l);const d=a(t,["_self"]);d!=null&&s(e,["tunedModelInfo"],cs(o,d));const c=a(t,["inputTokenLimit"]);c!=null&&s(e,["inputTokenLimit"],c);const u=a(t,["outputTokenLimit"]);u!=null&&s(e,["outputTokenLimit"],u);const f=a(t,["supportedGenerationMethods"]);return f!=null&&s(e,["supportedActions"],f),e}function fs(){return{}}function ps(o,t){const e={},n=a(t,["totalTokens"]);n!=null&&s(e,["totalTokens"],n);const i=a(t,["cachedContentTokenCount"]);return i!=null&&s(e,["cachedContentTokenCount"],i),e}function hs(o,t){const e={},n=a(t,["video","uri"]);n!=null&&s(e,["uri"],n);const i=a(t,["video","encodedVideo"]);i!=null&&s(e,["videoBytes"],j(o,i));const r=a(t,["encoding"]);return r!=null&&s(e,["mimeType"],r),e}function ms(o,t){const e={},n=a(t,["_self"]);return n!=null&&s(e,["video"],hs(o,n)),e}function gs(o,t){const e={},n=a(t,["generatedSamples"]);if(n!=null){let l=n;Array.isArray(l)&&(l=l.map(d=>ms(o,d))),s(e,["generatedVideos"],l)}const i=a(t,["raiMediaFilteredCount"]);i!=null&&s(e,["raiMediaFilteredCount"],i);const r=a(t,["raiMediaFilteredReasons"]);return r!=null&&s(e,["raiMediaFilteredReasons"],r),e}function ys(o,t){const e={},n=a(t,["name"]);n!=null&&s(e,["name"],n);const i=a(t,["metadata"]);i!=null&&s(e,["metadata"],i);const r=a(t,["done"]);r!=null&&s(e,["done"],r);const l=a(t,["error"]);l!=null&&s(e,["error"],l);const d=a(t,["response","generateVideoResponse"]);return d!=null&&s(e,["response"],gs(o,d)),e}function vs(o,t){const e={},n=a(t,["videoMetadata"]);n!=null&&s(e,["videoMetadata"],n);const i=a(t,["thought"]);i!=null&&s(e,["thought"],i);const r=a(t,["codeExecutionResult"]);r!=null&&s(e,["codeExecutionResult"],r);const l=a(t,["executableCode"]);l!=null&&s(e,["executableCode"],l);const d=a(t,["fileData"]);d!=null&&s(e,["fileData"],d);const c=a(t,["functionCall"]);c!=null&&s(e,["functionCall"],c);const u=a(t,["functionResponse"]);u!=null&&s(e,["functionResponse"],u);const f=a(t,["inlineData"]);f!=null&&s(e,["inlineData"],f);const p=a(t,["text"]);return p!=null&&s(e,["text"],p),e}function Ts(o,t){const e={},n=a(t,["parts"]);if(n!=null){let r=n;Array.isArray(r)&&(r=r.map(l=>vs(o,l))),s(e,["parts"],r)}const i=a(t,["role"]);return i!=null&&s(e,["role"],i),e}function bs(o,t){const e={},n=a(t,["citations"]);return n!=null&&s(e,["citations"],n),e}function Es(o,t){const e={},n=a(t,["content"]);n!=null&&s(e,["content"],Ts(o,n));const i=a(t,["citationMetadata"]);i!=null&&s(e,["citationMetadata"],bs(o,i));const r=a(t,["finishMessage"]);r!=null&&s(e,["finishMessage"],r);const l=a(t,["finishReason"]);l!=null&&s(e,["finishReason"],l);const d=a(t,["avgLogprobs"]);d!=null&&s(e,["avgLogprobs"],d);const c=a(t,["groundingMetadata"]);c!=null&&s(e,["groundingMetadata"],c);const u=a(t,["index"]);u!=null&&s(e,["index"],u);const f=a(t,["logprobsResult"]);f!=null&&s(e,["logprobsResult"],f);const p=a(t,["safetyRatings"]);return p!=null&&s(e,["safetyRatings"],p),e}function rn(o,t){const e={},n=a(t,["candidates"]);if(n!=null){let u=n;Array.isArray(u)&&(u=u.map(f=>Es(o,f))),s(e,["candidates"],u)}const i=a(t,["createTime"]);i!=null&&s(e,["createTime"],i);const r=a(t,["responseId"]);r!=null&&s(e,["responseId"],r);const l=a(t,["modelVersion"]);l!=null&&s(e,["modelVersion"],l);const d=a(t,["promptFeedback"]);d!=null&&s(e,["promptFeedback"],d);const c=a(t,["usageMetadata"]);return c!=null&&s(e,["usageMetadata"],c),e}function Cs(o,t){const e={},n=a(t,["truncated"]);n!=null&&s(e,["truncated"],n);const i=a(t,["token_count"]);return i!=null&&s(e,["tokenCount"],i),e}function ws(o,t){const e={},n=a(t,["values"]);n!=null&&s(e,["values"],n);const i=a(t,["statistics"]);return i!=null&&s(e,["statistics"],Cs(o,i)),e}function Ss(o,t){const e={},n=a(t,["billableCharacterCount"]);return n!=null&&s(e,["billableCharacterCount"],n),e}function Is(o,t){const e={},n=a(t,["predictions[]","embeddings"]);if(n!=null){let r=n;Array.isArray(r)&&(r=r.map(l=>ws(o,l))),s(e,["embeddings"],r)}const i=a(t,["metadata"]);return i!=null&&s(e,["metadata"],Ss(o,i)),e}function _s(o,t){const e={},n=a(t,["gcsUri"]);n!=null&&s(e,["gcsUri"],n);const i=a(t,["bytesBase64Encoded"]);i!=null&&s(e,["imageBytes"],j(o,i));const r=a(t,["mimeType"]);return r!=null&&s(e,["mimeType"],r),e}function Rn(o,t){const e={},n=a(t,["safetyAttributes","categories"]);n!=null&&s(e,["categories"],n);const i=a(t,["safetyAttributes","scores"]);i!=null&&s(e,["scores"],i);const r=a(t,["contentType"]);return r!=null&&s(e,["contentType"],r),e}function As(o,t){const e={},n=a(t,["_self"]);n!=null&&s(e,["image"],_s(o,n));const i=a(t,["raiFilteredReason"]);i!=null&&s(e,["raiFilteredReason"],i);const r=a(t,["_self"]);r!=null&&s(e,["safetyAttributes"],Rn(o,r));const l=a(t,["prompt"]);return l!=null&&s(e,["enhancedPrompt"],l),e}function Ms(o,t){const e={},n=a(t,["predictions"]);if(n!=null){let r=n;Array.isArray(r)&&(r=r.map(l=>As(o,l))),s(e,["generatedImages"],r)}const i=a(t,["positivePromptSafetyAttributes"]);return i!=null&&s(e,["positivePromptSafetyAttributes"],Rn(o,i)),e}function ks(o,t){const e={},n=a(t,["endpoint"]);n!=null&&s(e,["name"],n);const i=a(t,["deployedModelId"]);return i!=null&&s(e,["deployedModelId"],i),e}function xs(o,t){const e={},n=a(t,["labels","google-vertex-llm-tuning-base-model-id"]);n!=null&&s(e,["baseModel"],n);const i=a(t,["createTime"]);i!=null&&s(e,["createTime"],i);const r=a(t,["updateTime"]);return r!=null&&s(e,["updateTime"],r),e}function ln(o,t){const e={},n=a(t,["name"]);n!=null&&s(e,["name"],n);const i=a(t,["displayName"]);i!=null&&s(e,["displayName"],i);const r=a(t,["description"]);r!=null&&s(e,["description"],r);const l=a(t,["versionId"]);l!=null&&s(e,["version"],l);const d=a(t,["deployedModels"]);if(d!=null){let f=d;Array.isArray(f)&&(f=f.map(p=>ks(o,p))),s(e,["endpoints"],f)}const c=a(t,["labels"]);c!=null&&s(e,["labels"],c);const u=a(t,["_self"]);return u!=null&&s(e,["tunedModelInfo"],xs(o,u)),e}function Rs(){return{}}function Ps(o,t){const e={},n=a(t,["totalTokens"]);return n!=null&&s(e,["totalTokens"],n),e}function Ds(o,t){const e={},n=a(t,["tokensInfo"]);return n!=null&&s(e,["tokensInfo"],n),e}function Ls(o,t){const e={},n=a(t,["gcsUri"]);n!=null&&s(e,["uri"],n);const i=a(t,["bytesBase64Encoded"]);i!=null&&s(e,["videoBytes"],j(o,i));const r=a(t,["mimeType"]);return r!=null&&s(e,["mimeType"],r),e}function Ns(o,t){const e={},n=a(t,["_self"]);return n!=null&&s(e,["video"],Ls(o,n)),e}function Bs(o,t){const e={},n=a(t,["videos"]);if(n!=null){let l=n;Array.isArray(l)&&(l=l.map(d=>Ns(o,d))),s(e,["generatedVideos"],l)}const i=a(t,["raiMediaFilteredCount"]);i!=null&&s(e,["raiMediaFilteredCount"],i);const r=a(t,["raiMediaFilteredReasons"]);return r!=null&&s(e,["raiMediaFilteredReasons"],r),e}function Us(o,t){const e={},n=a(t,["name"]);n!=null&&s(e,["name"],n);const i=a(t,["metadata"]);i!=null&&s(e,["metadata"],i);const r=a(t,["done"]);r!=null&&s(e,["done"],r);const l=a(t,["error"]);l!=null&&s(e,["error"],l);const d=a(t,["response"]);return d!=null&&s(e,["response"],Bs(o,d)),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const Fs="FunctionResponse request must have an `id` field from the response of a ToolCall.FunctionalCalls in Google AI.";async function Vs(o,t,e){let n,i;e.data instanceof Blob?i=JSON.parse(await e.data.text()):i=JSON.parse(e.data),o.isVertexAI()?n=ta(o,i):n=ea(o,i),t(n)}class qs{constructor(t,e,n){this.apiClient=t,this.auth=e,this.webSocketFactory=n}async connect(t){var e,n,i,r;const l=this.apiClient.getWebsocketBaseUrl(),d=this.apiClient.getApiVersion();let c;const u=Ys(this.apiClient.getDefaultHeaders());if(this.apiClient.isVertexAI())c=`${l}/ws/google.cloud.aiplatform.${d}.LlmBidiService/BidiGenerateContent`,await this.auth.addAuthHeaders(u);else{const C=this.apiClient.getApiKey();c=`${l}/ws/google.ai.generativelanguage.${d}.GenerativeService.BidiGenerateContent?key=${C}`}let f=()=>{};const p=new Promise(C=>{f=C}),h=t.callbacks,g=function(){var C;(C=h==null?void 0:h.onopen)===null||C===void 0||C.call(h),f({})},y=this.apiClient,T={onopen:g,onmessage:C=>{Vs(y,h.onmessage,C)},onerror:(e=h==null?void 0:h.onerror)!==null&&e!==void 0?e:function(C){},onclose:(n=h==null?void 0:h.onclose)!==null&&n!==void 0?n:function(C){}},E=this.webSocketFactory.create(c,$s(u),T);E.connect(),await p;let w=M(this.apiClient,t.model);if(this.apiClient.isVertexAI()&&w.startsWith("publishers/")){const C=this.apiClient.getProject(),x=this.apiClient.getLocation();w=`projects/${C}/locations/${x}/`+w}let S={};this.apiClient.isVertexAI()&&((i=t.config)===null||i===void 0?void 0:i.responseModalities)===void 0&&(t.config===void 0?t.config={responseModalities:[N.AUDIO]}:t.config.responseModalities=[N.AUDIO]),!((r=t.config)===null||r===void 0)&&r.generationConfig&&console.warn("Setting `LiveConnectConfig.generation_config` is deprecated, please set the fields on `LiveConnectConfig` directly. This will become an error in a future version (not before Q3 2025).");const _={model:w,config:t.config,callbacks:t.callbacks};return this.apiClient.isVertexAI()?S=Ai(this.apiClient,_):S=_i(this.apiClient,_),delete S.config,E.send(JSON.stringify(S)),new Hs(E,this.apiClient)}}const Gs={turnComplete:!0};class Hs{constructor(t,e){this.conn=t,this.apiClient=e}tLiveClientContent(t,e){if(e.turns!==null&&e.turns!==void 0){let n=[];try{n=Z(t,e.turns),t.isVertexAI()?n=n.map(i=>ue(t,i)):n=n.map(i=>Ge(t,i))}catch{throw new Error(`Failed to parse client content "turns", type: '${typeof e.turns}'`)}return{clientContent:{turns:n,turnComplete:e.turnComplete}}}return{clientContent:{turnComplete:e.turnComplete}}}tLiveClienttToolResponse(t,e){let n=[];if(e.functionResponses==null)throw new Error("functionResponses is required.");if(Array.isArray(e.functionResponses)?n=e.functionResponses:n=[e.functionResponses],n.length===0)throw new Error("functionResponses is required.");for(const r of n){if(typeof r!="object"||r===null||!("name"in r)||!("response"in r))throw new Error(`Could not parse function response, type '${typeof r}'.`);if(!t.isVertexAI()&&!("id"in r))throw new Error(Fs)}return{toolResponse:{functionResponses:n}}}sendClientContent(t){t=Object.assign(Object.assign({},Gs),t);const e=this.tLiveClientContent(this.apiClient,t);this.conn.send(JSON.stringify(e))}sendRealtimeInput(t){let e={};this.apiClient.isVertexAI()?e={realtimeInput:Di(this.apiClient,t)}:e={realtimeInput:Pi(this.apiClient,t)},this.conn.send(JSON.stringify(e))}sendToolResponse(t){if(t.functionResponses==null)throw new Error("Tool response parameters are required.");const e=this.tLiveClienttToolResponse(this.apiClient,t);this.conn.send(JSON.stringify(e))}close(){this.conn.close()}}function $s(o){const t={};return o.forEach((e,n)=>{t[n]=e}),t}function Ys(o){const t=new Headers;for(const[e,n]of Object.entries(o))t.append(e,n);return t}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Js extends Se{constructor(t){super(),this.apiClient=t,this.generateContent=async e=>await this.generateContentInternal(e),this.generateContentStream=async e=>await this.generateContentStreamInternal(e),this.generateImages=async e=>await this.generateImagesInternal(e).then(n=>{var i;let r;const l=[];if(n!=null&&n.generatedImages)for(const c of n.generatedImages)c&&(c!=null&&c.safetyAttributes)&&((i=c==null?void 0:c.safetyAttributes)===null||i===void 0?void 0:i.contentType)==="Positive Prompt"?r=c==null?void 0:c.safetyAttributes:l.push(c);let d;return r?d={generatedImages:l,positivePromptSafetyAttributes:r}:d={generatedImages:l},d})}async generateContentInternal(t){var e,n,i,r;let l,d="",c={};if(this.apiClient.isVertexAI()){const u=on(this.apiClient,t);return d=b("{model}:generateContent",u._url),c=u._query,delete u.config,delete u._url,delete u._query,l=this.apiClient.request({path:d,queryParams:c,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(f=>f.json()),l.then(f=>{const p=rn(this.apiClient,f),h=new Me;return Object.assign(h,p),h})}else{const u=nn(this.apiClient,t);return d=b("{model}:generateContent",u._url),c=u._query,delete u.config,delete u._url,delete u._query,l=this.apiClient.request({path:d,queryParams:c,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(i=t.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json()),l.then(f=>{const p=an(this.apiClient,f),h=new Me;return Object.assign(h,p),h})}}async generateContentStreamInternal(t){var e,n,i,r;let l,d="",c={};if(this.apiClient.isVertexAI()){const u=on(this.apiClient,t);d=b("{model}:streamGenerateContent?alt=sse",u._url),c=u._query,delete u.config,delete u._url,delete u._query;const f=this.apiClient;return l=f.requestStream({path:d,queryParams:c,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}),l.then(function(p){return Le(this,arguments,function*(){var h,g,y,T;try{for(var E=!0,w=ze(p),S;S=yield P(w.next()),h=S.done,!h;E=!0){T=S.value,E=!1;const C=rn(f,yield P(T.json())),x=new Me;Object.assign(x,C),yield yield P(x)}}catch(_){g={error:_}}finally{try{!E&&!h&&(y=w.return)&&(yield P(y.call(w)))}finally{if(g)throw g.error}}})})}else{const u=nn(this.apiClient,t);d=b("{model}:streamGenerateContent?alt=sse",u._url),c=u._query,delete u.config,delete u._url,delete u._query;const f=this.apiClient;return l=f.requestStream({path:d,queryParams:c,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(i=t.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}),l.then(function(p){return Le(this,arguments,function*(){var h,g,y,T;try{for(var E=!0,w=ze(p),S;S=yield P(w.next()),h=S.done,!h;E=!0){T=S.value,E=!1;const C=an(f,yield P(T.json())),x=new Me;Object.assign(x,C),yield yield P(x)}}catch(_){g={error:_}}finally{try{!E&&!h&&(y=w.return)&&(yield P(y.call(w)))}finally{if(g)throw g.error}}})})}}async embedContent(t){var e,n,i,r;let l,d="",c={};if(this.apiClient.isVertexAI()){const u=Ha(this.apiClient,t);return d=b("{model}:predict",u._url),c=u._query,delete u.config,delete u._url,delete u._query,l=this.apiClient.request({path:d,queryParams:c,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(f=>f.json()),l.then(f=>{const p=Is(this.apiClient,f),h=new Jt;return Object.assign(h,p),h})}else{const u=ga(this.apiClient,t);return d=b("{model}:batchEmbedContents",u._url),c=u._query,delete u.config,delete u._url,delete u._query,l=this.apiClient.request({path:d,queryParams:c,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(i=t.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json()),l.then(f=>{const p=rs(this.apiClient,f),h=new Jt;return Object.assign(h,p),h})}}async generateImagesInternal(t){var e,n,i,r;let l,d="",c={};if(this.apiClient.isVertexAI()){const u=Ya(this.apiClient,t);return d=b("{model}:predict",u._url),c=u._query,delete u.config,delete u._url,delete u._query,l=this.apiClient.request({path:d,queryParams:c,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(f=>f.json()),l.then(f=>{const p=Ms(this.apiClient,f),h=new Ot;return Object.assign(h,p),h})}else{const u=va(this.apiClient,t);return d=b("{model}:predict",u._url),c=u._query,delete u.config,delete u._url,delete u._query,l=this.apiClient.request({path:d,queryParams:c,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(i=t.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json()),l.then(f=>{const p=ds(this.apiClient,f),h=new Ot;return Object.assign(h,p),h})}}async get(t){var e,n,i,r;let l,d="",c={};if(this.apiClient.isVertexAI()){const u=Ja(this.apiClient,t);return d=b("{name}",u._url),c=u._query,delete u.config,delete u._url,delete u._query,l=this.apiClient.request({path:d,queryParams:c,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(f=>f.json()),l.then(f=>ln(this.apiClient,f))}else{const u=Ta(this.apiClient,t);return d=b("{name}",u._url),c=u._query,delete u.config,delete u._url,delete u._query,l=this.apiClient.request({path:d,queryParams:c,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(i=t.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json()),l.then(f=>sn(this.apiClient,f))}}async update(t){var e,n,i,r;let l,d="",c={};if(this.apiClient.isVertexAI()){const u=Ka(this.apiClient,t);return d=b("{model}",u._url),c=u._query,delete u.config,delete u._url,delete u._query,l=this.apiClient.request({path:d,queryParams:c,body:JSON.stringify(u),httpMethod:"PATCH",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(f=>f.json()),l.then(f=>ln(this.apiClient,f))}else{const u=Ea(this.apiClient,t);return d=b("{name}",u._url),c=u._query,delete u.config,delete u._url,delete u._query,l=this.apiClient.request({path:d,queryParams:c,body:JSON.stringify(u),httpMethod:"PATCH",httpOptions:(i=t.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json()),l.then(f=>sn(this.apiClient,f))}}async delete(t){var e,n,i,r;let l,d="",c={};if(this.apiClient.isVertexAI()){const u=Wa(this.apiClient,t);return d=b("{name}",u._url),c=u._query,delete u.config,delete u._url,delete u._query,l=this.apiClient.request({path:d,queryParams:c,body:JSON.stringify(u),httpMethod:"DELETE",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(f=>f.json()),l.then(()=>{const f=Rs(),p=new Kt;return Object.assign(p,f),p})}else{const u=Ca(this.apiClient,t);return d=b("{name}",u._url),c=u._query,delete u.config,delete u._url,delete u._query,l=this.apiClient.request({path:d,queryParams:c,body:JSON.stringify(u),httpMethod:"DELETE",httpOptions:(i=t.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json()),l.then(()=>{const f=fs(),p=new Kt;return Object.assign(p,f),p})}}async countTokens(t){var e,n,i,r;let l,d="",c={};if(this.apiClient.isVertexAI()){const u=Xa(this.apiClient,t);return d=b("{model}:countTokens",u._url),c=u._query,delete u.config,delete u._url,delete u._query,l=this.apiClient.request({path:d,queryParams:c,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(f=>f.json()),l.then(f=>{const p=Ps(this.apiClient,f),h=new Wt;return Object.assign(h,p),h})}else{const u=Sa(this.apiClient,t);return d=b("{model}:countTokens",u._url),c=u._query,delete u.config,delete u._url,delete u._query,l=this.apiClient.request({path:d,queryParams:c,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(i=t.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json()),l.then(f=>{const p=ps(this.apiClient,f),h=new Wt;return Object.assign(h,p),h})}}async computeTokens(t){var e,n;let i,r="",l={};if(this.apiClient.isVertexAI()){const d=Za(this.apiClient,t);return r=b("{model}:computeTokens",d._url),l=d._query,delete d.config,delete d._url,delete d._query,i=this.apiClient.request({path:r,queryParams:l,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(c=>c.json()),i.then(c=>{const u=Ds(this.apiClient,c),f=new Do;return Object.assign(f,u),f})}else throw new Error("This method is only supported by the Vertex AI.")}async generateVideos(t){var e,n,i,r;let l,d="",c={};if(this.apiClient.isVertexAI()){const u=es(this.apiClient,t);return d=b("{model}:predictLongRunning",u._url),c=u._query,delete u.config,delete u._url,delete u._query,l=this.apiClient.request({path:d,queryParams:c,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(f=>f.json()),l.then(f=>Us(this.apiClient,f))}else{const u=Aa(this.apiClient,t);return d=b("{model}:predictLongRunning",u._url),c=u._query,delete u.config,delete u._url,delete u._query,l=this.apiClient.request({path:d,queryParams:c,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(i=t.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json()),l.then(f=>ys(this.apiClient,f))}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Os(o,t){const e={},n=a(t,["operationName"]);n!=null&&s(e,["_url","operationName"],n);const i=a(t,["config"]);return i!=null&&s(e,["config"],i),e}function Ks(o,t){const e={},n=a(t,["operationName"]);n!=null&&s(e,["_url","operationName"],n);const i=a(t,["config"]);return i!=null&&s(e,["config"],i),e}function Ws(o,t){const e={},n=a(t,["operationName"]);n!=null&&s(e,["operationName"],n);const i=a(t,["resourceName"]);i!=null&&s(e,["_url","resourceName"],i);const r=a(t,["config"]);return r!=null&&s(e,["config"],r),e}function zs(o,t){const e={},n=a(t,["video","uri"]);n!=null&&s(e,["uri"],n);const i=a(t,["video","encodedVideo"]);i!=null&&s(e,["videoBytes"],j(o,i));const r=a(t,["encoding"]);return r!=null&&s(e,["mimeType"],r),e}function Xs(o,t){const e={},n=a(t,["_self"]);return n!=null&&s(e,["video"],zs(o,n)),e}function Zs(o,t){const e={},n=a(t,["generatedSamples"]);if(n!=null){let l=n;Array.isArray(l)&&(l=l.map(d=>Xs(o,d))),s(e,["generatedVideos"],l)}const i=a(t,["raiMediaFilteredCount"]);i!=null&&s(e,["raiMediaFilteredCount"],i);const r=a(t,["raiMediaFilteredReasons"]);return r!=null&&s(e,["raiMediaFilteredReasons"],r),e}function Qs(o,t){const e={},n=a(t,["name"]);n!=null&&s(e,["name"],n);const i=a(t,["metadata"]);i!=null&&s(e,["metadata"],i);const r=a(t,["done"]);r!=null&&s(e,["done"],r);const l=a(t,["error"]);l!=null&&s(e,["error"],l);const d=a(t,["response","generateVideoResponse"]);return d!=null&&s(e,["response"],Zs(o,d)),e}function js(o,t){const e={},n=a(t,["gcsUri"]);n!=null&&s(e,["uri"],n);const i=a(t,["bytesBase64Encoded"]);i!=null&&s(e,["videoBytes"],j(o,i));const r=a(t,["mimeType"]);return r!=null&&s(e,["mimeType"],r),e}function er(o,t){const e={},n=a(t,["_self"]);return n!=null&&s(e,["video"],js(o,n)),e}function tr(o,t){const e={},n=a(t,["videos"]);if(n!=null){let l=n;Array.isArray(l)&&(l=l.map(d=>er(o,d))),s(e,["generatedVideos"],l)}const i=a(t,["raiMediaFilteredCount"]);i!=null&&s(e,["raiMediaFilteredCount"],i);const r=a(t,["raiMediaFilteredReasons"]);return r!=null&&s(e,["raiMediaFilteredReasons"],r),e}function un(o,t){const e={},n=a(t,["name"]);n!=null&&s(e,["name"],n);const i=a(t,["metadata"]);i!=null&&s(e,["metadata"],i);const r=a(t,["done"]);r!=null&&s(e,["done"],r);const l=a(t,["error"]);l!=null&&s(e,["error"],l);const d=a(t,["response"]);return d!=null&&s(e,["response"],tr(o,d)),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class nr extends Se{constructor(t){super(),this.apiClient=t}async getVideosOperation(t){const e=t.operation,n=t.config;if(e.name===void 0||e.name==="")throw new Error("Operation name is required.");if(this.apiClient.isVertexAI()){const i=e.name.split("/operations/")[0];let r;return n&&"httpOptions"in n&&(r=n.httpOptions),this.fetchPredictVideosOperationInternal({operationName:e.name,resourceName:i,config:{httpOptions:r}})}else return this.getVideosOperationInternal({operationName:e.name,config:n})}async getVideosOperationInternal(t){var e,n,i,r;let l,d="",c={};if(this.apiClient.isVertexAI()){const u=Ks(this.apiClient,t);return d=b("{operationName}",u._url),c=u._query,delete u.config,delete u._url,delete u._query,l=this.apiClient.request({path:d,queryParams:c,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(f=>f.json()),l.then(f=>un(this.apiClient,f))}else{const u=Os(this.apiClient,t);return d=b("{operationName}",u._url),c=u._query,delete u.config,delete u._url,delete u._query,l=this.apiClient.request({path:d,queryParams:c,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(i=t.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json()),l.then(f=>Qs(this.apiClient,f))}}async fetchPredictVideosOperationInternal(t){var e,n;let i,r="",l={};if(this.apiClient.isVertexAI()){const d=Ws(this.apiClient,t);return r=b("{resourceName}:fetchPredictOperation",d._url),l=d._query,delete d.config,delete d._url,delete d._query,i=this.apiClient.request({path:r,queryParams:l,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(c=>c.json()),i.then(c=>un(this.apiClient,c))}else throw new Error("This method is only supported by the Vertex AI.")}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const or="Content-Type",ir="X-Server-Timeout",ar="User-Agent",sr="x-goog-api-client",rr="0.12.0",lr=`google-genai-sdk/${rr}`,ur="v1beta1",dr="v1beta",dn=/^data: (.*)(?:\n\n|\r\r|\r\n\r\n)/;class Pn extends Error{constructor(t,e){e?super(t,{cause:e}):super(t,{cause:new Error().stack}),this.message=t,this.name="ClientError"}}class Ze extends Error{constructor(t,e){e?super(t,{cause:e}):super(t,{cause:new Error().stack}),this.message=t,this.name="ServerError"}}class cr{constructor(t){var e,n;this.clientOptions=Object.assign(Object.assign({},t),{project:t.project,location:t.location,apiKey:t.apiKey,vertexai:t.vertexai});const i={};this.clientOptions.vertexai?(i.apiVersion=(e=this.clientOptions.apiVersion)!==null&&e!==void 0?e:ur,this.getProject()||this.getLocation()?(i.baseUrl=`https://${this.clientOptions.location}-aiplatform.googleapis.com/`,this.clientOptions.apiKey=void 0):(i.baseUrl="https://aiplatform.googleapis.com/",this.clientOptions.project=void 0,this.clientOptions.location=void 0)):(i.apiVersion=(n=this.clientOptions.apiVersion)!==null&&n!==void 0?n:dr,i.baseUrl="https://generativelanguage.googleapis.com/"),i.headers=this.getDefaultHeaders(),this.clientOptions.httpOptions=i,t.httpOptions&&(this.clientOptions.httpOptions=this.patchHttpOptions(i,t.httpOptions))}isVertexAI(){var t;return(t=this.clientOptions.vertexai)!==null&&t!==void 0?t:!1}getProject(){return this.clientOptions.project}getLocation(){return this.clientOptions.location}getApiVersion(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.apiVersion!==void 0)return this.clientOptions.httpOptions.apiVersion;throw new Error("API version is not set.")}getBaseUrl(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.baseUrl!==void 0)return this.clientOptions.httpOptions.baseUrl;throw new Error("Base URL is not set.")}getRequestUrl(){return this.getRequestUrlInternal(this.clientOptions.httpOptions)}getHeaders(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.headers!==void 0)return this.clientOptions.httpOptions.headers;throw new Error("Headers are not set.")}getRequestUrlInternal(t){if(!t||t.baseUrl===void 0||t.apiVersion===void 0)throw new Error("HTTP options are not correctly set.");const n=[t.baseUrl.endsWith("/")?t.baseUrl.slice(0,-1):t.baseUrl];return t.apiVersion&&t.apiVersion!==""&&n.push(t.apiVersion),n.join("/")}getBaseResourcePath(){return`projects/${this.clientOptions.project}/locations/${this.clientOptions.location}`}getApiKey(){return this.clientOptions.apiKey}getWebsocketBaseUrl(){const t=this.getBaseUrl(),e=new URL(t);return e.protocol=e.protocol=="http:"?"ws":"wss",e.toString()}setBaseUrl(t){if(this.clientOptions.httpOptions)this.clientOptions.httpOptions.baseUrl=t;else throw new Error("HTTP options are not correctly set.")}constructUrl(t,e,n){const i=[this.getRequestUrlInternal(e)];return n&&i.push(this.getBaseResourcePath()),t!==""&&i.push(t),new URL(`${i.join("/")}`)}shouldPrependVertexProjectPath(t){return!(this.clientOptions.apiKey||!this.clientOptions.vertexai||t.path.startsWith("projects/")||t.httpMethod==="GET"&&t.path.startsWith("publishers/google/models"))}async request(t){let e=this.clientOptions.httpOptions;t.httpOptions&&(e=this.patchHttpOptions(this.clientOptions.httpOptions,t.httpOptions));const n=this.shouldPrependVertexProjectPath(t),i=this.constructUrl(t.path,e,n);if(t.queryParams)for(const[l,d]of Object.entries(t.queryParams))i.searchParams.append(l,String(d));let r={};if(t.httpMethod==="GET"){if(t.body&&t.body!=="{}")throw new Error("Request body should be empty for GET request, but got non empty request body")}else r.body=t.body;return r=await this.includeExtraHttpOptionsToRequestInit(r,e,t.abortSignal),this.unaryApiCall(i,r,t.httpMethod)}patchHttpOptions(t,e){const n=JSON.parse(JSON.stringify(t));for(const[i,r]of Object.entries(e))typeof r=="object"?n[i]=Object.assign(Object.assign({},n[i]),r):r!==void 0&&(n[i]=r);return n}async requestStream(t){let e=this.clientOptions.httpOptions;t.httpOptions&&(e=this.patchHttpOptions(this.clientOptions.httpOptions,t.httpOptions));const n=this.shouldPrependVertexProjectPath(t),i=this.constructUrl(t.path,e,n);(!i.searchParams.has("alt")||i.searchParams.get("alt")!=="sse")&&i.searchParams.set("alt","sse");let r={};return r.body=t.body,r=await this.includeExtraHttpOptionsToRequestInit(r,e,t.abortSignal),this.streamApiCall(i,r,t.httpMethod)}async includeExtraHttpOptionsToRequestInit(t,e,n){if(e&&e.timeout||n){const i=new AbortController,r=i.signal;e.timeout&&(e==null?void 0:e.timeout)>0&&setTimeout(()=>i.abort(),e.timeout),n&&n.addEventListener("abort",()=>{i.abort()}),t.signal=r}return t.headers=await this.getHeadersInternal(e),t}async unaryApiCall(t,e,n){return this.apiCall(t.toString(),Object.assign(Object.assign({},e),{method:n})).then(async i=>(await cn(i),new We(i))).catch(i=>{throw i instanceof Error?i:new Error(JSON.stringify(i))})}async streamApiCall(t,e,n){return this.apiCall(t.toString(),Object.assign(Object.assign({},e),{method:n})).then(async i=>(await cn(i),this.processStreamResponse(i))).catch(i=>{throw i instanceof Error?i:new Error(JSON.stringify(i))})}processStreamResponse(t){var e;return Le(this,arguments,function*(){const i=(e=t==null?void 0:t.body)===null||e===void 0?void 0:e.getReader(),r=new TextDecoder("utf-8");if(!i)throw new Error("Response body is empty");try{let l="";for(;;){const{done:d,value:c}=yield P(i.read());if(d){if(l.trim().length>0)throw new Error("Incomplete JSON segment at the end");break}const u=r.decode(c);try{const p=JSON.parse(u);if("error"in p){const h=JSON.parse(JSON.stringify(p.error)),g=h.status,y=h.code,T=`got status: ${g}. ${JSON.stringify(p)}`;if(y>=400&&y<500)throw new Pn(T);if(y>=500&&y<600)throw new Ze(T)}}catch(p){const h=p;if(h.name==="ClientError"||h.name==="ServerError")throw p}l+=u;let f=l.match(dn);for(;f;){const p=f[1];try{const h=new Response(p,{headers:t==null?void 0:t.headers,status:t==null?void 0:t.status,statusText:t==null?void 0:t.statusText});yield yield P(new We(h)),l=l.slice(f[0].length),f=l.match(dn)}catch(h){throw new Error(`exception parsing stream chunk ${p}. ${h}`)}}}}finally{i.releaseLock()}})}async apiCall(t,e){return fetch(t,e).catch(n=>{throw new Error(`exception ${n} sending request`)})}getDefaultHeaders(){const t={},e=lr+" "+this.clientOptions.userAgentExtra;return t[ar]=e,t[sr]=e,t[or]="application/json",t}async getHeadersInternal(t){const e=new Headers;if(t&&t.headers){for(const[n,i]of Object.entries(t.headers))e.append(n,i);t.timeout&&t.timeout>0&&e.append(ir,String(Math.ceil(t.timeout/1e3)))}return await this.clientOptions.auth.addAuthHeaders(e),e}async uploadFile(t,e){var n;const i={};e!=null&&(i.mimeType=e.mimeType,i.name=e.name,i.displayName=e.displayName),i.name&&!i.name.startsWith("files/")&&(i.name=`files/${i.name}`);const r=this.clientOptions.uploader,l=await r.stat(t);i.sizeBytes=String(l.size);const d=(n=e==null?void 0:e.mimeType)!==null&&n!==void 0?n:l.type;if(d===void 0||d==="")throw new Error("Can not determine mimeType. Please provide mimeType in the config.");i.mimeType=d;const c=await this.fetchUploadUrl(i,e);return r.upload(t,c,this)}async fetchUploadUrl(t,e){var n;let i={};e!=null&&e.httpOptions?i=e.httpOptions:i={apiVersion:"",headers:{"Content-Type":"application/json","X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":`${t.sizeBytes}`,"X-Goog-Upload-Header-Content-Type":`${t.mimeType}`}};const r={file:t},l=await this.request({path:b("upload/v1beta/files",r._url),body:JSON.stringify(r),httpMethod:"POST",httpOptions:i});if(!l||!(l!=null&&l.headers))throw new Error("Server did not return an HttpResponse or the returned HttpResponse did not have headers.");const d=(n=l==null?void 0:l.headers)===null||n===void 0?void 0:n["x-goog-upload-url"];if(d===void 0)throw new Error("Failed to get upload url. Server did not return the x-google-upload-url in the headers");return d}}async function cn(o){var t;if(o===void 0)throw new Ze("response is undefined");if(!o.ok){const e=o.status,n=o.statusText;let i;!((t=o.headers.get("content-type"))===null||t===void 0)&&t.includes("application/json")?i=await o.json():i={error:{message:await o.text(),code:o.status,status:o.statusText}};const r=`got status: ${e} ${n}. ${JSON.stringify(i)}`;throw e>=400&&e<500?new Pn(r):e>=500&&e<600?new Ze(r):new Error(r)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function fr(o,t){const e={},n=a(t,["name"]);n!=null&&s(e,["_url","name"],n);const i=a(t,["config"]);return i!=null&&s(e,["config"],i),e}function pr(o,t,e){const n={},i=a(t,["pageSize"]);e!==void 0&&i!=null&&s(e,["_query","pageSize"],i);const r=a(t,["pageToken"]);e!==void 0&&r!=null&&s(e,["_query","pageToken"],r);const l=a(t,["filter"]);return e!==void 0&&l!=null&&s(e,["_query","filter"],l),n}function hr(o,t){const e={},n=a(t,["config"]);return n!=null&&s(e,["config"],pr(o,n,e)),e}function mr(o,t){const e={},n=a(t,["textInput"]);n!=null&&s(e,["textInput"],n);const i=a(t,["output"]);return i!=null&&s(e,["output"],i),e}function gr(o,t){const e={};if(a(t,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");const n=a(t,["examples"]);if(n!=null){let i=n;Array.isArray(i)&&(i=i.map(r=>mr(o,r))),s(e,["examples","examples"],i)}return e}function yr(o,t,e){const n={};if(a(t,["validationDataset"])!==void 0)throw new Error("validationDataset parameter is not supported in Gemini API.");const i=a(t,["tunedModelDisplayName"]);if(e!==void 0&&i!=null&&s(e,["displayName"],i),a(t,["description"])!==void 0)throw new Error("description parameter is not supported in Gemini API.");const r=a(t,["epochCount"]);e!==void 0&&r!=null&&s(e,["tuningTask","hyperparameters","epochCount"],r);const l=a(t,["learningRateMultiplier"]);if(l!=null&&s(n,["tuningTask","hyperparameters","learningRateMultiplier"],l),a(t,["adapterSize"])!==void 0)throw new Error("adapterSize parameter is not supported in Gemini API.");const d=a(t,["batchSize"]);e!==void 0&&d!=null&&s(e,["tuningTask","hyperparameters","batchSize"],d);const c=a(t,["learningRate"]);return e!==void 0&&c!=null&&s(e,["tuningTask","hyperparameters","learningRate"],c),n}function vr(o,t){const e={},n=a(t,["baseModel"]);n!=null&&s(e,["baseModel"],n);const i=a(t,["trainingDataset"]);i!=null&&s(e,["tuningTask","trainingData"],gr(o,i));const r=a(t,["config"]);return r!=null&&s(e,["config"],yr(o,r,e)),e}function Tr(o,t){const e={},n=a(t,["name"]);n!=null&&s(e,["_url","name"],n);const i=a(t,["config"]);return i!=null&&s(e,["config"],i),e}function br(o,t,e){const n={},i=a(t,["pageSize"]);e!==void 0&&i!=null&&s(e,["_query","pageSize"],i);const r=a(t,["pageToken"]);e!==void 0&&r!=null&&s(e,["_query","pageToken"],r);const l=a(t,["filter"]);return e!==void 0&&l!=null&&s(e,["_query","filter"],l),n}function Er(o,t){const e={},n=a(t,["config"]);return n!=null&&s(e,["config"],br(o,n,e)),e}function Cr(o,t,e){const n={},i=a(t,["gcsUri"]);if(e!==void 0&&i!=null&&s(e,["supervisedTuningSpec","trainingDatasetUri"],i),a(t,["examples"])!==void 0)throw new Error("examples parameter is not supported in Vertex AI.");return n}function wr(o,t){const e={},n=a(t,["gcsUri"]);return n!=null&&s(e,["validationDatasetUri"],n),e}function Sr(o,t,e){const n={},i=a(t,["validationDataset"]);e!==void 0&&i!=null&&s(e,["supervisedTuningSpec"],wr(o,i));const r=a(t,["tunedModelDisplayName"]);e!==void 0&&r!=null&&s(e,["tunedModelDisplayName"],r);const l=a(t,["description"]);e!==void 0&&l!=null&&s(e,["description"],l);const d=a(t,["epochCount"]);e!==void 0&&d!=null&&s(e,["supervisedTuningSpec","hyperParameters","epochCount"],d);const c=a(t,["learningRateMultiplier"]);e!==void 0&&c!=null&&s(e,["supervisedTuningSpec","hyperParameters","learningRateMultiplier"],c);const u=a(t,["adapterSize"]);if(e!==void 0&&u!=null&&s(e,["supervisedTuningSpec","hyperParameters","adapterSize"],u),a(t,["batchSize"])!==void 0)throw new Error("batchSize parameter is not supported in Vertex AI.");if(a(t,["learningRate"])!==void 0)throw new Error("learningRate parameter is not supported in Vertex AI.");return n}function Ir(o,t){const e={},n=a(t,["baseModel"]);n!=null&&s(e,["baseModel"],n);const i=a(t,["trainingDataset"]);i!=null&&s(e,["supervisedTuningSpec","trainingDatasetUri"],Cr(o,i,e));const r=a(t,["config"]);return r!=null&&s(e,["config"],Sr(o,r,e)),e}function _r(o,t){const e={},n=a(t,["name"]);n!=null&&s(e,["model"],n);const i=a(t,["name"]);return i!=null&&s(e,["endpoint"],i),e}function Dn(o,t){const e={},n=a(t,["name"]);n!=null&&s(e,["name"],n);const i=a(t,["state"]);i!=null&&s(e,["state"],_n(o,i));const r=a(t,["createTime"]);r!=null&&s(e,["createTime"],r);const l=a(t,["tuningTask","startTime"]);l!=null&&s(e,["startTime"],l);const d=a(t,["tuningTask","completeTime"]);d!=null&&s(e,["endTime"],d);const c=a(t,["updateTime"]);c!=null&&s(e,["updateTime"],c);const u=a(t,["description"]);u!=null&&s(e,["description"],u);const f=a(t,["baseModel"]);f!=null&&s(e,["baseModel"],f);const p=a(t,["_self"]);p!=null&&s(e,["tunedModel"],_r(o,p));const h=a(t,["distillationSpec"]);h!=null&&s(e,["distillationSpec"],h);const g=a(t,["experiment"]);g!=null&&s(e,["experiment"],g);const y=a(t,["labels"]);y!=null&&s(e,["labels"],y);const T=a(t,["pipelineJob"]);T!=null&&s(e,["pipelineJob"],T);const E=a(t,["tunedModelDisplayName"]);return E!=null&&s(e,["tunedModelDisplayName"],E),e}function Ar(o,t){const e={},n=a(t,["nextPageToken"]);n!=null&&s(e,["nextPageToken"],n);const i=a(t,["tunedModels"]);if(i!=null){let r=i;Array.isArray(r)&&(r=r.map(l=>Dn(o,l))),s(e,["tuningJobs"],r)}return e}function Mr(o,t){const e={},n=a(t,["name"]);n!=null&&s(e,["name"],n);const i=a(t,["metadata"]);i!=null&&s(e,["metadata"],i);const r=a(t,["done"]);r!=null&&s(e,["done"],r);const l=a(t,["error"]);return l!=null&&s(e,["error"],l),e}function kr(o,t){const e={},n=a(t,["model"]);n!=null&&s(e,["model"],n);const i=a(t,["endpoint"]);return i!=null&&s(e,["endpoint"],i),e}function Qe(o,t){const e={},n=a(t,["name"]);n!=null&&s(e,["name"],n);const i=a(t,["state"]);i!=null&&s(e,["state"],_n(o,i));const r=a(t,["createTime"]);r!=null&&s(e,["createTime"],r);const l=a(t,["startTime"]);l!=null&&s(e,["startTime"],l);const d=a(t,["endTime"]);d!=null&&s(e,["endTime"],d);const c=a(t,["updateTime"]);c!=null&&s(e,["updateTime"],c);const u=a(t,["error"]);u!=null&&s(e,["error"],u);const f=a(t,["description"]);f!=null&&s(e,["description"],f);const p=a(t,["baseModel"]);p!=null&&s(e,["baseModel"],p);const h=a(t,["tunedModel"]);h!=null&&s(e,["tunedModel"],kr(o,h));const g=a(t,["supervisedTuningSpec"]);g!=null&&s(e,["supervisedTuningSpec"],g);const y=a(t,["tuningDataStats"]);y!=null&&s(e,["tuningDataStats"],y);const T=a(t,["encryptionSpec"]);T!=null&&s(e,["encryptionSpec"],T);const E=a(t,["partnerModelTuningSpec"]);E!=null&&s(e,["partnerModelTuningSpec"],E);const w=a(t,["distillationSpec"]);w!=null&&s(e,["distillationSpec"],w);const S=a(t,["experiment"]);S!=null&&s(e,["experiment"],S);const _=a(t,["labels"]);_!=null&&s(e,["labels"],_);const C=a(t,["pipelineJob"]);C!=null&&s(e,["pipelineJob"],C);const x=a(t,["tunedModelDisplayName"]);return x!=null&&s(e,["tunedModelDisplayName"],x),e}function xr(o,t){const e={},n=a(t,["nextPageToken"]);n!=null&&s(e,["nextPageToken"],n);const i=a(t,["tuningJobs"]);if(i!=null){let r=i;Array.isArray(r)&&(r=r.map(l=>Qe(o,l))),s(e,["tuningJobs"],r)}return e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Rr extends Se{constructor(t){super(),this.apiClient=t,this.get=async e=>await this.getInternal(e),this.list=async(e={})=>new nt(ge.PAGED_ITEM_TUNING_JOBS,n=>this.listInternal(n),await this.listInternal(e),e),this.tune=async e=>{if(this.apiClient.isVertexAI())return await this.tuneInternal(e);{const n=await this.tuneMldevInternal(e);let i="";return n.metadata!==void 0&&n.metadata.tunedModel!==void 0?i=n.metadata.tunedModel:n.name!==void 0&&n.name.includes("/operations/")&&(i=n.name.split("/operations/")[0]),{name:i,state:Ke.JOB_STATE_QUEUED}}}}async getInternal(t){var e,n,i,r;let l,d="",c={};if(this.apiClient.isVertexAI()){const u=Tr(this.apiClient,t);return d=b("{name}",u._url),c=u._query,delete u.config,delete u._url,delete u._query,l=this.apiClient.request({path:d,queryParams:c,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(f=>f.json()),l.then(f=>Qe(this.apiClient,f))}else{const u=fr(this.apiClient,t);return d=b("{name}",u._url),c=u._query,delete u.config,delete u._url,delete u._query,l=this.apiClient.request({path:d,queryParams:c,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(i=t.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json()),l.then(f=>Dn(this.apiClient,f))}}async listInternal(t){var e,n,i,r;let l,d="",c={};if(this.apiClient.isVertexAI()){const u=Er(this.apiClient,t);return d=b("tuningJobs",u._url),c=u._query,delete u.config,delete u._url,delete u._query,l=this.apiClient.request({path:d,queryParams:c,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(f=>f.json()),l.then(f=>{const p=xr(this.apiClient,f),h=new zt;return Object.assign(h,p),h})}else{const u=hr(this.apiClient,t);return d=b("tunedModels",u._url),c=u._query,delete u.config,delete u._url,delete u._query,l=this.apiClient.request({path:d,queryParams:c,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(i=t.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json()),l.then(f=>{const p=Ar(this.apiClient,f),h=new zt;return Object.assign(h,p),h})}}async tuneInternal(t){var e,n;let i,r="",l={};if(this.apiClient.isVertexAI()){const d=Ir(this.apiClient,t);return r=b("tuningJobs",d._url),l=d._query,delete d.config,delete d._url,delete d._query,i=this.apiClient.request({path:r,queryParams:l,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(c=>c.json()),i.then(c=>Qe(this.apiClient,c))}else throw new Error("This method is only supported by the Vertex AI.")}async tuneMldevInternal(t){var e,n;let i,r="",l={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const d=vr(this.apiClient,t);return r=b("tunedModels",d._url),l=d._query,delete d.config,delete d._url,delete d._query,i=this.apiClient.request({path:r,queryParams:l,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(c=>c.json()),i.then(c=>Mr(this.apiClient,c))}}}const Pr=1024*1024*8;async function Dr(o,t,e){var n,i;let r=0,l=0,d=new We(new Response),c="upload";for(r=o.size;l<r;){const f=Math.min(Pr,r-l),p=o.slice(l,l+f);if(l+f>=r&&(c+=", finalize"),d=await e.request({path:"",body:p,httpMethod:"POST",httpOptions:{apiVersion:"",baseUrl:t,headers:{"X-Goog-Upload-Command":c,"X-Goog-Upload-Offset":String(l),"Content-Length":String(f)}}}),l+=f,((n=d==null?void 0:d.headers)===null||n===void 0?void 0:n["x-goog-upload-status"])!=="active")break;if(r<=l)throw new Error("All content has been uploaded, but the upload status is not finalized.")}const u=await(d==null?void 0:d.json());if(((i=d==null?void 0:d.headers)===null||i===void 0?void 0:i["x-goog-upload-status"])!=="final")throw new Error("Failed to upload file: Upload status is not finalized.");return u.file}async function Lr(o){return{size:o.size,type:o.type}}class Nr{async upload(t,e,n){if(typeof t=="string")throw new Error("File path is not supported in browser uploader.");return await Dr(t,e,n)}async stat(t){if(typeof t=="string")throw new Error("File path is not supported in browser uploader.");return await Lr(t)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Br{create(t,e,n){return new Ur(t,e,n)}}class Ur{constructor(t,e,n){this.url=t,this.headers=e,this.callbacks=n}connect(){this.ws=new WebSocket(this.url),this.ws.onopen=this.callbacks.onopen,this.ws.onerror=this.callbacks.onerror,this.ws.onclose=this.callbacks.onclose,this.ws.onmessage=this.callbacks.onmessage}send(t){if(this.ws===void 0)throw new Error("WebSocket is not connected");this.ws.send(t)}close(){if(this.ws===void 0)throw new Error("WebSocket is not connected");this.ws.close()}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const fn="x-goog-api-key";class Fr{constructor(t){this.apiKey=t}async addAuthHeaders(t){t.get(fn)===null&&t.append(fn,this.apiKey)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const Vr="gl-node/";class de{constructor(t){var e;if(t.apiKey==null)throw new Error("An API Key must be set when running in a browser");if(t.project||t.location)throw new Error("Vertex AI project based authentication is not supported on browser runtimes. Please do not provide a project or location.");this.vertexai=(e=t.vertexai)!==null&&e!==void 0?e:!1,this.apiKey=t.apiKey;const n=Wn(t,void 0,void 0);n&&(t.httpOptions?t.httpOptions.baseUrl=n:t.httpOptions={baseUrl:n}),this.apiVersion=t.apiVersion;const i=new Fr(this.apiKey);this.apiClient=new cr({auth:i,apiVersion:this.apiVersion,apiKey:this.apiKey,vertexai:this.vertexai,httpOptions:t.httpOptions,userAgentExtra:Vr+"web",uploader:new Nr}),this.models=new Js(this.apiClient),this.live=new qs(this.apiClient,i,new Br),this.chats=new Go(this.models,this.apiClient),this.caches=new Uo(this.apiClient),this.files=new ei(this.apiClient),this.operations=new nr(this.apiClient),this.tunings=new Rr(this.apiClient)}}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
*/const qr="photobookAiDB",Gr=1,W="savedImages";function ot(){return new Promise((o,t)=>{const e=indexedDB.open(qr,Gr);e.onerror=()=>{var n;return t(new Error(`IndexedDB error: ${(n=e.error)==null?void 0:n.message}`))},e.onsuccess=()=>o(e.result),e.onupgradeneeded=n=>{const i=n.target.result;i.objectStoreNames.contains(W)||i.createObjectStore(W,{keyPath:"id"})}})}async function Hr(o){const e=(await ot()).transaction(W,"readwrite");return e.objectStore(W).put(o),new Promise((i,r)=>{e.oncomplete=()=>i(),e.onerror=()=>r(e.error)})}async function $r(){const n=(await ot()).transaction(W,"readonly").objectStore(W).getAll();return new Promise((i,r)=>{n.onsuccess=()=>i(n.result),n.onerror=()=>r(n.error)})}async function Yr(o){const e=(await ot()).transaction(W,"readwrite");return e.objectStore(W).delete(o),new Promise((i,r)=>{e.oncomplete=()=>i(),e.onerror=()=>r(e.error)})}function Jr(o){const t=o.split(","),e=t[0].match(/:(.*?);/);if(!e)throw new Error("Invalid data URL format");const n=e[1],i=atob(t[1]);let r=i.length;const l=new Uint8Array(r);for(;r--;)l[r]=i.charCodeAt(r);return new Blob([l],{type:n})}let J="generate",z=[],F=null,O=null,ie=null,K=null,k=!1,re=null,le=null,q=[],fe,pe,m,Ne,Ye,ae,je,pn,et,A=null,I=null,U=null,Be=!1,ye=30,V=[],G,he,Ln,hn,Ie,se;function Or(){document.body.innerHTML=`
        <main>
            <div class="column column-left">
                <div class="input-section">
                    <div class="header-section">
                        <img src="https://www.photobookvietnam.net/images/logo_rev.png" alt="Photobook Vietnam Logo" class="header-logo" />
                    </div>
                    <div class="tabs" style="display: none">
                        <button id="tab-generate" class="tab-button active" data-tab="generate">Tạo ảnh AI</button>
                        <button id="tab-background" class="tab-button" data-tab="background">Thay nền ảnh</button>
                        <button id="tab-restore" class="tab-button" data-tab="restore">Phục hồi ảnh cũ</button>
                        <button id="tab-inpaint" class="tab-button" data-tab="inpaint">Inpaint</button>
                    </div>
                    <div id="tab-content"></div>
                </div>
            </div>
            <div class="column column-right">
                <section id="output" class="output-section" aria-live="polite">
                    <div class="placeholder">
                        <p>Ảnh của bạn sẽ xuất hiện ở đây.</p>
                    </div>
                </section>
                <section id="saved-images-section" class="saved-images-section">
                    <h2>Ảnh đã lưu</h2>
                    <div id="saved-images-grid">
                        <p class="placeholder-text">Chưa có ảnh nào được lưu.</p>
                    </div>
                </section>
            </div>
        </main>
        <div id="zoom-modal" class="modal">
            <span id="modal-close-btn" class="modal-close" aria-label="Đóng chế độ xem phóng to">&times;</span>
            <img class="modal-content" id="zoomed-img" alt="Ảnh đã phóng to">
        </div>
    `,G=document.getElementById("output"),he=document.getElementById("zoom-modal"),Ln=document.getElementById("zoomed-img"),hn=document.getElementById("modal-close-btn"),Ie=document.getElementById("tab-content"),se=document.getElementById("saved-images-grid"),document.querySelectorAll(".tab-button").forEach(o=>{o.addEventListener("click",t=>{var i;const e=t.currentTarget,n=e.dataset.tab;n!==J&&(J=n,(i=document.querySelector(".tab-button.active"))==null||i.classList.remove("active"),e.classList.add("active"),gn())})}),hn.addEventListener("click",Tn),he.addEventListener("click",o=>{o.target===he&&Tn()}),window.addEventListener("resize",mn),mn(),$r().then(o=>{q.forEach(t=>URL.revokeObjectURL(t.url)),q=o.map(t=>({id:t.id,url:URL.createObjectURL(t.blob)})),me()}).catch(o=>{console.error("Failed to load images from IndexedDB",o),q=[],me()}),gn(),me()}function mn(){const o=document.querySelector("main"),t=document.querySelector(".input-section"),e=document.querySelector(".column-right"),n=document.getElementById("output"),i=document.getElementById("saved-images-section");if(!o||!t||!e||!n||!i)return;if(window.innerWidth<1024){let l=document.getElementById("mobile-results-wrapper");if(!l){l=document.createElement("div"),l.id="mobile-results-wrapper",l.innerHTML=`
                <div class="mobile-results-header">
                    <span>Xem kết quả & Ảnh đã lưu</span>
                    <span class="toggle-arrow"></span>
                </div>
                <div class="mobile-results-content"></div>
            `;const c=l.querySelector(".mobile-results-header");c==null||c.addEventListener("click",()=>{l==null||l.classList.toggle("collapsed")})}const d=l.querySelector(".mobile-results-content");d&&(d.appendChild(n),d.appendChild(i)),t.appendChild(l),l.classList.remove("collapsed")}else{let l=document.getElementById("mobile-results-wrapper");l&&(e.appendChild(n),e.appendChild(i),l.remove())}}function gn(){J==="generate"?Kr():J==="background"?Wr():J==="restore"?zr():Xr()}function Kr(){Ie.innerHTML=`
        <div class="generator-top-container">
            <div id="image-upload" class="drop-zone large" role="button" tabindex="0" aria-label="Vùng tải ảnh lên">
                <div id="generator-image-preview" class="single-preview-container large">
                    <p style="font-size: 14pt">Nhấn(Bấm) ở đây để chọn ảnh</p>
                </div>
                <input type="file" id="file-input" accept="image/*" hidden>
            </div>
            <div class="generator-options">
                <div id="keep-face-section" class="checkbox-section hidden">
                    <input type="checkbox" checked="true" id="keep-face-checkbox">
                    <label for="keep-face-checkbox">Giữ khuôn mặt</label>
                </div>
                <div id="aspect-ratio-wrapper" class="aspect-ratio-section">
                    <label for="aspect-ratio">Tỷ lệ khung hình</label>
                    <select id="aspect-ratio">
                        <option value="1:1" selected>Vuông (1:1)</option>
                        <option value="3:4">Dọc (3:4)</option>
                        <option value="4:3">Ngang (4:3)</option>
                        <option value="9:16">Cao (9:16)</option>
                        <option value="16:9">Rộng (16:9)</option>
                    </select>
                </div>
            </div>
        </div>

        <div style="display: none">
            <div class="prompt-header">
                <label id="prompt-input-label" for="prompt-input">Mô tả</label>
                <div class="prompt-buttons">
                    <button id="clear-prompt-btn" aria-label="Xóa mô tả">Xóa</button>
                    <button id="analyze-btn">Phân tích ảnh</button>
                </div>
            </div>
            <textarea id="prompt-input" placeholder="Ví dụ: Một chú mèo oai vệ đội mũ dự tiệc" aria-labelledby="prompt-input-label"></textarea>
        </div>

        <div class="sub-tabs">
            <button class="sub-tab-button active" data-subtab="baby">Bé dưới 1 tuồi</button>
            <button class="sub-tab-button" data-subtab="so-sinh">Bé sơ sinh</button>
            <button class="sub-tab-button" data-subtab="trung-thu">Trung Thu</button>
        </div>

        <div id="sub-tab-content">
            <div id="sub-tab-panel-so-sinh" class="sub-tab-panel">
                <div class="templates-section">
                    <label>Sơ sinh</label>
                    <div class="template-buttons-container">
                        <button id="baby-template-btn-1" class="template-button" aria-label="Sử dụng mẫu Trung Thu 1">
                            <img src="https://canvasvietnam.com/images/baby1.jpg" alt="">
                            <span>Baby 1</span>
                        </button>
                        <button id="baby-template-btn-2" class="template-button" aria-label="Sử dụng mẫu Trung Thu 2">
                            <img src="https://canvasvietnam.com/images/baby2.jpg" alt="">
                            <span>Baby 2</span>
                        </button>
                        <button id="baby-template-btn-3" class="template-button" aria-label="Sử dụng mẫu Trung Thu 3">
                            <img src="https://canvasvietnam.com/images/baby3.jpg" alt="">
                            <span>Baby 3</span>
                        </button>
                        <button id="baby-template-btn-4" class="template-button" aria-label="Sử dụng mẫu Trung Thu 3">
                            <img src="https://canvasvietnam.com/images/baby4.jpg" alt="">
                            <span>Baby 4</span>
                        </button>
                        <button id="baby-template-btn-5" class="template-button" aria-label="Sử dụng mẫu Trung Thu 3">
                            <img src="https://canvasvietnam.com/images/baby5.jpg" alt="">
                            <span>Baby 5</span>
                        </button>
                        <button id="baby-template-btn-6" class="template-button" aria-label="Sử dụng mẫu Trung Thu 1">
                            <img src="https://canvasvietnam.com/images/baby6.jpg" alt="">
                            <span>Baby 6</span>
                        </button>
                        <button id="baby-template-btn-7" class="template-button" aria-label="Sử dụng mẫu Trung Thu 2">
                            <img src="https://canvasvietnam.com/images/baby7.jpg" alt="">
                            <span>Baby 7</span>
                        </button>
                        <button id="baby-template-btn-8" class="template-button" aria-label="Sử dụng mẫu Trung Thu 3">
                            <img src="https://canvasvietnam.com/images/baby8.jpg" alt="">
                            <span>Baby 8</span>
                        </button>
                        <button id="baby-template-btn-9" class="template-button" aria-label="Sử dụng mẫu Trung Thu 3">
                            <img src="https://canvasvietnam.com/images/baby9.jpg" alt="">
                            <span>Baby 9</span>
                        </button>
                        <button id="baby-template-btn-10" class="template-button" aria-label="Sử dụng mẫu Trung Thu 1">
                            <img src="https://canvasvietnam.com/images/baby10.jpg" alt="">
                            <span>Baby 10</span>
                        </button>
                        <button id="baby-template-btn-11" class="template-button" aria-label="Sử dụng mẫu Trung Thu 2">
                            <img src="https://canvasvietnam.com/images/baby11.jpg" alt="">
                            <span>Baby 11</span>
                        </button>
                        <button id="baby-template-btn-12" class="template-button" aria-label="Sử dụng mẫu Trung Thu 3">
                            <img src="https://canvasvietnam.com/images/baby12.jpg" alt="">
                            <span>Baby 12</span>
                        </button>
                    </div>
                </div>
            </div>
            <div id="sub-tab-panel-trung-thu" class="sub-tab-panel">
                <div class="templates-section">
                    <label>Bé trai</label>
                    <div class="template-buttons-container">
                        <button id="trung-thu-template-btn-1" class="template-button" aria-label="Sử dụng mẫu Trung Thu 1">
                            <img src="https://canvasvietnam.com/images/trungthu1.jpg" alt="Bé trai mặc đồ Trung Thu, xung quanh là đèn lồng và đầu lân">
                            <span>Dưới 1 tuổi</span>
                        </button>
                        <button id="trung-thu-template-btn-2" class="template-button" aria-label="Sử dụng mẫu Trung Thu 2">
                            <img src="https://canvasvietnam.com/images/trungthu2.jpg" alt="Bé trai mặc đồ Trung Thu, xung quanh là đèn lồng và đầu lân">
                            <span>1-3 tuổi</span>
                        </button>
                        <button id="trung-thu-template-btn-3" class="template-button" aria-label="Sử dụng mẫu Trung Thu 3">
                            <img src="https://canvasvietnam.com/images/trungthu3.jpg" alt="Bé trai mặc đồ Trung Thu, xung quanh là đèn lồng và đầu lân">
                            <span>1-3 tuổi</span>
                        </button>

                        <button id="trung-thu-template-btn-6" class="template-button" aria-label="Sử dụng mẫu Trung Thu 3">
                            <img src="https://canvasvietnam.com/images/trungthu6.jpg" alt="Bé trai mặc đồ Trung Thu, xung quanh là đèn lồng và đầu lân">
                            <span>1-3 tuổi</span>
                        </button>
                    </div>
                </div>

                <div class="templates-section">
                    <label>Bé gái</label>
                    <div class="template-buttons-container">
                        
                        <button id="trung-thu-template-btn-4" class="template-button" aria-label="Sử dụng mẫu Trung Thu 3">
                            <img src="https://canvasvietnam.com/images/trungthu4.jpg" alt="Bé trai mặc đồ Trung Thu, xung quanh là đèn lồng và đầu lân">
                            <span>Dưới 1 tuổi</span>
                        </button>
                        <button id="trung-thu-template-btn-5" class="template-button" aria-label="Sử dụng mẫu Trung Thu 3">
                            <img src="https://canvasvietnam.com/images/trungthu5.jpg" alt="Bé trai mặc đồ Trung Thu, xung quanh là đèn lồng và đầu lân">
                            <span>3-5 tuổi</span>
                        </button>
                        <button id="trung-thu-template-btn-7" class="template-button" aria-label="Sử dụng mẫu Trung Thu 3">
                            <img src="https://canvasvietnam.com/images/trungthu7.jpg" alt="Bé trai mặc đồ Trung Thu, xung quanh là đèn lồng và đầu lân">
                            <span>5-10 tuổi</span>
                        </button>
                        <button id="trung-thu-template-btn-8" class="template-button" aria-label="Sử dụng mẫu Trung Thu 3">
                            <img src="https://canvasvietnam.com/images/trungthu8.jpg" alt="Bé trai mặc đồ Trung Thu, xung quanh là đèn lồng và đầu lân">
                            <span>3-5 tuổi</span>
                        </button>
                        <button id="trung-thu-template-btn-9" class="template-button" aria-label="Sử dụng mẫu Trung Thu 3">
                            <img src="https://canvasvietnam.com/images/trungthu9.jpg" alt="Bé trai mặc đồ Trung Thu, xung quanh là đèn lồng và đầu lân">
                            <span>5-10 tuổi</span>
                        </button>
                        <button id="trung-thu-template-btn-10" class="template-button" aria-label="Sử dụng mẫu Trung Thu 3">
                            <img src="https://canvasvietnam.com/images/trungthu10.jpg" alt="Bé trai mặc đồ Trung Thu, xung quanh là đèn lồng và đầu lân">
                            <span>5-10 tuổi</span>
                        </button>
                        <button id="trung-thu-template-btn-11" class="template-button" aria-label="Sử dụng mẫu Trung Thu 3">
                            <img src="https://canvasvietnam.com/images/trungthu11.jpg" alt="Bé trai mặc đồ Trung Thu, xung quanh là đèn lồng và đầu lân">
                            <span>5-10 tuổi</span>
                        </button>
                        <button id="trung-thu-template-btn-12" class="template-button" aria-label="Sử dụng mẫu Trung Thu 3">
                            <img src="https://canvasvietnam.com/images/trungthu12.jpg" alt="Bé trai mặc đồ Trung Thu, xung quanh là đèn lồng và đầu lân">
                            <span>1-3 tuổi</span>
                        </button>
                    </div>
                </div>
            </div>
             <div id="sub-tab-panel-baby" class="sub-tab-panel active">
                <div class="templates-section">
                    <label>Gần 1 tuổi</label>
                    <div class="template-buttons-container">
                        <button id="baby-template-btn-13" class="template-button" aria-label="Sử dụng mẫu Trung Thu 1">
                            <img src="https://canvasvietnam.com/images/baby13.jpg" alt="">
                            <span>Baby 13</span>
                        </button>
                        <button id="baby-template-btn-14" class="template-button" aria-label="Sử dụng mẫu Trung Thu 1">
                            <img src="https://canvasvietnam.com/images/baby14.jpg" alt="">
                            <span>Baby 14</span>
                        </button>
                        <button id="baby-template-btn-15" class="template-button" aria-label="Sử dụng mẫu Trung Thu 1">
                            <img src="https://canvasvietnam.com/images/baby15.jpg" alt="">
                            <span>Baby 15</span>
                        </button>
                        <button id="baby-template-btn-16" class="template-button" aria-label="Sử dụng mẫu Trung Thu 1">
                            <img src="https://canvasvietnam.com/images/baby16.jpg" alt="">
                            <span>Baby 16</span>
                        </button>
                        <button id="baby-template-btn-17" class="template-button" aria-label="Sử dụng mẫu Trung Thu 1">
                            <img src="https://canvasvietnam.com/images/baby17.jpg" alt="">
                            <span>Baby 17</span>
                        </button>
                        <button id="baby-template-btn-18" class="template-button" aria-label="Sử dụng mẫu Trung Thu 1">
                            <img src="https://canvasvietnam.com/images/baby18.jpg" alt="">
                            <span>Baby 18</span>
                        </button>
                        <button id="baby-template-btn-19" class="template-button" aria-label="Sử dụng mẫu Trung Thu 1">
                            <img src="https://canvasvietnam.com/images/baby19.jpg" alt="">
                            <span>Baby 19</span>
                        </button>
                        <button id="baby-template-btn-20" class="template-button" aria-label="Sử dụng mẫu Trung Thu 1">
                            <img src="https://canvasvietnam.com/images/baby20.jpg" alt="">
                            <span>Baby 20</span>
                        </button>
                        <button id="baby-template-btn-21" class="template-button" aria-label="Sử dụng mẫu Trung Thu 1">
                            <img src="https://canvasvietnam.com/images/baby21.jpg" alt="">
                            <span>Baby 21</span>
                        </button>
                        <button id="baby-template-btn-22" class="template-button" aria-label="Sử dụng mẫu Trung Thu 1">
                            <img src="https://canvasvietnam.com/images/baby22.jpg" alt="">
                            <span>Baby 22</span>
                        </button>
                        <button id="baby-template-btn-23" class="template-button" aria-label="Sử dụng mẫu Trung Thu 1">
                            <img src="https://canvasvietnam.com/images/baby23.jpg" alt="">
                            <span>Baby 23</span>
                        </button>
                        <button id="baby-template-btn-24" class="template-button" aria-label="Sử dụng mẫu Trung Thu 1">
                            <img src="https://canvasvietnam.com/images/baby24.jpg" alt="">
                            <span>Baby 24</span>
                        </button>
                    </div>
                </div>
                
                
            </div>
        </div>

        <button id="generate-btn" disabled>Tạo ảnh</button>
    `,fe=document.getElementById("image-upload"),pe=document.getElementById("generator-image-preview"),m=document.getElementById("prompt-input"),Ne=document.getElementById("generate-btn"),Ye=document.getElementById("file-input"),ae=document.getElementById("analyze-btn"),je=document.getElementById("aspect-ratio"),pn=document.getElementById("clear-prompt-btn"),et=document.getElementById("keep-face-checkbox"),document.getElementById("keep-face-section");const o=document.getElementById("trung-thu-template-btn-1"),t=document.getElementById("trung-thu-template-btn-2"),e=document.getElementById("trung-thu-template-btn-3"),n=document.getElementById("trung-thu-template-btn-4"),i=document.getElementById("trung-thu-template-btn-5"),r=document.getElementById("trung-thu-template-btn-6"),l=document.getElementById("trung-thu-template-btn-7"),d=document.getElementById("trung-thu-template-btn-8"),c=document.getElementById("trung-thu-template-btn-9"),u=document.getElementById("trung-thu-template-btn-10"),f=document.getElementById("trung-thu-template-btn-11"),p=document.getElementById("trung-thu-template-btn-12"),h=document.getElementById("baby-template-btn-1"),g=document.getElementById("baby-template-btn-2"),y=document.getElementById("baby-template-btn-3"),T=document.getElementById("baby-template-btn-4"),E=document.getElementById("baby-template-btn-5"),w=document.getElementById("baby-template-btn-6"),S=document.getElementById("baby-template-btn-7"),_=document.getElementById("baby-template-btn-8"),C=document.getElementById("baby-template-btn-9"),x=document.getElementById("baby-template-btn-10"),ee=document.getElementById("baby-template-btn-11"),te=document.getElementById("baby-template-btn-12"),ne=document.getElementById("baby-template-btn-13"),oe=document.getElementById("baby-template-btn-14"),D=document.getElementById("baby-template-btn-15"),Y=document.getElementById("baby-template-btn-16"),_e=document.getElementById("baby-template-btn-17"),Ae=document.getElementById("baby-template-btn-18"),B=document.getElementById("baby-template-btn-19"),ce=document.getElementById("baby-template-btn-20"),Vn=document.getElementById("baby-template-btn-21"),qn=document.getElementById("baby-template-btn-22"),Gn=document.getElementById("baby-template-btn-23"),Hn=document.getElementById("baby-template-btn-24");fe.addEventListener("click",()=>Ye.click()),Ye.addEventListener("change",il),fe.addEventListener("dragover",be),fe.addEventListener("dragleave",Ee),fe.addEventListener("drop",al),m.addEventListener("input",X),Ne.addEventListener("click",cl),ae.addEventListener("click",dl),pn.addEventListener("click",ol),document.querySelectorAll(".sub-tab-button").forEach(v=>{v.addEventListener("click",$e=>{var lt,ut;const rt=$e.currentTarget,$n=rt.dataset.subtab;(lt=document.querySelector(".sub-tab-button.active"))==null||lt.classList.remove("active"),rt.classList.add("active"),document.querySelectorAll(".sub-tab-panel").forEach(Yn=>{Yn.classList.remove("active")}),(ut=document.getElementById(`sub-tab-panel-${$n}`))==null||ut.classList.add("active")})}),o.addEventListener("click",()=>{if(m){const v="Ultra-realistic milestone portrait of a baby girl with the exact real face from the uploaded photo. Create an image of a baby (1–2 years old) in the atmosphere of the Mid-Autumn Festival. The baby is sitting on a rustic bamboo bed, wearing a traditional Vietnamese red yếm (halter-neck top) paired with green pants, along with a vibrant lion dance hat decorated with fluffy white trim and colorful embroidery. The baby is holding a small mooncake in both hands, gazing at it with curious, innocent eyes. Around the scene are iconic Mid-Autumn details: a lion dance head placed nearby, a plate of ripe golden persimmons, a black lacquer tray with a teapot and lotus flowers, and vases with blooming lotuses and kumquat branches. The bamboo wall backdrop is decorated with red and green star-shaped lanterns, colorful fabric lanterns, and shimmering tinsel garlands, recreating a lively festival setting. Warm lighting highlights the scene, evoking a cozy and nostalgic feeling of traditional Vietnamese Mid-Autumn celebrations. High-resolution, ultra-realistic, natural, festive, and heartwarming style.";m.value=v,m.dispatchEvent(new Event("input"))}}),t.addEventListener("click",()=>{if(m){const v=`Ultra-realistic milestone portrait of a baby girl with the exact real face from the uploaded photo. A full-body portrait of a young boy sitting on a small bamboo bench, set in a vibrant Mid-Autumn Festival scene. He is wearing a light beige traditional Vietnamese ao dai with simple brown trousers and a classic black khan xep (turban-style headpiece). In his hand, he holds a red paper fan and smiles brightly.
Next to him is a small bamboo table displaying traditional mooncakes and an old-style oil lamp. Surrounding him are festive Mid-Autumn decorations: a large red carp-shaped lion head, star-shaped lanterns, bamboo toys, and fresh green bamboo leaves.
The background features a red wooden wall adorned with hanging festive ornaments, illuminated by warm indoor lighting that creates a nostalgic and culturally rich atmosphere.
Style: Cinematic, ultra-realistic photography with strong traditional Vietnamese cultural aesthetics and vibrant festive details.
Lighting: Warm indoor festival lighting with golden tones and soft shadows.
Mood: Joyful, festive, cultural, and nostalgic.
Camera Settings:
Shot: Full-body portrait, eye-level perspective
Focus: Strong focus on the boy’s face (must match the uploaded reference image exactly), with the background softly blurred.
Aspect Ratio: 9:16
Important Notes:
Face: Use the exact face, hairstyle, expression, and features from the uploaded photo. Absolutely no modification allowed.
Outfit:
Beige traditional ao dai
Simple brown trousers
Classic black khan xep (turban-style headpiece)
Accessory: Red paper fan in hand
Background: Include a large red carp lion head, star lanterns, bamboo toys, mooncakes, an oil lamp, green bamboo leaves, and a red wooden wall.`;m.value=v,m.dispatchEvent(new Event("input"))}}),e.addEventListener("click",()=>{if(m){const v="Ultra-realistic milestone portrait of a baby girl with the exact real face from the uploaded photo. A full-body portrait of a young boy in a Mid-Autumn Festival setting, dressed in a traditional Vietnamese festive outfit. He is wearing a white cross-collar shirt with a lion head embroidery on the chest, paired with bright red shorts and a matching red cap. He is barefoot, smiling happily, and playfully raising one hand. Next to him is a large red festival drum and scattered traditional toys. The background features a giant decorative red carp (symbol of Mid-Autumn), red cherry blossom branches, colorful butterfly lanterns, and festive ornaments. The atmosphere is joyful, festive, and culturally rich, styled in a cinematic, ultra-realistic way. IMPORTANT: Preserve the exact face, identity, and expression from the uploaded reference photo. The face must match perfectly and not be altered";m.value=v,m.dispatchEvent(new Event("input"))}}),n.addEventListener("click",()=>{if(m){const v=`Ultra-realistic milestone portrait of a baby girl with the exact real face from the uploaded photo. Create an image of a 1-year-old baby girl in the cheerful atmosphere of the Mid-Autumn Festival. The baby is sitting happily on the floor, wearing a traditional Vietnamese red silk halter top (áo yếm) paired with green pants, with a matching red bow in her hair. She is holding a small wooden drumstick, joyfully playing the red toy drum in front of her, with an excited, bright smile.
The background is decorated with vibrant Mid-Autumn details: red paper lanterns, a colorful lion dance head, and a playful cutout of a lion figure. Behind her, a festive banner with the words “Tết Trung Thu” is displayed. Warm golden lighting enhances the vivid red and green tones, creating a lively, traditional, and heartwarming celebration scene. High-resolution, ultra-realistic, festive, and adorable style.`;m.value=v,m.dispatchEvent(new Event("input"))}}),i.addEventListener("click",()=>{if(m){const v="Ultra-realistic milestone portrait of a baby girl with the exact real face from the uploaded photo. A full-body portrait of a young child dressed in a traditional red festive outfit for Mid-Autumn Festival. The outfit is a sleeveless red halter-top with a decorative floral emblem at the chest, paired with a flowing red skirt layered with white fabric underneath. The child wears a matching headpiece with blue and red accents, smiling with joy. She is standing in front of a vibrant Mid-Autumn Festival stage decorated with a large glowing full moon at the center, surrounded by red curtains and large yellow-orange flower decorations. Traditional items such as drums, star-shaped lanterns, and a colorful lion dance mask are placed around the stage. The atmosphere is festive, warm, and joyful, styled in a cinematic and ultra-realistic way. IMPORTANT: Preserve the exact face, identity, and expression from the uploaded reference photo. The face must remain identical to the uploaded image, with no alterations";m.value=v,m.dispatchEvent(new Event("input"))}}),r.addEventListener("click",()=>{if(m){const v=`Ultra-realistic milestone portrait of a baby girl with the exact real face from the uploaded photo. A traditional Mid-Autumn Festival portrait of a young child sitting on a wooden chair in a festive indoor setup. The child is dressed in a simple brown áo bà ba outfit with buttoned top and loose pants, paired with a black-and-white checkered khăn rằn tied around the head. On the child's lap is a colorful star lantern decorated with green tinsel. Around the setting are typical Mid-Autumn decorations: red velvet curtain backdrop with multiple star lanterns hanging, painted paper masks with smiling faces, a small lion dance head, and dried floral arrangements with warm autumn tones. On a low wooden table next to the child are mooncakes, a ceramic tea set, toy figurines, and festive ornaments. The atmosphere is warm, nostalgic, and joyful. Keep everything exactly the same, only replace the face with the exact face from the uploaded image, preserving all natural features and expression accurately.",
"style": "Studio photography, cultural, realistic",
"mood": "Festive, nostalgic, warm, joyful",
"lighting": "Soft warm studio light, highlighting the child and decorations, gentle shadows",
"details": {
"subject": {
"face": "Use the exact face from the uploaded image",
"outfit": "Brown áo bà ba with buttoned shirt and loose pants",
"accessories": "Black-and-white checkered khăn rằn tied on head",
"pose": "Sitting on wooden chair, holding a star lantern on lap"
},
"props": {
"lantern": "Star lantern with green tinsel",
"decor": "Red velvet curtain with star lanterns, painted masks, lion dance head",
"table": "Wooden table with mooncakes, tea set, and Mid-Autumn ornaments"
},
"background": "Festive indoor Mid-Autumn setup with red curtains and seasonal decor"`;m.value=v,m.dispatchEvent(new Event("input"))}}),l.addEventListener("click",()=>{if(m){const v="Ultra-realistic milestone portrait of a baby girl with the exact real face from the uploaded photo. A festive Mid-Autumn portrait of a little girl sitting gracefully against a deep red background (use upload photo). She has a slim, delicate figure and is dressed in a red halter-neck dress with layered fabric and a flowing white skirt underneath. A matching red headband adorns her hair. She leans her head gently against an oversized mooncake prop with intricate traditional patterns, as if peacefully resting. Behind her, decorative golden paper fish float in the air, symbolizing prosperity, while a large red flower and golden lattice panel accentuate the scene. The overall setup is artistic, warm, and celebratory of Mid-Autumn traditions. Lighting is soft and even, casting a festive glow over the child and props. Keep all outfits, background, and details the same. Only replace the face with the exact face from the uploaded image, preserving";m.value=v,m.dispatchEvent(new Event("input"))}}),d.addEventListener("click",()=>{if(m){const v="Ultra-realistic milestone portrait of a baby girl with the exact real face from the uploaded photo. A little girl (use upload photo) in a red traditional festive outfit is standing barefoot on a giant mooncake stage. She is gracefully raising her right arm, holding a small lantern, with her left arm extended sideways like dancing. Her outfit is a deep red halter dress with layered fabric and a large bow on the chest, decorated with subtle golden patterns. Her hair is styled neatly with a red flower accessory. The background is a Mid-Autumn Festival setup with a big glowing moon, bright red velvet curtains, colorful paper clouds, green fabric ribbons, and traditional festive toys (lion head, paper rooster, mini lanterns). The atmosphere is joyful, vibrant, and theatrical. Keep all details exactly the same, only replace the face with the on";m.value=v,m.dispatchEvent(new Event("input"))}}),c.addEventListener("click",()=>{if(m){const v=`Ultra-realistic milestone portrait of a baby girl with the exact real face from the uploaded photo. A high-resolution studio portrait capturing the joyful spirit of a young Vietnamese girl, aged approximately 8-10, celebrating the Mid-Autumn Festival. The girl is seated cross-legged on a richly patterned red and gold oriental rug, facing forward with a beaming, and look directed at the viewer. She is holding up two elaborately patterned, golden-brown mooncakes, one in each hand. Her attire consists of a vibrant red, traditional Chinese-style silk top with a halter neckline and delicate, shiny gold dragonfly embroidery throughout. She also wears a dark teal or navy blue pleated skirt. Her hair is styled in two high pigtail buns, adorned with large red satin bows and ribbons that cascade down her back. Her eyes are bright, and she has subtle, festive orange eyeshadow and red lipstick. The background is a deep, rich red, pleated velvet curtain, creating a luxurious and festive ambiance. Centered above the girl is a large, glowing, soft yellow full moon prop. To her left, partially obscured, stands a detailed, fluffy red lion dance head decoration with golden eyes, resting on a dark wooden pedestal. A colorful pinwheel toy and a small red drum are also visible near the lion head. To her right, several decorative paper fish lanterns with intricate patterns and vibrant colors (red, gold, green, blue) hang from the curtain, alongside two smaller, traditional red paper lanterns. A low, dark wooden table or stool is positioned behind her to the left, holding a traditional ceramic tea set (teapot and cups) and a red tinsel garland. Another small, woven bamboo basket containing additional mooncakes sits on the rug near her feet. The lighting is soft, warm, and inviting, emanating from the front and slightly above, highlighting the girl's face and the mooncakes while casting gentle shadows on the curtains, enhancing the festive and cozy atmosphere. The overall composition is balanced and full of traditional cultural elements, rich in red, gold, and warm tones, conveying celebration and happiness.
`;m.value=v,m.dispatchEvent(new Event("input"))}}),u.addEventListener("click",()=>{if(m){const v=`Ultra-realistic milestone portrait of a baby girl with the exact real face from the uploaded photo. A full-body studio photograph featuring a young girl (from the input image), she holding a small woven basket containing a miniature mooncake. The child is dressed in a flowing, traditional-inspired dress with layers of pastel peach, mint green, and light blue fabrics, complemented by a white long-sleeved undershirt with ruffled cuffs. The lighting is high-key and soft, creating a dreamlike and ethereal atmosphere.
The background is an elaborately decorated Mid-Autumn Festival themed set. Dominating the center-back is a large, circular, golden-orange full moon backdrop with the English calligraphy "Trung Thu" (Mid-Autumn) written on it. Above the moon, a vibrant red and yellow decorative fish lantern hangs. To the left, a tall cream-colored arched panel features an ornate cutout shape enclosing a decorative white lantern. Lush green lotus leaves and white lotus flowers, some adorned with subtle fairy lights, are scattered across the scene, adding depth and organic elements.
On the ground, wispy white fog or mist covers the floor, creating a magical, cloud-like effect. To the left, a large, intricately carved wooden prop resembling a gigantic mooncake sits next to a small, glossy red drum-like stool. To the right of the child, a small wooden table holds a traditional woven teapot and several individual mooncakes. Further to the right, another cream-colored arched panel frames a hanging lantern, and stylized dark green and blue mountain props create a layered landscape. White rabbit cutouts are visible near the child's table and further back, symbolizing the Mid-Autumn legend.
The overall aesthetic is whimsical and enchanting, with a rich but gentle color palette dominated by pastels (peach, mint, cream, light blue) and warm accents (golden orange, crimson red, brown), offset by deep teal and dark green in the background elements. The composition is balanced, with the child slightly off-center, framed by the detailed and festive decor, creating a sense of wonder and celebration.`;m.value=v,m.dispatchEvent(new Event("input"))}}),f.addEventListener("click",()=>{if(m){const v=`Ultra-realistic milestone portrait of a baby girl with the exact real face from the uploaded photo. A whimsical and joyful photograph of a young Vietnamese child, in 6-8 years old, dressed in a beautiful traditional Chinese Hanfu-style outfit. The outfit features flowing, sheer fabrics in soft pastel green and creamy yellow tones, with intricate, delicate embroidery or patterns adorning the bodice and a wide sash at the waist. The child wears a charming white and pink bunny ear headband, and their hair is styled in a traditional updo with small floral decorations. They hold a glowing, spherical yellow object, reminiscent of a lantern or a full moon, in their right hand, raised slightly. A sweet, innocent smile lights up their face, conveying joy and warmth.
The background is a soft, seamless pastel green, creating a bright and airy atmosphere. Several bokeh-effect, blurry spherical yellow and orange lights (suggesting moons, lanterns, or auspicious fruits) float gently in the distant background, adding a dreamlike quality. Subtle, ethereal floral motifs also appear softly blurred in the background.
The lighting is soft, ethereal, and even, casting a gentle glow on the subject without harsh shadows, characteristic of high-key studio photography. The dominant color palette consists of light greens, creams, soft yellows, with touches of pale orange, pink, and white.
The composition is a three-quarter length shot, centered on the child, allowing for ample negative space that enhances the whimsical and traditional aesthetic. The overall style is reminiscent of fine art photography, celebrating cultural tradition with a dreamy, festive, and innocent charm, perfect for a Mid-Autumn Festival theme.`;m.value=v,m.dispatchEvent(new Event("input"))}}),p.addEventListener("click",()=>{if(m){const v=`Ultra-realistic milestone portrait of a baby girl with the exact real face from the uploaded photo. Create an image of a 1-year-old baby girl in the cheerful atmosphere of the Mid-Autumn Festival. The baby is sitting happily on the floor, wearing a traditional Vietnamese red silk halter top (áo yếm) paired with green pants, with a matching red bow in her hair. She is holding a small wooden drumstick, joyfully playing the red toy drum in front of her, with an excited, bright smile.
The background is decorated with vibrant Mid-Autumn details: red paper lanterns, a colorful lion dance head, and a playful cutout of a lion figure. Behind her, a festive banner with the words “Tết Trung Thu” is displayed. Warm golden lighting enhances the vivid red and green tones, creating a lively, traditional, and heartwarming celebration scene. High-resolution, ultra-realistic, festive, and adorable style`;m.value=v,m.dispatchEvent(new Event("input"))}}),h.addEventListener("click",()=>{if(m){const v="Ultra-realistic milestone portrait of a baby girl with the exact real face from the uploaded photo. Create a newborn photoshoot of a 1–2 month-old baby sleeping peacefully on a fluffy white rug, dressed in a hand-knitted green dinosaur outfit with a hood featuring cute spikes. Surround the baby with small crocheted dinosaur plush toys and pastel dinosaur eggs placed neatly on green tropical leaves. The warm bokeh background creates a dreamy, fairytale-like atmosphere. Soft studio lighting highlights the baby’s delicate skin and the handmade textures, resulting in a cozy, whimsical, and adorable scene";m.value=v,m.dispatchEvent(new Event("input"))}}),g.addEventListener("click",()=>{if(m){const v="Ultra-realistic milestone portrait of a baby girl with the exact real face from the uploaded photo. Create a heartwarming newborn photoshoot of a 1–2 month-old baby peacefully sleeping on top of a soft pastel green long-neck dinosaur plush toy. The baby is dressed in a cream-colored knitted romper with long sleeves and a matching knitted hat with tiny ears. The baby’s body rests gently on the dinosaur’s back, arms folded under the cheek, creating a serene and dreamy sleeping pose. The background is a smooth pastel mint green, minimal and clean, enhancing the softness and purity of the scene. Soft studio lighting highlights the baby’s delicate skin and the plush dinosaur’s gentle texture, resulting in an adorable, whimsical, and tender atmosphere";m.value=v,m.dispatchEvent(new Event("input"))}}),y.addEventListener("click",()=>{if(m){const v="Ultra-realistic milestone portrait of a baby girl with the exact real face from the uploaded photo. Create an adorable newborn photoshoot of a baby dressed in a fluffy brown bear costume with little ears and a tiny bee decoration on the hood. The baby is gently leaning on a plush honey pot labeled “SUNNY,” surrounded by soft orange flowers and small plush bees. Warm orange pastel backdrop with soft glowing lighting, dreamy and heartwarming atmosphere, high-resolution studio photography, clean and minimal composition.";m.value=v,m.dispatchEvent(new Event("input"))}}),T.addEventListener("click",()=>{if(m){const v="Ultra-realistic milestone portrait of a baby girl with the exact real face from the uploaded photo. Create an image of the baby in the uploaded photo, preserving all natural features and expressions. The baby is sitting against a bright yellow background, wearing a yellow-and-white gingham bonnet tied under the chin, with a lemon placed on top of the head. The outfit is a sleeveless yellow bodysuit with a small embroidered duck on the front. The baby’s cheeks are chubby and slightly blushed. High-resolution, ultra-realistic, studio-quality photo with vibrant colors and a cheerful atmosphere.";m.value=v,m.dispatchEvent(new Event("input"))}}),E.addEventListener("click",()=>{if(m){const v="Ultra-realistic milestone portrait of a baby girl with the exact real face from the uploaded photo. Create a heartwarming studio photoshoot of a newborn baby lying peacefully on the tummy with arms gently folded under the chin, dressed in a fluffy brown bear costume with a tiny bee on the hood. The baby is positioned between two plush honey jars dripping with felt honey, surrounded by orange and white felt flowers and small plush bees. Warm orange pastel backdrop, soft glowing light, dreamy and adorable atmosphere, high-resolution, clean and minimal newborn photography style";m.value=v,m.dispatchEvent(new Event("input"))}}),w.addEventListener("click",()=>{if(m){const v="Ultra-realistic milestone portrait of a baby girl with the exact real face from the uploaded photo. Create a newborn photoshoot of a 1–2 month-old baby sleeping peacefully on a fluffy white rug, dressed in a hand-knitted green dinosaur outfit with a hood featuring cute spikes. Surround the baby with small crocheted dinosaur plush toys and pastel dinosaur eggs placed neatly on green tropical leaves. The warm bokeh background creates a dreamy, fairytale-like atmosphere. Soft studio lighting highlights the baby’s delicate skin and the handmade textures, resulting in a cozy, whimsical, and adorable scene.";m.value=v,m.dispatchEvent(new Event("input"))}}),S.addEventListener("click",()=>{if(m){const v="Ultra-realistic milestone portrait of a baby girl with the exact real face from the uploaded photo. Create an newborn photo of a baby, peacefully sleeping while wrapped snugly in a deep red swaddle blanket. The baby is wearing a festive lion dance hat made of soft white fabric with fluffy details, colorful embroidery, and playful pom-poms, evoking a cheerful Mid-Autumn Festival vibe. The baby is placed gently in a rustic wooden bowl lined with soft fur, resting on a woven mat with warm earthy tones. Around the setup, add traditional Mid-Autumn toys such as a small fabric lion toy and festive decorations. The background is wooden flooring, creating a cozy, rustic atmosphere. High-resolution, ultra-realistic, soft studio lighting, warm and heartwarming style";m.value=v,m.dispatchEvent(new Event("input"))}}),_.addEventListener("click",()=>{if(m){const v=`Ultra-realistic milestone portrait of a baby girl with the exact real face from the uploaded photo. Create a professional studio newborn photograph of a sleeping baby, The baby is dressed in a Winnie the Pooh-themed costume: a mustard yellow knit beanie with small rounded bear ears, a classic red knit long-sleeved top, and mustard yellow knit pants.
The baby is posed peacefully, curled up on its stomach with its head gently resting on its hands, eyes closed in deep sleep. It lies within a miniature dark brown wooden bed prop, which is lined with a thick, creamy white, chunky cable-knit blanket that softly cradles the baby.
The foreground features a rustic dark wooden floor with visible grain, subtly adorned with scattered green foliage, including ivy vines and eucalyptus leaves. A small, soft Winnie the Pooh plush toy (yellow with a red shirt) sits upright on the wooden floor in the lower right corner, facing the viewer.
The background is softly blurred with warm, earthy tones, suggesting a cozy, rustic indoor setting. It includes indistinct dark brown wooden elements, a hint of a blurred green potted plant on the left, and a soft, light-colored blurred textile on the right.
The lighting is soft, warm, and diffused studio light, creating gentle highlights and shadows that emphasize the baby's features and the textures of the knitwear. The composition is a full shot, captured from a slightly elevated perspective looking down, with a shallow depth of field. The baby, bed, and immediate foreground elements are in sharp focus, while the background is beautifully out of focus, enhancing the subject. The overall aesthetic is whimsical, cozy, adorable, and heartwarming, characteristic of high-quality newborn photography. The dominant color palette consists of warm yellows (mustard), classic Pooh red, creamy whites, rich browns, and subtle greens.`;m.value=v,m.dispatchEvent(new Event("input"))}}),C.addEventListener("click",()=>{if(m){const v="Ultra-realistic milestone portrait of a baby girl with the exact real face from the uploaded photo. Create an newborn photo of the baby, preserving all natural features and expressions. The baby is peacefully sleeping, dressed in a full knitted brown bodysuit with a matching hat featuring small horns and ears, resembling a baby calf. The baby is lying on a chunky knitted brown blanket, curled up comfortably. Next to the baby is a small wooden stool with a glass bottle of milk, and on the floor a tiny felt cow toy with a miniature wooden bucket. On the right side, add a bundle of golden rice stalks for decoration. The background is warm brown tones with a rustic, cozy farm-like atmosphere. High-resolution, ultra-realistic, soft studio lighting, dreamy and heartwarming style.";m.value=v,m.dispatchEvent(new Event("input"))}}),x.addEventListener("click",()=>{if(m){const v="Ultra-realistic milestone portrait of a baby girl with the exact real face from the uploaded photo. Create an newborn photo of the baby, preserving all natural features and expressions. The baby is peacefully sleeping, dressed in a full knitted brown bodysuit with a matching hat featuring small horns and ears, resembling a baby calf. The baby is lying on a chunky knitted brown blanket, curled up comfortably. Next to the baby is a small wooden stool with a glass bottle of milk, and on the floor a tiny felt cow toy with a miniature wooden bucket. On the right side, add a bundle of golden rice stalks for decoration. The background is warm brown tones with a rustic, cozy farm-like atmosphere. High-resolution, ultra-realistic, soft studio lighting, dreamy and heartwarming style";m.value=v,m.dispatchEvent(new Event("input"))}}),ee.addEventListener("click",()=>{if(m){const v="Ultra-realistic milestone portrait of a baby girl with the exact real face from the uploaded photo. Create an newborn photo of the baby girl, preserving all natural features and expressions. The baby is peacefully sleeping, dressed in a delicate white lace dress with a soft tutu skirt. She wears a pink floral headband on her head, adding a sweet and dreamy touch. The baby is cuddling against a large plush white unicorn with yarn mane, lying comfortably as if hugging it. Around her is a sheer fabric decorated with golden stars and sequins, creating a magical, fairy-tale atmosphere. The background is soft beige, enhancing the gentle, elegant, and enchanting vibe. High-resolution, ultra-realistic, soft studio lighting, dreamy and heartwarming style";m.value=v,m.dispatchEvent(new Event("input"))}}),te.addEventListener("click",()=>{if(m){const v="Ultra-realistic milestone portrait of a baby girl with the exact real face from the uploaded photo. Create an newborn photo of the baby girl, preserving all natural features and expressions. The baby is peacefully sleeping on her side in a curled-up pose, wearing a delicate white lace romper. On her head is a golden lace crown, giving a princess-like appearance. She rests on a soft cream-colored textured blanket, blending harmoniously with the neutral background. The baby’s cheeks are round and slightly blushed, with a serene, angelic sleeping expression. High-resolution, ultra-realistic, soft studio lighting, dreamy and elegant style";m.value=v,m.dispatchEvent(new Event("input"))}}),ne.addEventListener("click",()=>{if(m){const v="Ultra-realistic milestone portrait of a baby girl with the exact real face from the uploaded photo, natural baby skin and soft features. She is lying down comfortably on a soft pastel milestone blanket decorated with baby girl elements. She wears a cute pastel-colored baby dress with a matching headband. Beside her is a small decorated cake with a candle. The background and blanket setup include pastel pink balloons, teddy bears, and flowers. Her name “Happy Birthday” is beautifully integrated into the backdrop design (like on a milestone board, balloon letters, or signage), making it look like a real milestone event photoshoot. High-resolution, photorealistic, professional baby milestone theme.";m.value=v,m.dispatchEvent(new Event("input"))}}),oe.addEventListener("click",()=>{if(m){const v="Ultra-realistic milestone portrait of a baby girl with the exact real face from the uploaded photo. She is lying on her back (not face-down), comfortably positioned in the center on a soft pastel milestone blanket. She is dressed in a baby Cinderella-inspired outfit — a light blue princess-style romper or dress with tiny puff sleeves, soft tutu skirt, and a matching headband or small tiara. Beside her is a small decorated cake with a candle. The background and props are Cinderella-themed: pastel blue balloons, a magical carriage design, castle silhouette, sparkling stars, and fairy-tale decorations. The backdrop also beautifully integrates her name “Happy Birthday”as part of the design (like in balloon letters, a castle banner, or sparkling signage). Soft, magical lighting, natural baby skin tones, high-resolution, photorealistic, professional milestone poster style.";m.value=v,m.dispatchEvent(new Event("input"))}}),D.addEventListener("click",()=>{if(m){const v="Ultra-realistic milestone portrait of a baby girl with the exact real face from the uploaded photo. She is lying on her back (not face-down), comfortably positioned in the center on a soft milestone blanket. She is dressed in a baby Ariel-inspired outfit — a mermaid-style romper or dress in turquoise and purple, with seashell details and a matching headband or tiny tiara. Beside her is a decorated cake topped with a candle. A wooden display board is placed next to her, showing the milestone greeting “Happy Birthday” in realistic letterboard style, just like an authentic milestone photoshoot setup. The background and props are Little Mermaid themed: under-the-sea details, seashells, starfish, corals, ocean waves, and fairy-tale elements. Add cute themed stuffed props near her (like a plush Flounder, Sebastian, or seashell pillow) to enhance the Ariel theme. Soft, magical lighting, natural baby skin tones, high-resolution, photorealistic, professional milestone photoshoot style.";m.value=v,m.dispatchEvent(new Event("input"))}}),Y.addEventListener("click",()=>{if(m){const v="Ultra-realistic milestone portrait of a baby girl with the exact real face from the uploaded photo. She is lying on her back (not face-down), comfortably positioned in the center on a soft milestone blanket. She is dressed in a baby Belle-inspired outfit — a golden-yellow princess-style romper or dress with soft ruffles and a matching headband or tiny tiara. Beside her is a decorated cake with a candle. The background and props are Beauty and the Beast themed: an enchanted castle backdrop, roses, books, candelabra, and other magical fairy-tale decorations. Add cute themed stuffed props next to her (like a soft plush rose, Mrs. Potts and Chip-inspired toys, or a mini enchanted rose in a glass dome) to match the Belle theme. The backdrop also beautifully integrates her name “Happy Birthday” as part of the design (like a royal banner, glowing signage, or castle arch). Soft, magical lighting, natural baby skin tones, high-resolution, photorealistic, professional milestone poster style.";m.value=v,m.dispatchEvent(new Event("input"))}}),_e.addEventListener("click",()=>{if(m){const v="Ultra-realistic milestone portrait of a baby girl with the exact real face from the uploaded photo. She is lying on her back (not face-down), comfortably positioned in the center on a soft milestone blanket. She is dressed in a baby Snow White-inspired outfit — a blue and yellow princess-style dress with puffed sleeves, red accents, and a matching red headband or bow. She is also wearing cute red baby shoes to complete the Snow White look. Beside her is a decorated cake topped with a candle to mark the month. A wooden display board is placed next to her, showing the milestone greeting “Happy Birthday” in realistic letterboard style, just like an authentic milestone photoshoot setup. The background and props are Snow White themed: enchanted forest details, apples, a small wooden cottage, and fairy-tale elements. Add cute themed stuffed props near her (like a plush red apple, forest animals, or a tiny magic mirror) to enhance the Snow White theme. Soft, magical lighting, natural baby skin tones, high-resolution, photorealistic, professional milestone photoshoot style.";m.value=v,m.dispatchEvent(new Event("input"))}}),Ae.addEventListener("click",()=>{if(m){const v="Ultra-realistic milestone portrait of a baby girl with the exact real face from the uploaded photo. She is lying on her back (not face-down), comfortably positioned in the center on a soft milestone blanket. She is dressed in a baby Moana-inspired outfit — a cute island-style romper or dress in red and beige with Polynesian-inspired patterns, plus a matching flower crown or tropical headband. She is also wearing tiny baby slippers or soft shoes that complement the Moana theme. Beside her is a decorated cake topped with a candle to mark the month. A wooden display board is placed next to her, showing the milestone greeting “Happy Birthday” in realistic letterboard style, just like an authentic milestone photoshoot setup. The background and props are Moana themed: tropical island details, the ocean, palm trees, corals, seashells, and fairy-tale elements. Add cute themed stuffed props near her (like a plush Hei Hei chicken, Pua the pig, or tropical flowers) to enhance the Moana theme. Soft, magical lighting, natural baby skin tones, high-resolution, photorealistic, professional milestone photoshoot style.";m.value=v,m.dispatchEvent(new Event("input"))}}),B.addEventListener("click",()=>{if(m){const v="Ultra-realistic milestone portrait of a baby girl with the exact real face from the uploaded photo. She is sitting upright comfortably in the center on a soft milestone blanket. She is dressed in a baby Frozen-inspired outfit — an Elsa-style light blue princess dress with sparkly details, flowing tulle skirt, and shimmering cape. She has Frozen-inspired hair styled like a soft baby version of Elsa’s braid, with tiny snowflake accents. She is also wearing tiny silver or light blue baby shoes to complete the Frozen look. Beside her is a decorated cake topped with a candle to mark the month. A wooden display board is placed next to her, showing the milestone greeting “Happy Birthday” in realistic letterboard style, just like an authentic milestone photoshoot setup. The background and props are Frozen themed: snowy mountains, snowflakes, icicles, and a magical ice castle design. Add cute themed stuffed props near her (like a plush Olaf snowman or snowflake pillows) to enhance the Frozen theme. Soft, magical lighting, natural baby skin tones, high-resolution, photorealistic, professional milestone photoshoot style.";m.value=v,m.dispatchEvent(new Event("input"))}}),ce.addEventListener("click",()=>{if(m){const v="Ultra-realistic milestone portrait of a baby girl with the exact real face from the uploaded photo. She is sitting upright comfortably in the center on a soft milestone blanket. She is dressed in a baby Minnie Mouse-inspired outfit — a red polka dot dress with puffed sleeves, white gloves-style detail, and a matching Minnie Mouse headband with black ears and a big red bow. She is also wearing tiny red or black baby shoes to complete the Minnie look. Beside her is a decorated cake topped with a candle to mark the month. A wooden display board is placed next to her, showing the milestone greeting “Happy Birthday”” in realistic letterboard style, just like an authentic milestone photoshoot setup. The background and props are Minnie Mouse themed: pink and red balloons, polka dot patterns, hearts, and Minnie Mouse plush toys. Add cute themed stuffed props near her (like a plush Minnie Mouse, Mickey toy, or little polka-dot gift boxes) to enhance the Minnie theme. Soft, cheerful lighting, natural baby skin tones, high-resolution, photorealistic, professional milestone photoshoot style.";m.value=v,m.dispatchEvent(new Event("input"))}}),Vn.addEventListener("click",()=>{if(m){const v="Ultra-realistic milestone portrait of a baby girl with the exact real face from the uploaded photo. She is sitting upright comfortably in the center on a soft milestone blanket. She is dressed in a cute baby Santa Claus-inspired outfit — a red and white Christmas dress with fluffy white trim, a matching Santa hat or festive headband, and tiny red baby shoes to complete the look. Beside her is a decorated Christmas cake topped with a candle to mark the month. A wooden display board is placed next to her, showing the milestone greeting “Happy Birthday” in realistic letterboard style, just like an authentic milestone photoshoot setup. The background and props are Christmas themed: decorated Christmas tree, wrapped gifts, stockings, snowflakes, candy canes, and fairy lights. Add cute themed stuffed props near her (like a plush reindeer, snowman, or Christmas teddy bear) to enhance the holiday theme. Soft, warm festive lighting, natural baby skin tones, high-resolution, photorealistic, professional milestone photoshoot style.";m.value=v,m.dispatchEvent(new Event("input"))}}),qn.addEventListener("click",()=>{if(m){const v="Ultra-realistic milestone portrait of a baby girl with the exact real face from the uploaded photo. She is sitting upright comfortably in the center on a soft milestone blanket. She is dressed in a baby Aurora (Sleeping Beauty)-inspired outfit — a soft pink princess gown with elegant details, puffy skirt, and a tiny golden crown or tiara on her head. She is also wearing cute pink baby shoes to complete the Aurora princess look. Beside her is a decorated cake topped with a candle to mark the month. A wooden display board is placed next to her, showing the milestone greeting “Happy Birthday” in realistic letterboard style, just like an authentic milestone photoshoot setup. The background and props are Sleeping Beauty themed: a magical castle, enchanted forest, fairies’ sparkles, and dreamy floral decorations. Add cute themed stuffed props near her (like a plush spinning wheel, tiny fairy dolls, or a soft pink pillow) to enhance the Aurora theme. Soft, magical lighting, natural baby skin tones, high-resolution, photorealistic, professional milestone photoshoot style.";m.value=v,m.dispatchEvent(new Event("input"))}}),Gn.addEventListener("click",()=>{if(m){const v="Ultra-realistic milestone portrait of a baby girl with the exact real face from the uploaded photo. She is sitting upright comfortably in the center on a soft milestone blanket. She is dressed in a baby Tinker Bell-inspired outfit — a sparkly green fairy dress with ruffled skirt, tiny fairy wings on her back, and a matching green headband or bun hairstyle with a little ribbon. She is also wearing cute green or silver baby shoes to complete the fairy look. Beside her is a decorated cake topped with a candle to mark the month. A wooden display board is placed next to her, showing the milestone greeting “Happy Birthday” in realistic letterboard style, just like an authentic milestone photoshoot setup. The background and props are Tinker Bell themed: magical forest details, glowing fairy dust sparkles, mushrooms, flowers, and tiny lanterns. Add cute themed stuffed props near her (like a plush fairy wand, mini Peter Pan hat, or small forest animals) to enhance the fairy vibe. Soft, magical lighting, natural baby skin tones, high-resolution, photorealistic, professional milestone photoshoot style.";m.value=v,m.dispatchEvent(new Event("input"))}}),Hn.addEventListener("click",()=>{if(m){const v="Ultra-realistic birthday portrait of a baby girl with the exact real face from the uploaded photo. She is sitting upright in the center, wearing a puffy pink princess dress with rosette details, sparkly bodice, and a big bow accent. She has long wavy black hair with a black ribbon headband. Around her is an enchanted forest theme setup: giant colorful butterflies, glowing fairy lights, lush flowers in pink, purple, and cream, and wooden log props. Behind her is a dreamy forest backdrop with tall trees and twinkling golden lights like fireflies. In front of her are large white marquee letters spelling out “ONE” to mark her first birthday. Add soft, whimsical lighting, magical atmosphere, and high-resolution detail for a professional studio photoshoot style";m.value=v,m.dispatchEvent(new Event("input"))}}),document.querySelectorAll(".template-button").forEach(v=>{v.addEventListener("click",()=>{document.querySelectorAll(".template-button").forEach($e=>{$e.classList.remove("selected")}),v.classList.add("selected")})}),at(),X()}function Wr(){Ie.innerHTML=`
        <div class="upload-group">
            <label>Ảnh gốc (để giữ lại chủ thể)</label>
            <div id="original-image-upload" class="drop-zone small" role="button" tabindex="0">
                <div id="original-image-preview" class="single-preview-container">
                    <p>Tải ảnh gốc</p>
                </div>
                <input type="file" id="original-file-input" accept="image/*" hidden>
            </div>
        </div>

        <div class="upload-group">
            <label>Ảnh nền (tùy chọn)</label>
            <div id="background-image-upload" class="drop-zone small" role="button" tabindex="0">
                 <div id="background-image-preview" class="single-preview-container">
                    <p>Tải ảnh nền</p>
                </div>
                <input type="file" id="background-file-input" accept="image/*" hidden>
            </div>
        </div>
        
        <div class="prompt-header">
            <label for="background-prompt-input">Mô tả nền (nếu không tải ảnh nền)</label>
            <div class="prompt-buttons">
                 <button id="generate-bg-prompt-btn">Tạo mô tả</button>
                 <div id="suggestion-wrapper" class="suggestion-wrapper hidden">
                    <input type="text" id="suggestion-input" placeholder="Gợi ý nền, ví dụ: trong rừng">
                    <button id="confirm-suggestion-btn" aria-label="Xác nhận gợi ý">✓</button>
                    <button id="cancel-suggestion-btn" aria-label="Hủy bỏ">✕</button>
                 </div>
            </div>
        </div>
        <textarea id="background-prompt-input" placeholder="Ví dụ: Một bãi biển nhiệt đới lúc hoàng hôn"></textarea>
        
        <button id="change-background-btn" disabled>Thay nền</button>
    `;const o=document.getElementById("original-image-upload"),t=document.getElementById("original-file-input"),e=document.getElementById("background-image-upload"),n=document.getElementById("background-file-input"),i=document.getElementById("background-prompt-input"),r=document.getElementById("generate-bg-prompt-btn"),l=document.getElementById("change-background-btn"),d=document.getElementById("suggestion-wrapper"),c=document.getElementById("suggestion-input"),u=document.getElementById("confirm-suggestion-btn"),f=document.getElementById("cancel-suggestion-btn");o.addEventListener("click",()=>t.click()),t.addEventListener("change",p=>Ue(p,"original")),o.addEventListener("dragover",be),o.addEventListener("dragleave",Ee),o.addEventListener("drop",p=>Fe(p,"original")),e.addEventListener("click",()=>n.click()),n.addEventListener("change",p=>Ue(p,"background")),e.addEventListener("dragover",be),e.addEventListener("dragleave",Ee),e.addEventListener("drop",p=>Fe(p,"background")),[i,t,n].forEach(p=>{p.addEventListener("input",H),p.addEventListener("change",H)}),l.addEventListener("click",Zr),r.addEventListener("click",()=>{if(!F){alert("Vui lòng tải lên ảnh gốc trước.");return}r.classList.add("hidden"),d.classList.remove("hidden"),c.focus()}),f.addEventListener("click",()=>{d.classList.add("hidden"),r.classList.remove("hidden"),c.value=""}),u.addEventListener("click",()=>{yn(c.value)}),c.addEventListener("keydown",p=>{p.key==="Enter"&&yn(c.value)}),ve("original"),ve("background"),H()}function zr(){Ie.innerHTML=`
        <div class="upload-group">
            <label>Tải ảnh cũ, hư hại</label>
            <div id="restoration-image-upload" class="drop-zone" role="button" tabindex="0">
                <div id="restoration-image-preview" class="single-preview-container large">
                    <p>Tải ảnh để phục hồi</p>
                </div>
                <input type="file" id="restoration-file-input" accept="image/*" hidden>
            </div>
        </div>

        <div class="options-grid">
             <div class="checkbox-section">
                <input type="checkbox" id="colorize-checkbox">
                <label for="colorize-checkbox">Tô màu</label>
            </div>
             <div class="checkbox-section">
                <input type="checkbox" id="face-rotate-checkbox">
                <label for="face-rotate-checkbox">Xoay mặt (chính diện)</label>
            </div>
        </div>

        <div class="outfit-section">
            <label for="outfit-select">Thay trang phục (tùy chọn)</label>
            <div class="outfit-controls">
                 <select id="outfit-select">
                    <option value="none">Không thay đổi</option>
                    <option value="Vest nam">Vest nam</option>
                    <option value="Vest nữ">Vest nữ</option>
                    <option value="Áo dài Việt Nam">Áo dài Việt Nam</option>
                    <option value="Áo sơ mi">Áo sơ mi</option>
                    <option value="custom">Khác (nhập bên dưới)</option>
                </select>
                <textarea id="custom-outfit-input" class="hidden" placeholder="Mô tả trang phục bạn muốn..."></textarea>
            </div>
        </div>
        
        <button id="restore-btn" disabled>Phục hồi ảnh</button>
    `;const o=document.getElementById("restoration-image-upload"),t=document.getElementById("restoration-file-input"),e=document.getElementById("restore-btn"),n=document.getElementById("outfit-select"),i=document.getElementById("custom-outfit-input");o.addEventListener("click",()=>t.click()),t.addEventListener("change",r=>Ue(r,"restoration")),o.addEventListener("dragover",be),o.addEventListener("dragleave",Ee),o.addEventListener("drop",r=>Fe(r,"restoration")),e.addEventListener("click",Qr),n.addEventListener("change",()=>{n.value==="custom"?i.classList.remove("hidden"):i.classList.add("hidden")}),ve("restoration"),Te()}function Xr(){Ie.innerHTML=`
        <div class="upload-group">
            <label>Tải ảnh để chỉnh sửa Inpaint</label>
            <div id="inpaint-image-upload" class="drop-zone large" role="button" tabindex="0">
                <div id="inpaint-image-preview" class="single-preview-container large">
                     <p>Tải ảnh lên</p>
                </div>
                <input type="file" id="inpaint-file-input" accept="image/*" hidden>
            </div>
        </div>
        
        <div id="inpaint-canvas-wrapper" class="hidden">
            <canvas id="inpaint-display-canvas"></canvas>
        </div>

        <div id="inpaint-tools" class="inpaint-tools-container hidden">
            <div class="tool">
                <label for="brush-size">Cỡ cọ: <span id="brush-size-value">${ye}</span></label>
                <input type="range" id="brush-size" min="5" max="100" value="${ye}" step="1">
            </div>
            <div class="tool-buttons">
                <button id="undo-btn" class="action-btn small">Hoàn tác</button>
                <button id="clear-mask-btn" class="action-btn small">Xóa vùng chọn</button>
            </div>
        </div>

        <div class="prompt-header">
            <label for="inpaint-prompt-input">Mô tả vùng cần chỉnh sửa</label>
        </div>
        <textarea id="inpaint-prompt-input" placeholder="Ví dụ: Thêm một chiếc mũ cao bồi"></textarea>
        
        <button id="inpaint-btn" disabled>Chỉnh sửa ảnh</button>
    `;const o=document.getElementById("inpaint-image-upload"),t=document.getElementById("inpaint-file-input"),e=document.getElementById("inpaint-btn"),n=document.getElementById("inpaint-prompt-input");A=document.getElementById("inpaint-display-canvas"),o.addEventListener("click",()=>t.click()),t.addEventListener("change",i=>Ue(i,"inpaint")),o.addEventListener("dragover",be),o.addEventListener("dragleave",Ee),o.addEventListener("drop",i=>Fe(i,"inpaint")),e.addEventListener("click",nl),n.addEventListener("input",$),K&&Bn(K),$()}function He(){const o=window.innerWidth<1024;let t;o?t=document.getElementById("mobile-results-wrapper"):t=document.getElementById("output"),t&&t.scrollIntoView({behavior:"smooth",block:"start"})}async function Nn(o,t){if(!o||!o.type.startsWith("image/"))return;const e=await st(o),n=`file-${Date.now()}`,i={file:o,base64:e,id:n};t==="original"?F=i:t==="background"?O=i:t==="restoration"?ie=i:t==="inpaint"&&(K=i,Bn(i)),t!=="inpaint"&&ve(t),t==="original"||t==="background"?H():t==="restoration"?Te():$()}async function Ue(o,t){var i;const n=(i=o.target.files)==null?void 0:i[0];n&&await Nn(n,t)}async function Fe(o,t){var e,n;if(o.preventDefault(),(e=o.currentTarget)==null||e.classList.remove("active"),(n=o.dataTransfer)!=null&&n.files){const i=o.dataTransfer.files[0];i&&await Nn(i,t)}}function ve(o){var r;const t=`${o}-image-preview`,e=document.getElementById(t);if(!e)return;let n,i="";switch(o){case"original":n=F,i="Tải ảnh gốc";break;case"background":n=O,i="Tải ảnh nền";break;case"restoration":n=ie,i="Tải ảnh để phục hồi";break}n?(e.innerHTML=`
            <img src="${n.base64}" alt="${n.file.name}" class="single-preview-img"/>
            <button class="remove-btn" data-type="${o}" aria-label="Remove image">&times;</button>
        `,(r=e.querySelector(".remove-btn"))==null||r.addEventListener("click",l=>{l.stopPropagation(),o==="original"?F=null:o==="background"?O=null:o==="restoration"&&(ie=null),ve(o),o==="original"||o==="background"?H():Te()})):e.innerHTML=`<p>${i}</p>`}function H(){const o=document.getElementById("change-background-btn"),t=document.getElementById("background-prompt-input");if(!o||!t)return;O?(t.disabled=!0,t.value=""):t.disabled=!1;const e=!!F,n=!!O,i=t.value.trim()!=="";o.disabled=k||!e||!n&&!i}function Te(){const o=document.getElementById("restore-btn");o&&(o.disabled=k||!ie)}function $(){const o=document.getElementById("inpaint-btn"),t=document.getElementById("inpaint-prompt-input");if(!o||!t||!I)return;const e=!!K,n=t.value.trim()!=="",i=I.getContext("2d"),r=i==null?void 0:i.getImageData(0,0,I.width,I.height).data;let l=!1;if(r){for(let d=3;d<r.length;d+=4)if(r[d]>0){l=!0;break}}o.disabled=k||!e||!n||!l}async function yn(o=""){if(!F){alert("Vui lòng tải lên ảnh gốc trước.");return}k=!0;const t=document.getElementById("generate-bg-prompt-btn"),e=document.getElementById("suggestion-wrapper"),n=t.parentElement;e.classList.add("hidden");const i=document.createElement("span");i.className="small-spinner",n.appendChild(i),H();try{const r=new de({apiKey:"PLACEHOLDER_API_KEY"}),d={inlineData:{data:F.base64.split(",")[1],mimeType:F.file.type}},c={text:`Analyze the subject in this image. Create a detailed, professional photography background prompt that would complement the subject. The user suggested: "${o}". The background should be realistic and harmonious with the subject's lighting and style. Only return the prompt text.`},u=await r.models.generateContent({model:"gemini-2.5-flash",contents:{parts:[d,c]}}),f=document.getElementById("background-prompt-input");f&&(f.value=u.text,f.dispatchEvent(new Event("input")))}catch(r){console.error("Error generating background prompt:",r),alert(`Không thể tạo mô tả: ${r.message}`)}finally{k=!1,i.remove();const r=document.getElementById("suggestion-input");r.value="",t.classList.remove("hidden"),H()}}async function Zr(){if(!(k||!F)){k=!0,H(),G.innerHTML=`
        <div class="spinner"></div>
        <p>Đang thay đổi nền... Việc này có thể mất một chút thời gian.</p>
    `;try{const o=new de({apiKey:"PLACEHOLDER_API_KEY"}),t=document.getElementById("background-prompt-input"),e=[];e.push({inlineData:{data:F.base64.split(",")[1],mimeType:F.file.type}});let n="";O?(e.push({inlineData:{data:O.base64.split(",")[1],mimeType:O.file.type}}),n="using the second image provided as the new background."):n=`placing the subject into a new background described as: "${t.value}".`;const i=`
            **ROLE: Professional Photo Editor.**
            **TASK:** Your task is to expertly replace the background of the first image (the original subject). You must meticulously cut out the subject and place it seamlessly into the new background.
            **INSTRUCTIONS:**
            1.  Identify and isolate the primary subject(s) from the first image.
            2.  Place the isolated subject(s) into the new context ${n}
            3.  **Crucially, you must create a photorealistic final image.** This means harmonizing lighting, shadows, color grading, and perspective between the subject and the new background. The final result should look like a single, professionally taken photograph, not a composite.
        `;e.push({text:i}),le=i;const r={model:"gemini-2.5-flash-image-preview",contents:{parts:e},config:{responseModalities:[N.IMAGE,N.TEXT]}},l=await o.models.generateContent(r),d=[];let c=!1;if(l.candidates&&l.candidates.length>0){const u=l.candidates[0];if(u.content&&u.content.parts&&u.content.parts.length>0){const f=u.content.parts.find(p=>p.inlineData);f!=null&&f.inlineData&&d.push(`data:${f.inlineData.mimeType};base64,${f.inlineData.data}`)}else u.finishReason==="SAFETY"&&(c=!0)}d.length>0?(re=d[0],d.forEach(we),R(Ce(d))):R(c?'<p class="error">Nội dung đã bị chặn do chính sách an toàn. Vui lòng thử một mô tả hoặc hình ảnh khác.</p>':'<p class="error">Không thể tạo nội dung. Mô hình đã không trả về kết quả hợp lệ hoặc phản hồi trống. Vui lòng thử lại.</p>')}catch(o){console.error(o);const t=`<p class="error">Đã xảy ra lỗi: ${o.message}</p>`;R(t)}finally{k=!1,H(),He()}}}async function Qr(){if(!(k||!ie)){k=!0,Te(),G.innerHTML=`
        <div class="spinner"></div>
        <p>Đang phục hồi ảnh... Việc này có thể mất một chút thời gian.</p>
    `;try{const o=new de({apiKey:"PLACEHOLDER_API_KEY"}),t=document.getElementById("colorize-checkbox"),e=document.getElementById("face-rotate-checkbox"),n=document.getElementById("outfit-select"),i=document.getElementById("custom-outfit-input");let r=`
            **ROLE:** You are a world-class expert in digital photo restoration and enhancement.
            **PRIMARY GOAL:** Your primary task is to restore the provided old/damaged photograph. The final result must be sharp, clear, and look as if it were taken with a modern, high-end professional camera. This includes fixing scratches, removing noise, and improving details.
            **ABSOLUTE CONSTRAINT: THE MOST IMPORTANT RULE:** You must preserve the absolute identity and likeness of any person in the photograph. The restored face and features must be 100% identical to the original, only enhanced in clarity and quality. DO NOT alter their identity.
            **MOST REQUIRED:** Retain 100% of the facial features of the person in the original photo. **USE THE UPLOADED IMAGE AS THE MOST ACCURATE REFERENCE FOR THE FACE.** Absolutely do not change the lines, eyes, nose, mouth. Photorealistic studio portrait. Skin shows fine micro-texture and subtle subsurface scattering; eyes tack sharp; hairline blends cleanly with individual strands and natural fly away. Fabric shows authentic weave, seams and natural wrinkles; metals reflect with tiny imperfections. Lighting coherent with scene; natural shadow falloff on cheekbone, jawline and nose. Background has believable micro-details; avoid CGI-clean look. 85mm equivalent, f/2.0 to f/2.8; subject tack sharp, cinematic color grade; confident posture, slight asymmetry.
        `;t.checked&&(r+=`
- **ADDITIONAL TASK: Colorize:** Professionally colorize this photograph. The colors should be realistic, natural, and appropriate for the scene. Skin tones must be lifelike.`),e.checked&&(r+=`
- **ADDITIONAL TASK: Face Rotation:** The photo contains one person. You must adjust their pose to be front-facing. This rotation must be subtle and natural, while strictly adhering to the **ABSOLUTE CONSTRAINT** of preserving their exact facial identity.`);let l=n.value;l==="custom"&&(l=i.value),l!=="none"&&l.trim()!==""&&(r+=`
- **ADDITIONAL TASK: Change Outfit:** Replace the original clothing of the main subject with a '${l}'. The new outfit must be seamlessly integrated, with realistic lighting, shadows, and fabric texture that matches the restored image's quality. Ensure the new clothing fits the subject's posture and body shape naturally.`),r+=`
**FINAL OUTPUT FORMAT:** The output must be only the final, restored image.`,le=r;const c={model:"gemini-2.5-flash-image-preview",contents:{parts:[{inlineData:{data:ie.base64.split(",")[1],mimeType:ie.file.type}},{text:r}]},config:{responseModalities:[N.IMAGE,N.TEXT]}},u=await o.models.generateContent(c),f=[];let p=!1;if(u.candidates&&u.candidates.length>0){const h=u.candidates[0];if(h.content&&h.content.parts&&h.content.parts.length>0){const g=h.content.parts.find(y=>y.inlineData);g!=null&&g.inlineData&&f.push(`data:${g.inlineData.mimeType};base64,${g.inlineData.data}`)}else h.finishReason==="SAFETY"&&(p=!0)}f.length>0?(re=f[0],f.forEach(we),R(Ce(f))):R(p?'<p class="error">Nội dung đã bị chặn do chính sách an toàn. Vui lòng thử một mô tả hoặc hình ảnh khác.</p>':'<p class="error">Không thể tạo nội dung. Mô hình đã không trả về kết quả hợp lệ hoặc phản hồi trống. Vui lòng thử lại.</p>')}catch(o){console.error(o);const t=`<p class="error">Đã xảy ra lỗi: ${o.message}</p>`;R(t)}finally{k=!1,Te(),He()}}}function Bn(o){const t=document.getElementById("inpaint-image-upload"),e=document.getElementById("inpaint-canvas-wrapper"),n=document.getElementById("inpaint-tools"),i=document.createElement("button");t.classList.add("hidden"),e.classList.remove("hidden"),n.classList.remove("hidden"),A=document.getElementById("inpaint-display-canvas"),I=document.createElement("canvas"),U=new Image,U.onload=()=>{if(!U||!A||!I)return;const d=A.parentElement.clientWidth,c=Math.min(1,d/U.width),u=U.width*c,f=U.height*c;A.width=u,A.height=f,I.width=u,I.height=f,A.getContext("2d").drawImage(U,0,0,u,f),V=[]},U.src=o.base64,A.addEventListener("mousedown",vn),A.addEventListener("mousemove",tt),A.addEventListener("mouseup",Je),A.addEventListener("mouseleave",Je),A.addEventListener("touchstart",vn,{passive:!1}),A.addEventListener("touchmove",tt,{passive:!1}),A.addEventListener("touchend",Je);const r=document.getElementById("brush-size"),l=document.getElementById("brush-size-value");r.addEventListener("input",d=>{ye=parseInt(d.target.value,10),l.textContent=String(ye)}),document.getElementById("undo-btn").addEventListener("click",el),document.getElementById("clear-mask-btn").addEventListener("click",tl),i.className="remove-btn",i.innerHTML="&times;",i.setAttribute("aria-label","Remove image"),i.style.position="absolute",i.style.top="5px",i.style.right="5px",e.appendChild(i),i.addEventListener("click",()=>{K=null,U=null,A=null,I=null,V=[],t.classList.remove("hidden"),e.classList.add("hidden"),n.classList.add("hidden"),e.removeChild(i),$()})}function jr(o){const e=A.getBoundingClientRect();return o instanceof MouseEvent?{x:o.clientX-e.left,y:o.clientY-e.top}:{x:o.touches[0].clientX-e.left,y:o.touches[0].clientY-e.top}}function vn(o){if(o.preventDefault(),!I)return;Be=!0;const t=I.getContext("2d");V.push(t.getImageData(0,0,I.width,I.height)),V.length>10&&V.shift(),tt(o)}function Je(){Be&&(Be=!1,$())}function tt(o){if(!Be||!A||!I)return;o.preventDefault();const t=I.getContext("2d"),e=jr(o);t.fillStyle="white",t.beginPath(),t.arc(e.x,e.y,ye/2,0,Math.PI*2),t.fill(),it()}function it(){if(!A||!U||!I)return;const o=A.getContext("2d");o.clearRect(0,0,A.width,A.height),o.drawImage(U,0,0,A.width,A.height),o.globalAlpha=.5,o.fillStyle="red";const t=document.createElement("canvas");t.width=I.width,t.height=I.height;const e=t.getContext("2d");e.drawImage(I,0,0),e.globalCompositeOperation="source-in",e.fillRect(0,0,t.width,t.height),o.drawImage(t,0,0),o.globalAlpha=1}function el(){if(V.length>0&&I){const o=V.pop();I.getContext("2d").putImageData(o,0,0),it(),$()}}function tl(){if(I){const o=I.getContext("2d");V.push(o.getImageData(0,0,I.width,I.height)),V.length>10&&V.shift(),o.clearRect(0,0,I.width,I.height),it(),$()}}async function nl(){if(k||!K||!I)return;const o=document.getElementById("inpaint-prompt-input");if(!(!o||o.value.trim()==="")){k=!0,$(),G.innerHTML=`
        <div class="spinner"></div>
        <p>Đang chỉnh sửa ảnh... Việc này có thể mất một chút thời gian.</p>
    `;try{const t=new de({apiKey:"PLACEHOLDER_API_KEY"}),e=I.toDataURL("image/png").split(",")[1],n={inlineData:{data:K.base64.split(",")[1],mimeType:K.file.type}},i={inlineData:{data:e,mimeType:"image/png"}},r=`
            **ROLE:** AI Photo Inpainting Expert.
            **TASK:** You are given an original image and a mask image. Your task is to modify ONLY the area of the original image that corresponds to the non-transparent parts of the mask image. The rest of the image must remain untouched.
            **MODIFICATION:** The change to make in the masked area is: "${o.value}".
            **IMPORTANT:** The final result must be a seamless, photorealistic blend. The modified area should match the lighting, texture, and style of the surrounding original image.
            **OUTPUT:** Return only the final edited image.
        `,l={text:r};le=r;const d={model:"gemini-2.5-flash-image-preview",contents:{parts:[n,i,l]},config:{responseModalities:[N.IMAGE,N.TEXT]}},c=await t.models.generateContent(d),u=[];let f=!1;if(c.candidates&&c.candidates.length>0){const p=c.candidates[0];if(p.content&&p.content.parts&&p.content.parts.length>0){const h=p.content.parts.find(g=>g.inlineData);h!=null&&h.inlineData&&u.push(`data:${h.inlineData.mimeType};base64,${h.inlineData.data}`)}else p.finishReason==="SAFETY"&&(f=!0)}u.length>0?(re=u[0],u.forEach(we),R(Ce(u))):R(f?'<p class="error">Nội dung đã bị chặn do chính sách an toàn. Vui lòng thử một mô tả hoặc hình ảnh khác.</p>':'<p class="error">Không thể tạo nội dung. Mô hình đã không trả về kết quả hợp lệ hoặc phản hồi trống. Vui lòng thử lại.</p>')}catch(t){console.error(t);const e=`<p class="error">Đã xảy ra lỗi: ${t.message}</p>`;R(e)}finally{k=!1,$(),He()}}}function ol(){m&&(m.value="",m.dispatchEvent(new Event("input")))}function il(o){const t=o.target;t.files&&Un(Array.from(t.files))}function be(o){o.preventDefault(),o.currentTarget.classList.add("active")}function Ee(o){o.preventDefault(),o.currentTarget.classList.remove("active")}function al(o){var t;o.preventDefault(),o.currentTarget.classList.remove("active"),(t=o.dataTransfer)!=null&&t.files&&Un(Array.from(o.dataTransfer.files))}async function Un(o){const t=o.find(e=>e.type.startsWith("image/"));if(t){const e=await st(t),n=`file-${Date.now()}-${Math.random()}`;z=[{file:t,base64:e,id:n}]}at(),X()}function at(){var o;if(pe)if(z.length>0){const t=z[0];pe.innerHTML=`
            <img src="${t.base64}" alt="${t.file.name}" class="single-preview-img"/>
            <button class="remove-btn" data-id="${t.id}" aria-label="Remove image">&times;</button>
        `,(o=pe.querySelector(".remove-btn"))==null||o.addEventListener("click",e=>{e.stopPropagation(),sl(t.id)})}else pe.innerHTML='<p style="font-size: 14pt">Nhấn(Bấm) ở đây để chọn ảnh</p>'}function sl(o){z=z.filter(t=>t.id!==o),at(),X()}function rl(){if(J!=="generate"||!ae)return;const o=document.getElementById("aspect-ratio-wrapper"),t=document.getElementById("keep-face-section");if(!o||!t)return;const e=z.length>0;t.classList.toggle("hidden",!e),o.classList.toggle("hidden",e),ae.disabled=k}function X(){J!=="generate"||!Ne||!m||(Ne.disabled=m.value.trim()===""||k,rl())}function ll(){G.innerHTML=`
        <div class="placeholder">
            <p>Ảnh của bạn sẽ xuất hiện ở đây.</p>
        </div>
    `,re=null,le=null}function Ce(o){return`
        <div class="generated-image-grid">
            ${o.map((t,e)=>`
                <div class="generated-image-container" data-src="${t}" title="Nhấn để phóng to ảnh">
                    <img src="${t}" alt="Generated Image ${e+1}" class="generated-image">
                    <div class="image-actions">
                        <button class="image-action-btn download-btn" data-src="${t}" aria-label="Tải xuống ảnh ${e+1}">
                             <svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 -960 960 960" width="24"><path d="M480-320 280-520l56-58 104 104v-326h80v326l104-104 56 58-200 200ZM240-160q-33 0-56.5-23.5T160-240v-120h80v120h480v-120h80v120q0 33-23.5 56.5T720-160H240Z"/></svg>
                        </button>
                    </div>
                </div>
            `).join("")}
        </div>
    `}async function we(o){try{const t=`saved-${Date.now()}-${Math.random()}`,e=Jr(o);await Hr({id:t,blob:e});const n=URL.createObjectURL(e);q.push({url:n,id:t}),me()}catch(t){console.error("Failed to save image to IndexedDB:",t)}}function me(){if(se){if(q.length===0){se.innerHTML='<p class="placeholder-text">Chưa có ảnh nào được lưu.</p>';return}se.innerHTML=q.map(o=>`
        <div class="saved-image-container" data-src="${o.url}" title="Nhấn để phóng to ảnh">
            <img src="${o.url}" alt="Saved image" class="saved-image"/>
            <button class="remove-btn" data-id="${o.id}" aria-label="Xóa ảnh đã lưu">&times;</button>
        </div>
    `).join(""),se.querySelectorAll(".remove-btn").forEach(o=>{o.addEventListener("click",t=>{t.stopPropagation();const e=o.dataset.id;e&&ul(e)})}),se.querySelectorAll(".saved-image-container").forEach(o=>{o.addEventListener("click",()=>{const t=o.dataset.src;t&&Fn(t)})})}}async function ul(o){try{await Yr(o);const t=q.find(e=>e.id===o);t&&URL.revokeObjectURL(t.url),q=q.filter(e=>e.id!==o),me()}catch(t){console.error("Failed to delete image from IndexedDB:",t)}}function R(o){if(!o.trim()){ll();return}const t=`
        <div class="output-content">
            ${o}
        </div>
    `;G.innerHTML=t,G.querySelectorAll(".download-btn").forEach(n=>{n.addEventListener("click",i=>{i.stopPropagation();const r=i.currentTarget.dataset.src;r&&fl(r)})}),G.querySelectorAll(".generated-image-container").forEach(n=>{n.addEventListener("click",()=>{const i=n.dataset.src;i&&Fn(i)})})}function dl(){const o=document.createElement("input");o.type="file",o.accept="image/*",o.addEventListener("change",async t=>{var i;if(!m||!ae)return;const n=(i=t.target.files)==null?void 0:i[0];if(n){k=!0,ae.innerHTML='<span class="small-spinner"></span> Đang phân tích...',X();try{const r=new de({apiKey:"PLACEHOLDER_API_KEY"}),d={inlineData:{data:(await st(n)).split(",")[1],mimeType:n.type}},c={text:"Describe this image for a generative AI. Create a detailed prompt that would help generate a similar image with another input image, focusing on subject, style, colors, and composition. Only prompt send back"},u=await r.models.generateContent({model:"gemini-2.5-flash",contents:{parts:[d,c]}});m.value=u.text,m.dispatchEvent(new Event("input"))}catch(r){console.error("Error analyzing image:",r),alert(`Không thể phân tích ảnh: ${r.message}`)}finally{k=!1,ae.innerHTML="Phân tích ảnh",X()}}}),o.click()}async function cl(){if(!(k||!m)){k=!0,X(),G.innerHTML=`
        <div class="spinner"></div>
        <p>Đang tạo ảnh... Việc này có thể mất một chút thời gian.</p>
    `;try{const o=new de({apiKey:"PLACEHOLDER_API_KEY"});if(z.length>0){const t=z.map(c=>({inlineData:{data:c.base64.split(",")[1],mimeType:c.file.type}}));let e=m.value;et&&et.checked&&(e=`**MOST REQUIRED:** Retain 100% of the facial features of the person in the original photo. **USE THE UPLOADED IMAGE AS THE MOST ACCURATE REFERENCE FOR THE FACE.** Absolutely do not change the lines, eyes, nose, mouth. Photorealistic studio portrait. Skin shows fine micro-texture and subtle subsurface scattering; eyes tack sharp; hairline blends cleanly with individual strands and natural fly away. Fabric shows authentic weave, seams and natural wrinkles; metals reflect with tiny imperfections. Lighting coherent with scene; natural shadow falloff on cheekbone, jawline and nose. Background has believable micro-details; avoid CGI-clean look. 85mm equivalent, f/2.0–f/2.8; subject tack sharp, cinematic color grade; confident posture, slight asymmetry. ${m.value}`);const n={text:e};le=e;const i={model:"gemini-2.5-flash-image-preview",contents:{parts:[...t,n]},config:{responseModalities:[N.IMAGE,N.TEXT]}},r=await o.models.generateContent(i),l=[];let d=!1;if(r.candidates&&r.candidates.length>0){const c=r.candidates[0];if(c.content&&c.content.parts&&c.content.parts.length>0){const u=c.content.parts.find(f=>f.inlineData);u!=null&&u.inlineData&&l.push(`data:${u.inlineData.mimeType};base64,${u.inlineData.data}`)}else c.finishReason==="SAFETY"&&(d=!0)}l.length>0?(re=l[0],l.forEach(we),R(Ce(l))):R(d?'<p class="error">Nội dung đã bị chặn do chính sách an toàn. Vui lòng thử một mô tả hoặc hình ảnh khác.</p>':'<p class="error">Không thể tạo nội dung. Mô hình đã không trả về kết quả hợp lệ hoặc phản hồi trống. Vui lòng thử lại.</p>')}else{if(!je)throw new Error("Aspect ratio element not found");le=m.value;const t=await o.models.generateImages({model:"imagen-4.0-generate-001",prompt:m.value,config:{numberOfImages:1,outputMimeType:"image/jpeg",aspectRatio:je.value}});if(t.generatedImages&&t.generatedImages.length>0){const e=t.generatedImages.map(n=>`data:image/jpeg;base64,${n.image.imageBytes}`);re=e[0],e.forEach(we),R(Ce(e))}else R('<p class="error">Không thể tạo ảnh từ mô tả. Điều này có thể do chính sách an toàn.</p>')}}catch(o){console.error(o);const t=`<p class="error">Đã xảy ra lỗi: ${o.message}</p>`;R(t)}finally{k=!1,J==="generate"&&X(),He()}}}function Fn(o){o&&(Ln.src=o,he.style.display="flex")}function Tn(){he.style.display="none"}function fl(o){if(o){const t=document.createElement("a");t.href=o,t.download=`generated-image-${Date.now()}.png`,document.body.appendChild(t),t.click(),document.body.removeChild(t)}}function st(o){return new Promise((t,e)=>{const n=new FileReader;n.readAsDataURL(o),n.onload=()=>t(n.result),n.onerror=i=>e(i)})}Or();
